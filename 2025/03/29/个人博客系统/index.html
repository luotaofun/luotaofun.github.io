<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.0.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"luotaofun.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.11.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"valine","storage":true,"lazyload":true,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.json","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="个人博客系统  首先第一步，你要扫描整个项目用到的技术栈，除了已经用到的技术栈以外，其他技术暂时不考虑引入，就利用现有的技术栈去实现代码编写。 你先梳理整个项目的现有文件结构，src\main\resources\application.yaml这个是项目的配置文件，你需要创建一个目录扫描来查看现有的项目结构以便更好地规划代码结构，避免重复创建已有的组件。  项目简介 这是一个基于Sp">
<meta property="og:type" content="article">
<meta property="og:title" content="个人博客系统">
<meta property="og:url" content="https://luotaofun.github.io/2025/03/29/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F/index.html">
<meta property="og:site_name" content="Taoの博客">
<meta property="og:description" content="个人博客系统  首先第一步，你要扫描整个项目用到的技术栈，除了已经用到的技术栈以外，其他技术暂时不考虑引入，就利用现有的技术栈去实现代码编写。 你先梳理整个项目的现有文件结构，src\main\resources\application.yaml这个是项目的配置文件，你需要创建一个目录扫描来查看现有的项目结构以便更好地规划代码结构，避免重复创建已有的组件。  项目简介 这是一个基于Sp">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://luotaofun.github.io/2025/03/29/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F/image-20250330160209402.png">
<meta property="og:image" content="https://luotaofun.github.io/2025/03/29/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F/image-20250330160224181.png">
<meta property="article:published_time" content="2025-03-29T07:18:34.000Z">
<meta property="article:modified_time" content="2025-06-13T23:46:18.018Z">
<meta property="article:author" content="LuoTao">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://luotaofun.github.io/2025/03/29/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F/image-20250330160209402.png">


<link rel="canonical" href="https://luotaofun.github.io/2025/03/29/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://luotaofun.github.io/2025/03/29/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F/","path":"2025/03/29/个人博客系统/","title":"个人博客系统"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>个人博客系统 | Taoの博客</title>
  




<!-- TailwindCSS
<script src="https://cdn.tailwindcss.com/3.4.4"></script>
 -->
<!-- Google Fonts (Noto Sans SC for Chinese, Poppins for English) -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Caveat&family=Noto+Sans+SC:wght@300;400;500;700&family=Poppins:wght@300;400;500;700&display=swap" rel="stylesheet">

<!-- Font Awesome -->
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css">

<!-- Apache ECharts -->
<script src="https://cdn.jsdelivr.net/npm/echarts@5.5.1/dist/echarts.min.js"></script>

  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Taoの博客</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Best Tao.</p>

    <!--音乐播放器-->
	
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="home fa-fw"></i>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档<span class="badge">46</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">
    <!--音乐播放器-->
	
    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F"><span class="nav-number">1.</span> <span class="nav-text">个人博客系统</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A1%B9%E7%9B%AE%E7%AE%80%E4%BB%8B"><span class="nav-number">1.1.</span> <span class="nav-text">项目简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8A%80%E6%9C%AF%E6%A0%88"><span class="nav-number">1.2.</span> <span class="nav-text">技术栈</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97"><span class="nav-number">1.3.</span> <span class="nav-text">1 用户注册登录模块</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7%E8%A1%A8user%E8%A1%A8"><span class="nav-number">1.3.1.</span> <span class="nav-text">创建用户表（user表）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BD%93%E7%B1%BBuser.java"><span class="nav-number">1.3.2.</span> <span class="nav-text">创建实体类（User.java）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E8%A7%86%E5%9B%BE%E5%AF%B9%E8%B1%A1userregistervo.java-userloginvo.java-userinfovo.java"><span class="nav-number">1.3.3.</span> <span class="nav-text">创建视图对象（UserRegisterVo.java,
UserLoginVo.java, UserInfoVo.java）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BAmapper%E6%8E%A5%E5%8F%A3"><span class="nav-number">1.3.4.</span> <span class="nav-text">创建Mapper接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BAservice%E6%8E%A5%E5%8F%A3%E5%92%8C%E5%AE%9E%E7%8E%B0%E7%B1%BB"><span class="nav-number">1.3.5.</span> <span class="nav-text">创建Service接口和实现类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BAcontroller"><span class="nav-number">1.3.6.</span> <span class="nav-text">创建Controller</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E5%AF%86%E7%A0%81%E6%A8%A1%E5%9D%97"><span class="nav-number">1.4.</span> <span class="nav-text">2 修改密码模块</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E5%AF%86%E7%A0%81%E7%9A%84vo%E7%B1%BBupdatepasswordvo.javanew"><span class="nav-number">1.4.1.</span> <span class="nav-text">修改密码的VO类UpdatePasswordVo.java(new)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8userservice%E6%8E%A5%E5%8F%A3%E4%B8%AD%E6%B7%BB%E5%8A%A0%E4%BF%AE%E6%94%B9%E5%AF%86%E7%A0%81%E7%9A%84%E6%96%B9%E6%B3%95"><span class="nav-number">1.4.2.</span> <span class="nav-text">在UserService接口中添加修改密码的方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8userserviceimpl%E4%B8%AD%E5%AE%9E%E7%8E%B0%E4%BF%AE%E6%94%B9%E5%AF%86%E7%A0%81%E7%9A%84%E6%96%B9%E6%B3%95"><span class="nav-number">1.4.3.</span> <span class="nav-text">在UserServiceImpl中实现修改密码的方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8usercontroller%E4%B8%AD%E6%B7%BB%E5%8A%A0%E4%BF%AE%E6%94%B9%E5%AF%86%E7%A0%81%E7%9A%84%E6%8E%A5%E5%8F%A3"><span class="nav-number">1.4.4.</span> <span class="nav-text">在UserController中添加修改密码的接口</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF%E6%A8%A1%E5%9D%97"><span class="nav-number">1.5.</span> <span class="nav-text">3 更新用户信息模块</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF%E7%9A%84vo%E7%B1%BB"><span class="nav-number">1.5.1.</span> <span class="nav-text">更新用户信息的VO类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8userservice%E6%8E%A5%E5%8F%A3%E4%B8%AD%E6%B7%BB%E5%8A%A0%E6%9B%B4%E6%96%B0%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF%E7%9A%84%E6%96%B9%E6%B3%95"><span class="nav-number">1.5.2.</span> <span class="nav-text">在UserService接口中添加更新用户信息的方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8userserviceimpl%E4%B8%AD%E5%AE%9E%E7%8E%B0%E6%9B%B4%E6%96%B0%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF%E7%9A%84%E6%96%B9%E6%B3%95"><span class="nav-number">1.5.3.</span> <span class="nav-text">在UserServiceImpl中实现更新用户信息的方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8usercontroller%E4%B8%AD%E6%B7%BB%E5%8A%A0%E6%9B%B4%E6%96%B0%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF%E7%9A%84%E6%8E%A5%E5%8F%A3"><span class="nav-number">1.5.4.</span> <span class="nav-text">在UserController中添加更新用户信息的接口</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%A8%E6%88%B7%E6%B3%A8%E9%94%80%E6%A8%A1%E5%9D%97"><span class="nav-number">1.6.</span> <span class="nav-text">4 用户注销模块</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%A8%E6%88%B7%E6%B3%A8%E9%94%80%E7%9A%84%E8%AF%B7%E6%B1%82vo"><span class="nav-number">1.6.1.</span> <span class="nav-text">用户注销的请求VO</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8userservice%E6%8E%A5%E5%8F%A3%E4%B8%AD%E6%B7%BB%E5%8A%A0%E6%B3%A8%E9%94%80%E6%96%B9%E6%B3%95"><span class="nav-number">1.6.2.</span> <span class="nav-text">在UserService接口中添加注销方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8userserviceimpl%E4%B8%AD%E5%AE%9E%E7%8E%B0%E6%B3%A8%E9%94%80%E6%96%B9%E6%B3%95"><span class="nav-number">1.6.3.</span> <span class="nav-text">在UserServiceImpl中实现注销方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8usercontroller%E4%B8%AD%E6%B7%BB%E5%8A%A0%E6%B3%A8%E9%94%80%E6%8E%A5%E5%8F%A3"><span class="nav-number">1.6.4.</span> <span class="nav-text">在UserController中添加注销接口</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%A8%A1%E5%9D%97"><span class="nav-number">1.7.</span> <span class="nav-text">5 文件上传模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%BE%E7%89%87%E4%B8%8A%E4%BC%A0"><span class="nav-number">1.8.</span> <span class="nav-text">图片上传</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#blogimageservice"><span class="nav-number">1.8.1.</span> <span class="nav-text">BlogImageService</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#blogimageserviceimpl"><span class="nav-number">1.8.2.</span> <span class="nav-text">BlogImageServiceImpl</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#blogimagecontroller"><span class="nav-number">1.8.3.</span> <span class="nav-text">BlogImageController</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8fileservice%E6%8E%A5%E5%8F%A3%E4%B8%AD%E6%B7%BB%E5%8A%A0uploadimage%E6%96%B9%E6%B3%95"><span class="nav-number">1.8.4.</span> <span class="nav-text">在FileService接口中添加uploadImage方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8fileserviceimpl%E4%B8%AD%E5%AE%9E%E7%8E%B0%E5%9B%BE%E7%89%87%E4%B8%8A%E4%BC%A0"><span class="nav-number">1.8.5.</span> <span class="nav-text">在FileServiceImpl中实现图片上传</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8filecontroller%E4%B8%AD%E6%B7%BB%E5%8A%A0%E5%AF%B9%E5%BA%94%E7%9A%84restful%E6%8E%A5%E5%8F%A3"><span class="nav-number">1.8.6.</span> <span class="nav-text">在FileController中添加对应的Restful接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE"><span class="nav-number">1.8.7.</span> <span class="nav-text">添加文件上传相关配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E9%87%8D%E5%A4%8D%E5%A4%84%E7%90%86%E7%9A%84%E6%9E%9A%E4%B8%BE%E7%B1%BBfileconflictstrategy"><span class="nav-number">1.8.8.</span> <span class="nav-text">文件重复处理的枚举类(FileConflictStrategy)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%85%8D%E7%BD%AE%E7%B1%BBfileuploadconfig"><span class="nav-number">1.8.9.</span> <span class="nav-text">创建文件上传配置类(FileUploadConfig)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3-fileservice-%E5%92%8C%E5%AE%9E%E7%8E%B0-fileserviceimpl"><span class="nav-number">1.8.10.</span> <span class="nav-text">创建文件上传服务接口(
FileService )和实现( FileServiceImpl)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%8E%A7%E5%88%B6%E5%99%A8filecontroller"><span class="nav-number">1.8.11.</span> <span class="nav-text">创建文件上传控制器(FileController)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8fileservice%E6%8E%A5%E5%8F%A3%E4%B8%AD%E6%B7%BB%E5%8A%A0%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6%E7%9A%84%E6%96%B9%E6%B3%95"><span class="nav-number">1.8.12.</span> <span class="nav-text">在FileService接口中添加读取文件的方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8fileserviceimpl%E4%B8%AD%E5%AE%9E%E7%8E%B0%E8%AF%BB%E5%8F%96markdown%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9%E7%9A%84%E6%96%B9%E6%B3%95"><span class="nav-number">1.8.13.</span> <span class="nav-text">在FileServiceImpl中实现读取Markdown文件内容的方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8filecontroller%E4%B8%AD%E6%B7%BB%E5%8A%A0%E8%AF%BB%E5%8F%96markdown%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9%E7%9A%84%E6%8E%A5%E5%8F%A3"><span class="nav-number">1.8.14.</span> <span class="nav-text">在FileController中添加读取Markdown文件内容的接口</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%9A%E5%AE%A2%E5%86%85%E5%AE%B9%E7%AE%A1%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1"><span class="nav-number">1.9.</span> <span class="nav-text">博客内容管理数据库设计</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8D%9A%E5%AE%A2%E6%96%87%E7%AB%A0%E8%A1%A8-blog_post"><span class="nav-number">1.9.1.</span> <span class="nav-text">博客文章表 (blog_post)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8D%9A%E5%AE%A2%E5%88%86%E7%B1%BB%E8%A1%A8-blog_category"><span class="nav-number">1.9.2.</span> <span class="nav-text">博客分类表 (blog_category)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8D%9A%E5%AE%A2%E6%A0%87%E7%AD%BE%E8%A1%A8-blog_tag"><span class="nav-number">1.9.3.</span> <span class="nav-text">博客标签表 (blog_tag)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8D%9A%E5%AE%A2%E6%96%87%E7%AB%A0%E6%A0%87%E7%AD%BE%E5%85%B3%E8%81%94%E8%A1%A8-blog_post_tag"><span class="nav-number">1.9.4.</span> <span class="nav-text">博客文章标签关联表
(blog_post_tag)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%B7%E6%B1%82vo"><span class="nav-number">1.9.5.</span> <span class="nav-text">请求VO</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8D%9A%E5%AE%A2%E6%96%87%E7%AB%A0%E5%88%9B%E5%BB%BA%E8%AF%B7%E6%B1%82vo"><span class="nav-number">1.9.5.1.</span> <span class="nav-text">博客文章创建请求VO</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8D%9A%E5%AE%A2%E6%96%87%E7%AB%A0%E6%9B%B4%E6%96%B0%E8%AF%B7%E6%B1%82vo"><span class="nav-number">1.9.5.2.</span> <span class="nav-text">博客文章更新请求VO</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8D%9A%E5%AE%A2%E5%88%86%E7%B1%BB%E8%AF%B7%E6%B1%82vo"><span class="nav-number">1.9.5.3.</span> <span class="nav-text">博客分类请求VO</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%8D%9A%E5%AE%A2%E6%A0%87%E7%AD%BE%E8%AF%B7%E6%B1%82vo"><span class="nav-number">1.9.5.4.</span> <span class="nav-text">创建博客标签请求VO</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%93%8D%E5%BA%94vo"><span class="nav-number">1.9.6.</span> <span class="nav-text">响应VO</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8D%9A%E5%AE%A2%E6%96%87%E7%AB%A0%E5%88%97%E8%A1%A8%E5%93%8D%E5%BA%94vo"><span class="nav-number">1.9.6.1.</span> <span class="nav-text">博客文章列表响应VO</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8D%9A%E5%AE%A2%E6%96%87%E7%AB%A0%E8%AF%A6%E6%83%85%E5%93%8D%E5%BA%94vo"><span class="nav-number">1.9.6.2.</span> <span class="nav-text">博客文章详情响应VO</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8D%9A%E5%AE%A2%E5%88%86%E7%B1%BBvo"><span class="nav-number">1.9.6.3.</span> <span class="nav-text">博客分类VO</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8D%9A%E5%AE%A2%E6%A0%87%E7%AD%BEvo"><span class="nav-number">1.9.6.4.</span> <span class="nav-text">博客标签VO</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E5%8F%82%E6%95%B0vo"><span class="nav-number">1.9.7.</span> <span class="nav-text">查询参数VO</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E4%BD%93%E7%B1%BB%E5%92%8Cmapper%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="nav-number">1.9.8.</span> <span class="nav-text">实体类和Mapper接口设计</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8D%9A%E5%AE%A2%E6%96%87%E7%AB%A0mapper%E6%8E%A5%E5%8F%A3-blogpostmapper"><span class="nav-number">1.9.8.1.</span> <span class="nav-text">博客文章Mapper接口
(BlogPostMapper)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8D%9A%E5%AE%A2%E5%88%86%E7%B1%BBmapper%E6%8E%A5%E5%8F%A3-blogcategorymapper"><span class="nav-number">1.9.8.2.</span> <span class="nav-text">博客分类Mapper接口
(BlogCategoryMapper)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8D%9A%E5%AE%A2%E6%A0%87%E7%AD%BEmapper%E6%8E%A5%E5%8F%A3-blogtagmapper"><span class="nav-number">1.9.8.3.</span> <span class="nav-text">博客标签Mapper接口
(BlogTagMapper)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8D%9A%E5%AE%A2%E6%96%87%E7%AB%A0%E6%A0%87%E7%AD%BE%E5%85%B3%E8%81%94mapper%E6%8E%A5%E5%8F%A3-blogposttagmapper"><span class="nav-number">1.9.8.4.</span> <span class="nav-text">博客文章标签关联Mapper接口
(BlogPostTagMapper)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#blogpostmapper.xml%E5%AE%9E%E7%8E%B0%E5%A4%8D%E6%9D%82%E7%9A%84%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.9.8.5.</span> <span class="nav-text">BlogPostMapper.xml实现复杂的查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#blogpostcontroller"><span class="nav-number">1.9.8.6.</span> <span class="nav-text">BlogPostController</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#blogpostservice"><span class="nav-number">1.9.8.7.</span> <span class="nav-text">BlogPostService</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#blogpostserviceimpl"><span class="nav-number">1.9.8.8.</span> <span class="nav-text">BlogPostServiceImpl</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#blogcategorycontroller"><span class="nav-number">1.9.8.9.</span> <span class="nav-text">BlogCategoryController</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#blogcategoryservice"><span class="nav-number">1.9.8.10.</span> <span class="nav-text">BlogCategoryService</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#blogcategoryserviceimpl"><span class="nav-number">1.9.8.11.</span> <span class="nav-text">BlogCategoryServiceImpl</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#blogtagcontroller"><span class="nav-number">1.9.8.12.</span> <span class="nav-text">BlogTagController</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#blogtagservice"><span class="nav-number">1.9.8.13.</span> <span class="nav-text">BlogTagService</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#blogtagserviceimpl"><span class="nav-number">1.9.8.14.</span> <span class="nav-text">BlogTagServiceImpl</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%89%8D%E7%AB%AF"><span class="nav-number">2.</span> <span class="nav-text">前端</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A41%E6%9B%B4%E6%96%B0%E5%B7%A6%E4%BE%A7%E8%8F%9C%E5%8D%95"><span class="nav-number">2.0.1.</span> <span class="nav-text">步骤1：更新左侧菜单</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A42%E6%B7%BB%E5%8A%A0api%E5%B0%81%E8%A3%85"><span class="nav-number">2.0.2.</span> <span class="nav-text">步骤2：添加API封装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A43%E5%88%9B%E5%BB%BA%E5%8D%9A%E5%AE%A2%E7%AE%A1%E7%90%86%E8%A7%86%E5%9B%BE%E7%BB%84%E4%BB%B6"><span class="nav-number">2.0.3.</span> <span class="nav-text">步骤3：创建博客管理视图组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A44%E6%9B%B4%E6%96%B0%E8%B7%AF%E7%94%B1%E9%85%8D%E7%BD%AE"><span class="nav-number">2.0.4.</span> <span class="nav-text">步骤4：更新路由配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A45%E5%AE%9E%E7%8E%B0%E5%90%84%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97"><span class="nav-number">2.0.5.</span> <span class="nav-text">步骤5：实现各功能模块</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#v-md-editor"><span class="nav-number">2.1.</span> <span class="nav-text">v-md-editor</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%9A%E5%AE%A2%E7%AE%A1%E7%90%86%E8%8F%9C%E5%8D%95%E9%A1%B9"><span class="nav-number">2.2.</span> <span class="nav-text">博客管理菜单项</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%9A%E5%AE%A2%E7%AE%A1%E7%90%86%E8%B7%AF%E7%94%B1"><span class="nav-number">2.3.</span> <span class="nav-text">博客管理路由</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9C%A8-apis.js-%E4%B8%AD%E6%B7%BB%E5%8A%A0%E5%8D%9A%E5%AE%A2%E7%9B%B8%E5%85%B3%E7%9A%84api%E5%B0%81%E8%A3%85"><span class="nav-number">2.4.</span> <span class="nav-text">在 apis.js
中添加博客相关的API封装</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9C%A8-axiosconfig.js-%E4%B8%AD%E6%B7%BB%E5%8A%A0%E8%AF%B7%E6%B1%82%E5%92%8C%E5%93%8D%E5%BA%94%E6%8B%A6%E6%88%AA%E5%99%A8%E6%9D%A5%E8%AE%B0%E5%BD%95%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF"><span class="nav-number">2.5.</span> <span class="nav-text">在
axiosConfig.js 中添加请求和响应拦截器来记录详细信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%8D%9A%E5%AE%A2%E6%96%87%E7%AB%A0%E5%88%97%E8%A1%A8%E7%BB%84%E4%BB%B6blogposts.vue"><span class="nav-number">2.6.</span> <span class="nav-text">创建博客文章列表组件（BlogPosts.vue）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%9A%E5%AE%A2%E6%96%87%E7%AB%A0%E7%BC%96%E8%BE%91%E7%BB%84%E4%BB%B6blogpostedit.vue"><span class="nav-number">2.7.</span> <span class="nav-text">博客文章编辑组件(BlogPostEdit.vue)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#section"><span class="nav-number">2.7.0.1.</span> <span class="nav-text"></span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%9A%E5%AE%A2%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86%E7%BB%84%E4%BB%B6blogcategories.vue"><span class="nav-number">2.8.</span> <span class="nav-text">博客分类管理组件(BlogCategories.vue)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%9A%E5%AE%A2%E6%A0%87%E7%AD%BE%E7%AE%A1%E7%90%86%E7%BB%84%E4%BB%B6blogtags.vue"><span class="nav-number">2.9.</span> <span class="nav-text">博客标签管理组件(BlogTags.vue)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%9A%E5%AE%A2%E5%9B%9E%E6%94%B6%E7%AB%99%E7%BB%84%E4%BB%B6blogrecycle.vue"><span class="nav-number">2.10.</span> <span class="nav-text">博客回收站组件(BlogRecycle.vue)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95"><span class="nav-number">2.11.</span> <span class="nav-text">用户登录</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BD%AE%E6%92%AD%E5%9B%BE%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1"><span class="nav-number">2.12.</span> <span class="nav-text">轮播图数据库设计</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="LuoTao"
      src="/images/author.jpg">
  <p class="site-author-name" itemprop="name">LuoTao</p>
  <div class="site-description" itemprop="description"><font color="#FFFFFF">Best Tao.</font></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">46</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://wx.qq.com/" title="微信 → https:&#x2F;&#x2F;wx.qq.com&#x2F;" rel="noopener" target="_blank"><i class="weixin fa-fw"></i>微信</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://user.qzone.qq.com/3452255853" title="QQ → https:&#x2F;&#x2F;user.qzone.qq.com&#x2F;3452255853" rel="noopener" target="_blank"><i class="QQ fa-fw"></i>QQ</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://github.com/luotaofun" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;luotaofun" rel="noopener" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:luotao0213@163.com" title="E-Mail → mailto:luotao0213@163.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/luotaofun" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://luotaofun.github.io/2025/03/29/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/author.jpg">
      <meta itemprop="name" content="LuoTao">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Taoの博客">
      <meta itemprop="description" content="<font color="#FFFFFF">Best Tao.</font>">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="个人博客系统 | Taoの博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          个人博客系统
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-03-29 15:18:34" itemprop="dateCreated datePublished" datetime="2025-03-29T15:18:34+08:00">2025-03-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-06-14 07:46:18" itemprop="dateModified" datetime="2025-06-14T07:46:18+08:00">2025-06-14</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="个人博客系统">个人博客系统</h1>
<blockquote>
<p>首先第一步，你要扫描整个项目用到的技术栈，除了已经用到的技术栈以外，其他技术暂时不考虑引入，就利用现有的技术栈去实现代码编写。
你先梳理整个项目的现有文件结构，<code>src\main\resources\application.yaml</code>这个是项目的配置文件，你需要创建一个目录扫描来查看现有的项目结构以便更好地规划代码结构，避免重复创建已有的组件。</p>
</blockquote>
<h2 id="项目简介">项目简介</h2>
<p>这是一个基于Spring
Boot的个人博客系统，提供博客内容管理、用户管理等功能。</p>
<h2 id="技术栈">技术栈</h2>
<ul>
<li>核心框架：Spring Boot 2.7.6</li>
<li>数据访问：MyBatis-Plus 3.5.5</li>
<li>数据库：MySQL 8.0.33</li>
<li>接口文档：Knife4j 3.0.3</li>
<li>参数校验：Spring Validation</li>
<li>开发工具：Lombok, DevTools</li>
</ul>
<h2 id="用户注册登录模块">1 用户注册登录模块</h2>
<h3 id="创建用户表user表">创建用户表（user表）</h3>
<blockquote>
<p>解释一下该表的设计思路。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `user` (</span><br><span class="line">    `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT &#x27;使用bigint作为主键，考虑到用户数据的增长性&#x27;,</span><br><span class="line">    `username` varchar(50) NOT NULL COMMENT &#x27;用户名作为登录标识，设置唯一索引防止重复&#x27;,</span><br><span class="line">    `password` varchar(100) NOT NULL COMMENT &#x27;使用varchar(100)预留足够长度存储加密后的密码&#x27;,</span><br><span class="line">    `nickname` varchar(50) DEFAULT NULL COMMENT &#x27;与username分开，用户可以自定义显示名称，默认使用username&#x27;,</span><br><span class="line">    `email` varchar(100) NOT NULL COMMENT &#x27;邮箱也设为唯一，可用于找回密码等功能&#x27;,</span><br><span class="line">    `avatar` varchar(255) DEFAULT NULL COMMENT &#x27;存储头像URL，便于用户个性化&#x27;,</span><br><span class="line">    `status` tinyint(1) DEFAULT 1 COMMENT &#x27;使用tinyint(1)，便于系统管理用户状态（启用/禁用）&#x27;,</span><br><span class="line">    `role` varchar(20) DEFAULT &#x27;USER&#x27; COMMENT &#x27;区分普通用户和管理员，为后续权限管理做准备&#x27;,</span><br><span class="line">    `last_login` datetime DEFAULT NULL COMMENT &#x27;记录用户最后登录时间，可用于数据分析和安全监控&#x27;,</span><br><span class="line">    `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#x27;记录创建时间，自动设置为当前时间&#x27;,</span><br><span class="line">    `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT &#x27;自动更新，用于记录数据变更&#x27;,</span><br><span class="line">    PRIMARY KEY (`id`),</span><br><span class="line">    UNIQUE KEY `uk_username` (`username`),</span><br><span class="line">    UNIQUE KEY `uk_email` (`email`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT=&#x27;用户表&#x27;;</span><br></pre></td></tr></table></figure>
<h3 id="创建实体类user.java">创建实体类（User.java）</h3>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">基于MyBatis-<span class="keyword">Plus</span>和Lombok的特性，以及数据库表的设计,开始创建实体类。同时给出实体类设计说明。</span><br></pre></td></tr></table></figure>
<blockquote>
<p>实体类设计说明：</p>
<p>使用注解：</p>
<p><span class="citation" data-cites="Data">@Data</span>:
Lombok注解，自动生成getter、setter、toString等方法</p>
<p><span class="citation" data-cites="TableName">@TableName</span>:
MyBatis-Plus注解，指定对应的数据库表名</p>
<p><span class="citation" data-cites="TableId">@TableId</span>:
指定主键生成策略为自增</p>
<p>字段类型：</p>
<p>使用包装类型 Boolean 而不是 boolean，允许为null</p>
<p>时间类型使用 LocalDateTime，更适合处理日期时间</p>
<p>主键使用 Long 类型，对应数据库的 bigint</p>
<p>字段说明：</p>
<p>每个字段都添加了注释，便于代码维护</p>
<p>字段名称采用驼峰命名，MyBatis-Plus会自动转换为下划线命名</p>
<p>安全性：</p>
<p>密码字段虽然在实体类中可见，但在后续VO转换时会被过滤</p>
<p>接下来，我们要创建视图对象（VO），视图对象会根据不同的业务场景（注册、登录、信息展示）来设计不同的字段。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.luotao.job.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.IdType;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableId;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableName;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> luotao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 用户实体类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024-1-2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName(&quot;user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 主键ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@TableId(type = IdType.AUTO)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 密码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 昵称</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String nickname;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 邮箱</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 头像URL</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String avatar;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户状态(1:正常,0:禁用)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Boolean status;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户角色(USER:普通用户,ADMIN:管理员)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String role;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 最后登录时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime lastLogin;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createTime;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updateTime;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="创建视图对象userregistervo.java-userloginvo.java-userinfovo.java">创建视图对象（UserRegisterVo.java,
UserLoginVo.java, UserInfoVo.java）</h3>
<blockquote>
<p>创建三个VO类：注册、登录和信息展示。</p>
<p>VO类设计说明：</p>
<ol type="1">
<li><p>参数校验：</p>
<ul>
<li><p>使用@NotBlank注解确保必填字段不为空</p></li>
<li><p>使用@Size注解限制字段长度</p></li>
<li><p>使用@Email注解验证邮箱格式</p></li>
</ul></li>
<li><p>安全性考虑：</p>
<ul>
<li><p>UserInfoVo不包含密码等敏感信息</p></li>
<li><p>注册时要求确认密码</p></li>
<li><p>登录只需要用户名和密码</p></li>
</ul></li>
<li><p>数据展示：</p>
<ul>
<li><p>UserInfoVo包含了用户的基本信息，用于前端展示</p></li>
<li><p>去掉了不需要展示给用户的字段（如status）</p></li>
</ul></li>
<li><p>使用Lombok：</p>
<ul>
<li>使用@Data注解简化代码</li>
</ul></li>
</ol>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.luotao.job.vo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.Email;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.NotBlank;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.Size;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> luotao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 用户注册请求VO</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserRegisterVo</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;用户名不能为空&quot;)</span></span><br><span class="line">    <span class="meta">@Size(min = 4, max = 20, message = &quot;用户名长度必须在4-20个字符之间&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 密码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;密码不能为空&quot;)</span></span><br><span class="line">    <span class="meta">@Size(min = 6, max = 20, message = &quot;密码长度必须在6-20个字符之间&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 确认密码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;确认密码不能为空&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String confirmPassword;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 邮箱</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;邮箱不能为空&quot;)</span></span><br><span class="line">    <span class="meta">@Email(message = &quot;邮箱格式不正确&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 昵称（选填）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String nickname;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.luotao.job.vo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.NotBlank;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> luotao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 用户登录请求VO</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserLoginVo</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;用户名不能为空&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 密码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;密码不能为空&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.luotao.job.vo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> luotao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 用户信息响应VO</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserInfoVo</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 昵称</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String nickname;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 邮箱</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 头像URL</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String avatar;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户角色</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String role;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 最后登录时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime lastLogin;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createTime;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<h3 id="创建mapper接口">创建Mapper接口</h3>
<blockquote>
<p>这个Mapper接口的设计说明：</p>
<ol type="1">
<li><p>继承关系：</p>
<ul>
<li><p>继承<code>BaseMapper&lt;User&gt;</code>获得基础的CRUD操作方法</p></li>
<li><p>泛型参数User指定了操作的实体类</p></li>
</ul></li>
<li><p>注解说明：</p>
<ul>
<li><span class="citation" data-cites="Mapper注解让">@Mapper注解让</span><code>MyBatis</code>自动扫描到这个接口</li>
</ul></li>
<li><p>功能特点：</p>
<ul>
<li><p>通过继承<code>BaseMapper</code>，自动获得常用的数据库操作方法</p></li>
<li><p>无需编写基础的SQL语句,如果需要自定义复杂查询，可以后续添加自定义方法</p></li>
</ul></li>
</ol>
<p>由于使用了MyBatis-Plus，这个简单的Mapper接口就能满足基本的用户管理需求。如果后续需要特殊的查询方法（比如根据用户名或邮箱查询），我们可以再添加相应的方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.luotao.job.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.domain.User;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> luotao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 用户Mapper接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;User&gt; &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * BaseMapper提供了基础的CRUD方法:</span></span><br><span class="line"><span class="comment">     * - insert: 插入一条记录</span></span><br><span class="line"><span class="comment">     * - deleteById: 根据ID删除</span></span><br><span class="line"><span class="comment">     * - updateById: 根据ID更新</span></span><br><span class="line"><span class="comment">     * - selectById: 根据ID查询</span></span><br><span class="line"><span class="comment">     * - selectList: 查询列表</span></span><br><span class="line"><span class="comment">     * - selectCount: 查询总记录数</span></span><br><span class="line"><span class="comment">     * 等等...</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="创建service接口和实现类">创建Service接口和实现类</h3>
<blockquote>
<p>服务层设计说明：</p>
<ol type="1">
<li><p>接口设计：</p>
<p>定义了三个主要方法：注册、登录和获取用户信息</p>
<p>使用ResponseResult统一返回格式</p>
<p>方法参数和返回值都使用VO对象</p></li>
<li><p>实现类特点：</p>
<p>继承ServiceImpl获得MyBatis-Plus的服务能力</p>
<p>使用@Slf4j注解添加日志支持</p>
<p>使用@Service注解标记为服务类</p></li>
<li><p>业务逻辑：</p>
<p>注册时进行多重校验（密码一致性、用户名唯一、邮箱唯一）</p>
<p>登录时验证用户状态和密码</p>
<p>密码使用MD5加密存储</p>
<p>使用BeanUtils.copyProperties进行对象属性拷贝</p></li>
<li><p>安全性考虑：</p>
<p>密码加密存储</p>
<p>统一的错误信息（不暴露具体原因）</p>
<p>状态检查（如用户是否被禁用）</p></li>
</ol>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.luotao.job.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.luotao.job.vo.UserLoginVo;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.vo.UserRegisterVo;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.vo.UserInfoVo;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.utils.ResponseResult;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> luotao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 用户服务接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户注册</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> registerVo 注册信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 注册结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ResponseResult <span class="title function_">register</span><span class="params">(UserRegisterVo registerVo)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户登录</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> loginVo 登录信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 登录结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ResponseResult <span class="title function_">login</span><span class="params">(UserLoginVo loginVo)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取用户信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId 用户ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 用户信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ResponseResult&lt;UserInfoVo&gt; <span class="title function_">getUserInfo</span><span class="params">(Long userId)</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.luotao.job.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.entity.User;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.mapper.UserMapper;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.service.UserService;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.utils.ResponseResult;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.vo.UserLoginVo;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.vo.UserRegisterVo;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.vo.UserInfoVo;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeanUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.DigestUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> luotao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 用户服务实现类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;UserMapper, User&gt; <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">register</span><span class="params">(UserRegisterVo registerVo)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 校验两次密码是否一致</span></span><br><span class="line">        <span class="keyword">if</span> (!registerVo.getPassword().equals(registerVo.getConfirmPassword())) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>(<span class="number">400</span>, <span class="string">&quot;两次密码不一致&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 校验用户名是否已存在：构建一个查询条件，要求 User 表中的 username 字段等于 registerVo.getUsername() 的值</span></span><br><span class="line">        LambdaQueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(User::getUsername, registerVo.getUsername());</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.count(queryWrapper) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>(<span class="number">400</span>, <span class="string">&quot;用户名已存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. 校验邮箱是否已存在</span></span><br><span class="line">        queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(User::getEmail, registerVo.getEmail());</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.count(queryWrapper) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>(<span class="number">400</span>, <span class="string">&quot;邮箱已被注册&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4. 创建用户实体</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        BeanUtils.copyProperties(registerVo, user); <span class="comment">//根据属性名匹配的方式，将 registerVo 中的非空属性值赋值给 user 对象的对应属性。</span></span><br><span class="line">        <span class="comment">// 设置默认昵称</span></span><br><span class="line">        <span class="keyword">if</span> (user.getNickname() == <span class="literal">null</span>) &#123;</span><br><span class="line">            user.setNickname(user.getUsername());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 密码加密</span></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         调用 registerVo.getPassword() 获取用户输入的明文密码。</span></span><br><span class="line"><span class="comment">         使用 StandardCharsets.UTF_8 将密码字符串转换为字节数组。</span></span><br><span class="line"><span class="comment">         调用 DigestUtils.md5DigestAsHex 方法对密码字节数组进行 MD5 加密，并返回加密后的十六进制字符串。</span></span><br><span class="line"><span class="comment">         将加密后的密码通过 user.setPassword 设置到用户实体对象中。</span></span><br><span class="line"><span class="comment">        **/</span></span><br><span class="line">        user.setPassword(DigestUtils.md5DigestAsHex(</span><br><span class="line">                registerVo.getPassword().getBytes(StandardCharsets.UTF_8)));</span><br><span class="line">        <span class="comment">// 设置其他默认值</span></span><br><span class="line">        user.setStatus(<span class="literal">true</span>);</span><br><span class="line">        user.setRole(<span class="string">&quot;USER&quot;</span>);</span><br><span class="line">        user.setCreateTime(LocalDateTime.now());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5. 保存用户。</span></span><br><span class="line">        <span class="built_in">this</span>.save(user);<span class="comment">//save 方法会根据传入的实体对象 user，将其插入到对应的数据库表中</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>(<span class="number">200</span>, <span class="string">&quot;注册成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">login</span><span class="params">(UserLoginVo loginVo)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 查询用户</span></span><br><span class="line">        LambdaQueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(User::getUsername, loginVo.getUsername());</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="built_in">this</span>.getOne(queryWrapper);<span class="comment">//根据查询条件从数据库中查找一条记录。</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 校验用户是否存在</span></span><br><span class="line">        <span class="keyword">if</span> (user == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>(<span class="number">400</span>, <span class="string">&quot;用户名或密码错误&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. 校验密码。对用户登录时输入的密码进行加密后与数据库中存储的密码进行比对。</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">encryptedPassword</span> <span class="operator">=</span> DigestUtils.md5DigestAsHex(</span><br><span class="line">                loginVo.getPassword().getBytes(StandardCharsets.UTF_8));</span><br><span class="line">        <span class="keyword">if</span> (!user.getPassword().equals(encryptedPassword)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>(<span class="number">400</span>, <span class="string">&quot;用户名或密码错误&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4. 校验用户状态</span></span><br><span class="line">        <span class="keyword">if</span> (!user.getStatus()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>(<span class="number">400</span>, <span class="string">&quot;账号已被禁用&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5. 更新登录时间</span></span><br><span class="line">        user.setLastLogin(LocalDateTime.now());</span><br><span class="line">        <span class="built_in">this</span>.updateById(user);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 6. 返回用户信息</span></span><br><span class="line">        <span class="type">UserInfoVo</span> <span class="variable">userInfoVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserInfoVo</span>();</span><br><span class="line">        BeanUtils.copyProperties(user, userInfoVo);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>(userInfoVo);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult&lt;UserInfoVo&gt; <span class="title function_">getUserInfo</span><span class="params">(Long userId)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 查询用户</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="built_in">this</span>.getById(userId);<span class="comment">//根据主键 ID 查询单个实体对象</span></span><br><span class="line">        <span class="keyword">if</span> (user == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>(<span class="number">400</span>, <span class="string">&quot;用户不存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 转换为VO对象</span></span><br><span class="line">        <span class="type">UserInfoVo</span> <span class="variable">userInfoVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserInfoVo</span>();</span><br><span class="line">        BeanUtils.copyProperties(user, userInfoVo);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>(userInfoVo);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<h3 id="创建controller">创建Controller</h3>
<blockquote>
<p>Controller设计说明：</p>
<ol type="1">
<li><p>注解使用：</p>
<p><span class="citation" data-cites="RestController">@RestController</span>:
标记为REST控制器，返回JSON数据</p>
<p><span class="citation" data-cites="RequestMapping">@RequestMapping</span>(“/api/user”):
统一的URL前缀</p>
<p><span class="citation" data-cites="Api">@Api</span>(tags =
“用户管理接口”): Swagger文档标签</p>
<p><span class="citation" data-cites="Slf4j">@Slf4j</span>:
添加日志支持</p>
<p><span class="citation" data-cites="Validated">@Validated</span>:
开启参数校验</p></li>
<li><p>接口设计：</p>
<p>注册：POST /api/user/register</p>
<p>登录：POST /api/user/login</p>
<p>获取用户信息：GET /api/user/{userId}</p>
<p>参数处理：</p>
<p><span class="citation" data-cites="RequestBody">@RequestBody</span>:
处理JSON请求体</p>
<p><span class="citation" data-cites="PathVariable">@PathVariable</span>: 处理路径参数</p>
<p><span class="citation" data-cites="Validated">@Validated</span>:
启用VO中的参数校验</p></li>
<li><p>日志记录：</p>
<p>每个方法都添加了日志记录</p>
<p>记录请求参数，便于问题排查</p></li>
<li><p>接口文档：</p>
<p>使用Swagger注解标注接口信息</p>
<p>每个方法都有清晰的注释</p></li>
</ol>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.luotao.job.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.luotao.job.service.UserService;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.utils.ResponseResult;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.vo.UserLoginVo;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.vo.UserRegisterVo;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.vo.UserInfoVo;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.validation.annotation.Validated;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> luotao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 用户控制器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/user&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;用户管理接口&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户注册</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> registerVo 注册信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 注册结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/register&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;用户注册&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">register</span><span class="params">(<span class="meta">@Validated</span> <span class="meta">@RequestBody</span> UserRegisterVo registerVo)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;用户注册，注册信息：&#123;&#125;&quot;</span>, registerVo);</span><br><span class="line">        <span class="keyword">return</span> userService.register(registerVo);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户登录</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> loginVo 登录信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 登录结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;用户登录&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">login</span><span class="params">(<span class="meta">@Validated</span> <span class="meta">@RequestBody</span> UserLoginVo loginVo)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;用户登录，登录信息：&#123;&#125;&quot;</span>, loginVo);</span><br><span class="line">        <span class="keyword">return</span> userService.login(loginVo);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取用户信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId 用户ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 用户信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;userId&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;获取用户信息&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult&lt;UserInfoVo&gt; <span class="title function_">getUserInfo</span><span class="params">(<span class="meta">@PathVariable</span> Long userId)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;获取用户信息，用户ID：&#123;&#125;&quot;</span>, userId);</span><br><span class="line">        <span class="keyword">return</span> userService.getUserInfo(userId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<h2 id="修改密码模块">2 修改密码模块</h2>
<blockquote>
<p>修改密码功能的设计说明：</p>
<ol type="1">
<li><p>安全性考虑：</p>
<p>需要验证旧密码</p>
<p>新密码需要确认</p>
<p>密码继续使用MD5加密存储</p></li>
<li><p>参数校验：</p>
<p>所有密码字段都不能为空</p>
<p>新密码长度限制在6-20个字符</p></li>
<li><p>接口设计：</p>
<p>使用PUT方法表示更新操作</p>
<p>URL格式：PUT /api/user/{userId}/password</p>
<p>需要在路径中指定用户ID</p></li>
<li><p>业务逻辑：</p>
<p>校验新密码两次输入是否一致</p>
<p>验证用户是否存在</p>
<p>验证旧密码是否正确</p>
<p>加密新密码并更新</p></li>
</ol>
</blockquote>
<h3 id="修改密码的vo类updatepasswordvo.javanew">修改密码的VO类UpdatePasswordVo.java(new)</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.luotao.job.vo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.NotBlank;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.Size;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> luotao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 修改密码请求VO</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UpdatePasswordVo</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 旧密码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;旧密码不能为空&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String oldPassword;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 新密码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;新密码不能为空&quot;)</span></span><br><span class="line">    <span class="meta">@Size(min = 6, max = 20, message = &quot;密码长度必须在6-20个字符之间&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String newPassword;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 确认新密码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;确认密码不能为空&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String confirmPassword;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<h3 id="在userservice接口中添加修改密码的方法">在UserService接口中添加修改密码的方法</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 修改密码</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> userId 用户ID</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> updatePasswordVo 修改密码信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 修改结果</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">ResponseResult <span class="title function_">updatePassword</span><span class="params">(Long userId, UpdatePasswordVo updatePasswordVo)</span>;</span><br></pre></td></tr></table></figure>
<h3 id="在userserviceimpl中实现修改密码的方法">在UserServiceImpl中实现修改密码的方法</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">updatePassword</span><span class="params">(Long userId, UpdatePasswordVo updatePasswordVo)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 校验新密码与确认密码是否一致</span></span><br><span class="line">        <span class="keyword">if</span> (!updatePasswordVo.getNewPassword().equals(updatePasswordVo.getConfirmPassword())) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>(<span class="number">400</span>, <span class="string">&quot;两次输入的新密码不一致&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 获取用户信息</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="built_in">this</span>.getById(userId);</span><br><span class="line">        <span class="keyword">if</span> (user == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>(<span class="number">400</span>, <span class="string">&quot;用户不存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. 校验旧密码是否正确</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">oldEncryptedPassword</span> <span class="operator">=</span> DigestUtils.md5DigestAsHex(</span><br><span class="line">                updatePasswordVo.getOldPassword().getBytes(StandardCharsets.UTF_8));</span><br><span class="line">        <span class="keyword">if</span> (!user.getPassword().equals(oldEncryptedPassword)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>(<span class="number">400</span>, <span class="string">&quot;旧密码错误&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4. 更新密码</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">newEncryptedPassword</span> <span class="operator">=</span> DigestUtils.md5DigestAsHex(</span><br><span class="line">                updatePasswordVo.getNewPassword().getBytes(StandardCharsets.UTF_8));</span><br><span class="line">        user.setPassword(newEncryptedPassword);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 5. 保存更新</span></span><br><span class="line">        <span class="built_in">this</span>.updateById(user);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>(<span class="number">200</span>, <span class="string">&quot;密码修改成功&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="在usercontroller中添加修改密码的接口">在UserController中添加修改密码的接口</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 修改密码</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> userId 用户ID</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> updatePasswordVo 修改密码信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 修改结果</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PutMapping(&quot;/&#123;userId&#125;/password&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;修改密码&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">updatePassword</span><span class="params">(</span></span><br><span class="line"><span class="params">        <span class="meta">@PathVariable</span> Long userId,</span></span><br><span class="line"><span class="params">        <span class="meta">@Validated</span> <span class="meta">@RequestBody</span> UpdatePasswordVo updatePasswordVo)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;修改密码，用户ID：&#123;&#125;，修改密码信息：&#123;&#125;&quot;</span>, userId, updatePasswordVo);</span><br><span class="line">    <span class="keyword">return</span> userService.updatePassword(userId, updatePasswordVo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="更新用户信息模块">3 更新用户信息模块</h2>
<blockquote>
<p>更新用户信息功能的设计说明：</p>
<ol type="1">
<li><p>字段更新：</p>
<p>支持部分更新，只更新提供的字段</p>
<p>使用needUpdate标记是否需要执行数据库更新</p></li>
<li><p>数据校验：</p>
<p>邮箱格式验证</p>
<p>昵称长度限制</p>
<p>邮箱唯一性检查（排除当前用户）</p></li>
<li><p>接口设计：</p>
<p>使用PUT方法表示更新操作</p>
<p>URL格式：PUT /api/user/{userId}</p>
<p>返回更新后的完整用户信息</p></li>
<li><p>业务逻辑：</p>
<p>验证用户是否存在</p>
<p>校验邮箱唯一性</p>
<p>按需更新字段</p>
<p>返回更新后的用户信息</p></li>
</ol>
</blockquote>
<h3 id="更新用户信息的vo类">更新用户信息的VO类</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.luotao.job.vo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.Email;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.Size;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> luotao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 更新用户信息请求VO</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UpdateUserInfoVo</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 昵称</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Size(max = 50, message = &quot;昵称长度不能超过50个字符&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String nickname;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 邮箱</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Email(message = &quot;邮箱格式不正确&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 头像URL</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String avatar;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<h3 id="在userservice接口中添加更新用户信息的方法">在UserService接口中添加更新用户信息的方法</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 更新用户信息</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> userId 用户ID</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> updateUserInfoVo 更新的用户信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 更新结果</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">ResponseResult&lt;UserInfoVo&gt; <span class="title function_">updateUserInfo</span><span class="params">(Long userId, UpdateUserInfoVo updateUserInfoVo)</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="在userserviceimpl中实现更新用户信息的方法">在UserServiceImpl中实现更新用户信息的方法</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult&lt;UserInfoVo&gt; <span class="title function_">updateUserInfo</span><span class="params">(Long userId, UpdateUserInfoVo updateUserInfoVo)</span> &#123;</span><br><span class="line">    <span class="comment">// 1. 获取用户信息</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="built_in">this</span>.getById(userId);</span><br><span class="line">    <span class="keyword">if</span> (user == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(<span class="number">400</span>, <span class="string">&quot;用户不存在&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 校验邮箱是否被其他用户使用（排除当前用户）</span></span><br><span class="line">    <span class="keyword">if</span> (updateUserInfoVo.getEmail() != <span class="literal">null</span> &amp;&amp; !updateUserInfoVo.getEmail().equals(user.getEmail())) &#123;</span><br><span class="line">        LambdaQueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(User::getEmail, updateUserInfoVo.getEmail());</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.count(queryWrapper) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(<span class="number">400</span>, <span class="string">&quot;邮箱已被其他用户使用&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 更新用户信息</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">needUpdate</span> <span class="operator">=</span> <span class="literal">false</span>;<span class="comment">//使用needUpdate标记是否需要执行数据库更新</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (updateUserInfoVo.getNickname() != <span class="literal">null</span>) &#123;</span><br><span class="line">        user.setNickname(updateUserInfoVo.getNickname());</span><br><span class="line">        needUpdate = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (updateUserInfoVo.getEmail() != <span class="literal">null</span>) &#123;</span><br><span class="line">        user.setEmail(updateUserInfoVo.getEmail());</span><br><span class="line">        needUpdate = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (updateUserInfoVo.getAvatar() != <span class="literal">null</span>) &#123;</span><br><span class="line">        user.setAvatar(updateUserInfoVo.getAvatar());</span><br><span class="line">        needUpdate = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. 保存更新</span></span><br><span class="line">    <span class="keyword">if</span> (needUpdate) &#123;</span><br><span class="line">        <span class="built_in">this</span>.updateById(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5. 返回更新后的用户信息</span></span><br><span class="line">    <span class="type">UserInfoVo</span> <span class="variable">userInfoVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserInfoVo</span>();</span><br><span class="line">    BeanUtils.copyProperties(user, userInfoVo);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(userInfoVo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="在usercontroller中添加更新用户信息的接口">在UserController中添加更新用户信息的接口</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 更新用户信息</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> userId 用户ID</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> updateUserInfoVo 更新的用户信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 更新结果</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PutMapping(&quot;/&#123;userId&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;更新用户信息&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult&lt;UserInfoVo&gt; <span class="title function_">updateUserInfo</span><span class="params">(</span></span><br><span class="line"><span class="params">        <span class="meta">@PathVariable</span> Long userId,</span></span><br><span class="line"><span class="params">        <span class="meta">@Validated</span> <span class="meta">@RequestBody</span> UpdateUserInfoVo updateUserInfoVo)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;更新用户信息，用户ID：&#123;&#125;，更新信息：&#123;&#125;&quot;</span>, userId, updateUserInfoVo);</span><br><span class="line">    <span class="keyword">return</span> userService.updateUserInfo(userId, updateUserInfoVo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="用户注销模块">4 用户注销模块</h2>
<blockquote>
<p>软删除：将用户状态设置为禁用</p>
<p>硬删除：直接从数据库中删除用户数据</p>
<p>考虑到数据安全和可恢复性，我们采用软删除的方式。</p>
<p>注销功能的设计说明：</p>
<ol type="1">
<li><p>安全性考虑：</p>
<p>需要验证用户密码，防止他人恶意注销</p>
<p>管理员账号不允许注销</p>
<p>使用软删除而不是硬删除</p></li>
<li><p>接口设计：</p>
<p>使用DELETE方法表示删除操作</p>
<p>URL格式：DELETE /api/user/{userId}</p>
<p>需要在请求体中提供密码验证</p></li>
<li><p>业务逻辑：</p>
<p>验证用户是否存在</p>
<p>验证密码是否正确</p>
<p>检查是否为管理员账号</p>
<p>软删除（设置状态为禁用）</p></li>
<li><p>数据处理：</p>
<p>只修改用户状态，保留用户数据</p>
<p>通过status字段控制用户是否可用</p></li>
</ol>
</blockquote>
<h3 id="用户注销的请求vo">用户注销的请求VO</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.luotao.job.vo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.NotBlank;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> luotao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 注销账号请求VO</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeactivateAccountVo</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 密码（验证身份）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;密码不能为空&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<h3 id="在userservice接口中添加注销方法">在UserService接口中添加注销方法</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 注销用户</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> userId 用户ID</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> password 用户密码（验证身份）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 注销结果</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">ResponseResult <span class="title function_">deactivateAccount</span><span class="params">(Long userId, String password)</span>;</span><br></pre></td></tr></table></figure>
<h3 id="在userserviceimpl中实现注销方法">在UserServiceImpl中实现注销方法</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">deactivateAccount</span><span class="params">(Long userId, String password)</span> &#123;</span><br><span class="line">    <span class="comment">// 1. 获取用户信息</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="built_in">this</span>.getById(userId);</span><br><span class="line">    <span class="keyword">if</span> (user == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>(<span class="number">400</span>, <span class="string">&quot;用户不存在&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 验证用户密码</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">encryptedPassword</span> <span class="operator">=</span> DigestUtils.md5DigestAsHex(</span><br><span class="line">            password.getBytes(StandardCharsets.UTF_8));</span><br><span class="line">    <span class="keyword">if</span> (!user.getPassword().equals(encryptedPassword)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>(<span class="number">400</span>, <span class="string">&quot;密码错误&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 检查是否是管理员账号</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="string">&quot;ADMIN&quot;</span>.equals(user.getRole())) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>(<span class="number">400</span>, <span class="string">&quot;管理员账号不能注销&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. 软删除用户（设置状态为禁用）</span></span><br><span class="line">    user.setStatus(<span class="literal">false</span>);</span><br><span class="line">    <span class="built_in">this</span>.updateById(user);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>(<span class="number">200</span>, <span class="string">&quot;账号已注销&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="在usercontroller中添加注销接口">在UserController中添加注销接口</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 注销账号</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> userId 用户ID</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> deactivateAccountVo 注销信息（包含密码验证）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 注销结果</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@DeleteMapping(&quot;/&#123;userId&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;注销账号&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">deactivateAccount</span><span class="params">(</span></span><br><span class="line"><span class="params">        <span class="meta">@PathVariable</span> Long userId,</span></span><br><span class="line"><span class="params">        <span class="meta">@Validated</span> <span class="meta">@RequestBody</span> DeactivateAccountVo deactivateAccountVo)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;注销账号，用户ID：&#123;&#125;&quot;</span>, userId);</span><br><span class="line">    <span class="keyword">return</span> userService.deactivateAccount(userId, deactivateAccountVo.getPassword());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="文件上传模块">5 文件上传模块</h2>
<blockquote>
<p>使用Spring的multipart配置控制文件大小</p>
<ol type="1">
<li><p>配置设计：</p>
<p>使用@ConfigurationProperties自动绑定配置属性</p>
<p>分离Spring默认配置和自定义配置</p>
<p>提供文件大小限制和类型限制的配置选项</p>
<p>支持灵活配置上传目录路径</p></li>
<li><p>接口设计：</p>
<p>使用MultipartFile处理文件上传</p>
<p>返回文件的相对访问路径</p></li>
<li><p>实现类特点：</p>
<p>使用@Service注解标记为服务类</p>
<p>使用@Slf4j注解添加日志支持</p>
<p>使用@Autowired注入配置类</p></li>
<li><p>业务逻辑：</p>
<p>文件空值检查</p>
<p>文件类型验证（白名单机制）</p>
<p>生成基于日期的目录结构</p>
<p>枚举文件冲突策略</p>
<p>保存文件并返回访问路径</p></li>
<li><p>控制器设计：</p>
<p>使用@RestController提供REST API</p>
<p>使用@RequestMapping定义基础路径</p>
<p>添加Swagger文档注解</p>
<p>使用@RequestParam接收文件参数</p></li>
</ol>
</blockquote>
<h2 id="图片上传">图片上传</h2>
<p>新建一个blog_image表来存储上传的图片信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">/*idx_post_title: 在post_title字段上建立索引,加速按文章标题查询图片的速度</span><br><span class="line">idx_upload_time: 在upload_time字段上建立索引,加速按时间范围查询图片的速度*/</span><br><span class="line">CREATE TABLE `blog_image`</span><br><span class="line">(</span><br><span class="line">    `id`          bigint(20)    NOT NULL AUTO_INCREMENT COMMENT &#x27;主键,自增长&#x27;,</span><br><span class="line">    `filename`    varchar(255)  NOT NULL COMMENT &#x27;文件的原始名称&#x27;,</span><br><span class="line">    `path`        varchar(1000) NOT NULL COMMENT &#x27;文件在服务器上的存储路径&#x27;,</span><br><span class="line">    `post_title`  varchar(255)  NOT NULL COMMENT &#x27;图片所属的博客文章标题,用于按文章组织图片&#x27;,</span><br><span class="line">    `url`         varchar(1000) NOT NULL COMMENT &#x27;图片的访问URL,用于在博客正文中引用&#x27;,</span><br><span class="line">    `size`        bigint(20)    NOT NULL COMMENT &#x27;文件大小,单位字节,用于展示和限制上传大小&#x27;,</span><br><span class="line">    `width`       int(11)                DEFAULT NULL COMMENT &#x27;图片宽度,单位像素,可选,用于展示&#x27;,</span><br><span class="line">    `height`      int(11)                DEFAULT NULL COMMENT &#x27;图片高度,单位像素,可选,用于展示&#x27;,</span><br><span class="line">    `upload_time` datetime      NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#x27;图片上传时间,默认为当前时间&#x27;,</span><br><span class="line">    PRIMARY KEY (`id`),</span><br><span class="line">    KEY `idx_post_title` (`post_title`),</span><br><span class="line">    KEY `idx_upload_time` (`upload_time`)</span><br><span class="line">) ENGINE = InnoDB</span><br><span class="line">  DEFAULT CHARSET = utf8mb4 COMMENT =&#x27;博客图片表&#x27;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>BlogImage实体类,与blog_image表对应</p>
<p>BlogImageMapper接口,继承BaseMapper,用于数据库操作</p>
<p>BlogImageService接口,定义图片管理相关的业务方法</p>
<p>BlogImageServiceImpl实现类,实现了图片列表查询、删除、重命名等功能</p>
<p>BlogImageController,提供RESTful风格的图片管理接口</p>
</blockquote>
<h3 id="blogimageservice">BlogImageService</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.luotao.job.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.IService;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.entity.BlogImage;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.utils.ResponseResult;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 博客图片服务接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BlogImageService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;BlogImage&gt; &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页查询图片列表</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> postTitle 博客文章标题</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> page      页码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> size      每页大小</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 图片列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ResponseResult <span class="title function_">listImages</span><span class="params">(String postTitle, Integer page, Integer size)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除图片</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> imageId 图片ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 删除结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ResponseResult <span class="title function_">deleteImage</span><span class="params">(Long imageId)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 重命名图片</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> imageId   图片ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> newName 新文件名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 重命名结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ResponseResult <span class="title function_">renameImage</span><span class="params">(Long imageId, String newName)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="blogimageserviceimpl">BlogImageServiceImpl</h3>
<blockquote>
<p>构建BlogImage对象,设置文件名、存储路径、所属文章标题、访问URL、文件大小等属性</p>
<p>调用blogImageService.save()方法将图片信息保存到数据库</p>
<p>使用了BlogImageService的save()方法,它是由IService接口提供的,可以直接保存实体对象。</p>
<p>图片的宽度和高度属性暂时没有设置,如果需要的话,可以使用一些图片处理库如Thumbnailator来读取图片尺寸信息。</p>
<p>在FileController的uploadImage接口中添加@Transactional注解,确保文件存储和数据库操作在同一个事务中</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.luotao.job.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.luotao.job.config.FileUploadConfig;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.service.FileService;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.service.BlogImageService;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.utils.ResponseResult;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.utils.enums.FileConflictStrategy;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Path;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> luotao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 文件服务实现类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">FileService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> FileUploadConfig fileUploadConfig;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BlogImageService blogImageService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">uploadMarkdown</span><span class="params">(MultipartFile file, FileConflictStrategy strategy)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 校验文件是否为空</span></span><br><span class="line">        <span class="keyword">if</span> (file.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>(<span class="number">400</span>, <span class="string">&quot;文件不能为空&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 校验文件类型</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> file.getOriginalFilename();</span><br><span class="line">        <span class="type">String</span> <span class="variable">fileExtension</span> <span class="operator">=</span> StringUtils.getFilenameExtension(originalFilename);</span><br><span class="line">        <span class="keyword">if</span> (!isAllowedFileType(fileExtension)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>(<span class="number">400</span>, <span class="string">&quot;不支持的文件类型&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 3. 生成文件保存路径</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">savePath</span> <span class="operator">=</span> generateSavePath(originalFilename);</span><br><span class="line">            <span class="type">Path</span> <span class="variable">path</span> <span class="operator">=</span> Paths.get(savePath);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 4. 处理文件冲突</span></span><br><span class="line">            <span class="keyword">if</span> (Files.exists(path)) &#123;</span><br><span class="line">                <span class="keyword">switch</span> (strategy) &#123;</span><br><span class="line">                    <span class="keyword">case</span> REJECT:</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>(<span class="number">400</span>, <span class="string">&quot;文件已存在&quot;</span>);</span><br><span class="line">                    <span class="keyword">case</span> RENAME:</span><br><span class="line">                        path = generateUniqueFilePath(path);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> OVERWRITE:</span><br><span class="line">                        <span class="comment">// 默认覆盖，无需特殊处理</span></span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 5. 确保目录存在</span></span><br><span class="line">            Files.createDirectories(path.getParent());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 6. 保存文件</span></span><br><span class="line">            file.transferTo(path);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 7. 返回文件访问路径</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">accessPath</span> <span class="operator">=</span> path.toString().replace(fileUploadConfig.getPath(), <span class="string">&quot;&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>(<span class="number">200</span>, <span class="string">&quot;上传成功&quot;</span>, accessPath);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;文件上传失败：&quot;</span>, e);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>(<span class="number">500</span>, <span class="string">&quot;文件上传失败：&quot;</span> + e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">readMarkdownContent</span><span class="params">(String filePath)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1. 构建完整的文件路径</span></span><br><span class="line"><span class="comment">//            Path fullPath = Paths.get(fileUploadConfig.getPath(), filePath);</span></span><br><span class="line">            <span class="type">Path</span> <span class="variable">fullPath</span> <span class="operator">=</span> Paths.get(filePath);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 2. 检查文件是否存在</span></span><br><span class="line">            <span class="keyword">if</span> (!Files.exists(fullPath)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>(<span class="number">404</span>, <span class="string">&quot;文件不存在&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 3. 检查文件类型</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">fileExtension</span> <span class="operator">=</span> StringUtils.getFilenameExtension(fullPath.toString());</span><br><span class="line">            <span class="keyword">if</span> (!isAllowedFileType(fileExtension)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>(<span class="number">400</span>, <span class="string">&quot;不支持的文件类型&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 4. 读取文件内容</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(Files.readAllBytes(fullPath), StandardCharsets.UTF_8);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 5. 返回文件内容</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>(<span class="number">200</span>, <span class="string">&quot;读取成功&quot;</span>, content);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;读取文件失败：&quot;</span>, e);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>(<span class="number">500</span>, <span class="string">&quot;读取文件失败：&quot;</span> + e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">uploadImage</span><span class="params">(MultipartFile file, String postTitle, FileConflictStrategy strategy)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 校验文件是否为空</span></span><br><span class="line">        <span class="keyword">if</span> (file.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>(<span class="number">400</span>, <span class="string">&quot;文件不能为空&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 校验文件类型</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> file.getOriginalFilename();</span><br><span class="line">        <span class="type">String</span> <span class="variable">fileExtension</span> <span class="operator">=</span> StringUtils.getFilenameExtension(originalFilename);</span><br><span class="line">        <span class="keyword">if</span> (!isAllowedImageType(fileExtension)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>(<span class="number">400</span>, <span class="string">&quot;不支持的图片类型&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 3. 生成图片存储目录和文件名</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">storageDir</span> <span class="operator">=</span> generateStorageDir(postTitle);</span><br><span class="line">            <span class="type">String</span> <span class="variable">newFilename</span> <span class="operator">=</span> handleFileConflict(storageDir, originalFilename, strategy);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 4. 保存文件</span></span><br><span class="line">            <span class="type">Path</span> <span class="variable">filePath</span> <span class="operator">=</span> Paths.get(storageDir, newFilename);</span><br><span class="line">            Files.createDirectories(filePath.getParent());</span><br><span class="line">            file.transferTo(filePath);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 5. 保存图片信息到数据库</span></span><br><span class="line">            <span class="type">BlogImage</span> <span class="variable">blogImage</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BlogImage</span>();</span><br><span class="line">            blogImage.setFilename(newFilename);</span><br><span class="line">            blogImage.setPath(filePath.toString());</span><br><span class="line">            blogImage.setPostTitle(postTitle);</span><br><span class="line">            blogImage.setUrl(generateAccessUrl(postTitle, newFilename));</span><br><span class="line">            blogImage.setSize(file.getSize());</span><br><span class="line">            blogImageService.save(blogImage);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 6. 生成访问URL和Markdown引用路径</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">accessUrl</span> <span class="operator">=</span> generateAccessUrl(postTitle, newFilename);</span><br><span class="line">            <span class="type">String</span> <span class="variable">markdownPath</span> <span class="operator">=</span> generateMarkdownPath(postTitle, newFilename);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 7. 返回结果</span></span><br><span class="line">            Map&lt;String, String&gt; data = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">            data.put(<span class="string">&quot;url&quot;</span>, accessUrl);</span><br><span class="line">            data.put(<span class="string">&quot;markdownPath&quot;</span>, markdownPath);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>(<span class="number">200</span>, <span class="string">&quot;上传成功&quot;</span>, data);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;图片上传失败：&quot;</span>, e);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>(<span class="number">500</span>, <span class="string">&quot;图片上传失败：&quot;</span> + e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 检查文件类型是否允许</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isAllowedFileType</span><span class="params">(String fileExtension)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (fileExtension == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> fileUploadConfig.getAllowedTypes().contains(<span class="string">&quot;.&quot;</span> + fileExtension.toLowerCase());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 检查图片类型是否允许</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isAllowedImageType</span><span class="params">(String fileExtension)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (fileExtension == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        return fileUploadConfig.getAllowedImageTypes().contains(&quot;.&quot; + fileExtension.toLowerCase());</span></span><br><span class="line">        <span class="keyword">return</span> fileUploadConfig.getAllowedTypes().contains(<span class="string">&quot;.&quot;</span> + fileExtension.toLowerCase());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成文件保存路径</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">generateSavePath</span><span class="params">(String originalFilename)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 生成日期目录</span></span><br><span class="line"><span class="comment">//        String dateDir = LocalDateTime.now().format(DateTimeFormatter.ofPattern(&quot;yyyy/MM/dd&quot;));</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. 组合完整路径</span></span><br><span class="line"><span class="comment">//        return fileUploadConfig.getPath() + dateDir + File.separator + originalFilename;</span></span><br><span class="line">        <span class="keyword">return</span> fileUploadConfig.getPath()  + File.separator + originalFilename;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据原始文件路径生成一个唯一的文件路径</span></span><br><span class="line"><span class="comment">     * 如果文件已存在，则在文件名后添加递增的数字以确保路径唯一</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> original 原始文件路径</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 生成唯一的文件路径（通过添加序号）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Path <span class="title function_">generateUniqueFilePath</span><span class="params">(Path original)</span> &#123;</span><br><span class="line">        <span class="comment">// 获取原始路径的父目录</span></span><br><span class="line">        <span class="type">Path</span> <span class="variable">parent</span> <span class="operator">=</span> original.getParent();</span><br><span class="line">        <span class="comment">// 获取原始文件名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">filename</span> <span class="operator">=</span> original.getFileName().toString();</span><br><span class="line">        <span class="comment">// 移除文件名中的扩展名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">nameWithoutExt</span> <span class="operator">=</span> StringUtils.stripFilenameExtension(filename);</span><br><span class="line">        <span class="comment">// 获取文件名的扩展名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">extension</span> <span class="operator">=</span> StringUtils.getFilenameExtension(filename);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 初始化计数器用于生成唯一的文件名</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">counter</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// 初始化新路径为原始路径</span></span><br><span class="line">        <span class="type">Path</span> <span class="variable">newPath</span> <span class="operator">=</span> original;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 循环直到找到一个不存在的文件名</span></span><br><span class="line">        <span class="keyword">while</span> (Files.exists(newPath)) &#123;</span><br><span class="line">            <span class="comment">// 根据计数器生成新的文件名</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">newName</span> <span class="operator">=</span> String.format(<span class="string">&quot;%s(%d).%s&quot;</span>, nameWithoutExt, counter++, extension);</span><br><span class="line">            <span class="comment">// 在父目录下解析新的文件路径</span></span><br><span class="line">            newPath = parent.resolve(newName);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 返回唯一的文件路径</span></span><br><span class="line">        <span class="keyword">return</span> newPath;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成图片存储目录</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">generateStorageDir</span><span class="params">(String postTitle)</span> &#123;</span><br><span class="line">        <span class="comment">// 实现生成图片存储目录的逻辑</span></span><br><span class="line">        <span class="keyword">return</span> fileUploadConfig.getPath() + File.separator + <span class="string">&quot;images&quot;</span> + File.separator + postTitle;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理文件冲突</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">handleFileConflict</span><span class="params">(String storageDir, String originalFilename, FileConflictStrategy strategy)</span> &#123;</span><br><span class="line">        <span class="comment">// 实现处理文件冲突的逻辑</span></span><br><span class="line">        <span class="keyword">return</span> originalFilename;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成访问URL</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">generateAccessUrl</span><span class="params">(String postTitle, String filename)</span> &#123;</span><br><span class="line">        <span class="comment">// 实现生成访问URL的逻辑</span></span><br><span class="line">        <span class="keyword">return</span> fileUploadConfig.getPath() + <span class="string">&quot;images&quot;</span> + File.separator + postTitle + File.separator + filename;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成Markdown引用路径</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">generateMarkdownPath</span><span class="params">(String postTitle, String filename)</span> &#123;</span><br><span class="line">        <span class="comment">// 实现生成Markdown引用路径的逻辑</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;images&quot;</span> + File.separator + postTitle + File.separator + filename;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<h3 id="blogimagecontroller">BlogImageController</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.luotao.job.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.luotao.job.service.BlogImageService;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.utils.ResponseResult;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 博客图片控制器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/blog/images&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;博客图片管理&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BlogImageController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BlogImageService blogImageService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页查询图片列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;分页查询图片列表&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">listImages</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(required = false)</span> String postTitle,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(defaultValue = &quot;1&quot;)</span> Integer page,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(defaultValue = &quot;10&quot;)</span> Integer size)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> blogImageService.listImages(postTitle, page, size);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除图片</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/&#123;imageId&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;删除图片&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">deleteImage</span><span class="params">(<span class="meta">@PathVariable</span> Long imageId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> blogImageService.deleteImage(imageId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 重命名图片</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PutMapping(&quot;/&#123;imageId&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;重命名图片&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">renameImage</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@PathVariable</span> Long imageId,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam</span> String newName)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> blogImageService.renameImage(imageId, newName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<blockquote>
<ol type="1">
<li>图片存储目录调整为与博客文章Markdown文件同级,并按博客文章名称命名:</li>
</ol>
<p>博客文章Markdown文件路径形如: /uploads/markdown/post-title.md</p>
<p>对应的图片存储目录为: /uploads/markdown/post-title/</p>
<p>图片文件存储在 post-title 目录下</p>
<ol start="2" type="1">
<li>图片文件名允许重复,并在前端提供冲突处理策略选择。</li>
</ol>
<p>下面我详细说明一下每一步的设计思路:</p>
<p>第一步:调整FileService的uploadImage方法</p>
<p>添加参数postTitle,表示博客文章标题,用于生成图片存储目录</p>
<p>添加参数strategy,表示文件冲突处理策略,在前端上传时指定</p>
<p>图片存储路径逻辑调整为:</p>
<p>根路径为 /uploads/markdown/</p>
<p>子目录为博客文章标题 postTitle</p>
<p>最终的图片存储路径为 /uploads/markdown/postTitle/image.jpg</p>
<p>根据strategy参数处理文件重名冲突:</p>
<p>RENAME: 重命名新文件,如image(1).jpg</p>
<p>REPLACE: 覆盖已有文件</p>
<p>KEEP_BOTH: 保留两个文件</p>
<p>返回结果中包含访问URL和图片在Markdown中的引用路径</p>
<p>第二步:更新FileController的uploadImage接口</p>
<p>请求参数中添加postTitle和strategy</p>
<p>调用FileService的uploadImage方法,传入postTitle和strategy参数</p>
<p>返回结果中新增markdownPath字段,表示图片在Markdown中的引用路径</p>
<p>第三步:更新BlogPostEdit组件的图片上传处理逻辑</p>
<p>上传前,根据当前博客标题生成postTitle参数</p>
<p>上传前,获取用户选择的冲突处理策略,生成strategy参数</p>
<p>上传成功后,使用服务端返回的markdownPath,在编辑器中插入图片引用</p>
<p>第四步:更新图片管理功能</p>
<p>根据postTitle参数,获取对应目录下的图片列表</p>
<p>图片重命名时,只更新图片文件名,不修改所在目录</p>
<ol start="3" type="1">
<li>图片删除时,如果目录为空,将目录一并删除</li>
</ol>
<p>数据库表结构新增postTitle字段,记录图片所属的博客文章标题</p>
<p>以上就是按照你的要求,对图片上传和存储设计的调整思路。这样可以实现:</p>
<p>图片按博客文章名称分目录存储,方便管理</p>
<p>图片文件与博客文章Markdown文件同级,方便迁移和备份</p>
<p>允许图片文件名重复,并由用户决定冲突处理策略</p>
<p>上传成功后,直接返回图片在Markdown中的引用路径,方便写作</p>
</blockquote>
<h3 id="在fileservice接口中添加uploadimage方法">在FileService接口中添加uploadImage方法</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.luotao.job.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.luotao.job.utils.ResponseResult;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.utils.enums.FileConflictStrategy;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> luotao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 文件服务接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">FileService</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 上传Markdown文件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file 文件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> strategy 文件冲突处理策略</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 上传结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ResponseResult <span class="title function_">uploadMarkdown</span><span class="params">(MultipartFile file, FileConflictStrategy strategy)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 读取Markdown文件内容</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> filePath 文件相对路径</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 文件内容</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ResponseResult <span class="title function_">readMarkdownContent</span><span class="params">(String filePath)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 上传图片文件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file 图片文件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> postTitle 博客文章标题</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> strategy 文件冲突处理策略</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 上传结果,包含访问URL和Markdown引用路径</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ResponseResult <span class="title function_">uploadImage</span><span class="params">(MultipartFile file, String postTitle, FileConflictStrategy strategy)</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<h3 id="在fileserviceimpl中实现图片上传">在FileServiceImpl中实现图片上传</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.luotao.job.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.luotao.job.config.FileUploadConfig;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.service.FileService;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.utils.ResponseResult;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.utils.enums.FileConflictStrategy;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Path;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> luotao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 文件服务实现类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">FileService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> FileUploadConfig fileUploadConfig;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">uploadMarkdown</span><span class="params">(MultipartFile file, FileConflictStrategy strategy)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 校验文件是否为空</span></span><br><span class="line">        <span class="keyword">if</span> (file.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>(<span class="number">400</span>, <span class="string">&quot;文件不能为空&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 校验文件类型</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> file.getOriginalFilename();</span><br><span class="line">        <span class="type">String</span> <span class="variable">fileExtension</span> <span class="operator">=</span> StringUtils.getFilenameExtension(originalFilename);</span><br><span class="line">        <span class="keyword">if</span> (!isAllowedFileType(fileExtension)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>(<span class="number">400</span>, <span class="string">&quot;不支持的文件类型&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 3. 生成文件保存路径</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">savePath</span> <span class="operator">=</span> generateSavePath(originalFilename);</span><br><span class="line">            <span class="type">Path</span> <span class="variable">path</span> <span class="operator">=</span> Paths.get(savePath);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 4. 处理文件冲突</span></span><br><span class="line">            <span class="keyword">if</span> (Files.exists(path)) &#123;</span><br><span class="line">                <span class="keyword">switch</span> (strategy) &#123;</span><br><span class="line">                    <span class="keyword">case</span> REJECT:</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>(<span class="number">400</span>, <span class="string">&quot;文件已存在&quot;</span>);</span><br><span class="line">                    <span class="keyword">case</span> RENAME:</span><br><span class="line">                        path = generateUniqueFilePath(path);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> OVERWRITE:</span><br><span class="line">                        <span class="comment">// 默认覆盖，无需特殊处理</span></span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 5. 确保目录存在</span></span><br><span class="line">            Files.createDirectories(path.getParent());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 6. 保存文件</span></span><br><span class="line">            file.transferTo(path);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 7. 返回文件访问路径</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">accessPath</span> <span class="operator">=</span> path.toString().replace(fileUploadConfig.getPath(), <span class="string">&quot;&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>(<span class="number">200</span>, <span class="string">&quot;上传成功&quot;</span>, accessPath);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;文件上传失败：&quot;</span>, e);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>(<span class="number">500</span>, <span class="string">&quot;文件上传失败：&quot;</span> + e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">readMarkdownContent</span><span class="params">(String filePath)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1. 构建完整的文件路径</span></span><br><span class="line"><span class="comment">//            Path fullPath = Paths.get(fileUploadConfig.getPath(), filePath);</span></span><br><span class="line">            <span class="type">Path</span> <span class="variable">fullPath</span> <span class="operator">=</span> Paths.get(filePath);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 2. 检查文件是否存在</span></span><br><span class="line">            <span class="keyword">if</span> (!Files.exists(fullPath)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>(<span class="number">404</span>, <span class="string">&quot;文件不存在&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 3. 检查文件类型</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">fileExtension</span> <span class="operator">=</span> StringUtils.getFilenameExtension(fullPath.toString());</span><br><span class="line">            <span class="keyword">if</span> (!isAllowedFileType(fileExtension)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>(<span class="number">400</span>, <span class="string">&quot;不支持的文件类型&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 4. 读取文件内容</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(Files.readAllBytes(fullPath), StandardCharsets.UTF_8);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 5. 返回文件内容</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>(<span class="number">200</span>, <span class="string">&quot;读取成功&quot;</span>, content);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;读取文件失败：&quot;</span>, e);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>(<span class="number">500</span>, <span class="string">&quot;读取文件失败：&quot;</span> + e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">uploadImage</span><span class="params">(MultipartFile file, String postTitle, FileConflictStrategy strategy)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 校验文件是否为空</span></span><br><span class="line">        <span class="keyword">if</span> (file.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>(<span class="number">400</span>, <span class="string">&quot;文件不能为空&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 校验文件类型</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> file.getOriginalFilename();</span><br><span class="line">        <span class="type">String</span> <span class="variable">fileExtension</span> <span class="operator">=</span> StringUtils.getFilenameExtension(originalFilename);</span><br><span class="line">        <span class="keyword">if</span> (!isAllowedImageType(fileExtension)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>(<span class="number">400</span>, <span class="string">&quot;不支持的图片类型&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 3. 生成图片存储目录和文件名</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">storageDir</span> <span class="operator">=</span> generateStorageDir(postTitle);</span><br><span class="line">            <span class="type">String</span> <span class="variable">newFilename</span> <span class="operator">=</span> handleFileConflict(storageDir, originalFilename, strategy);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 4. 保存文件</span></span><br><span class="line">            <span class="type">Path</span> <span class="variable">filePath</span> <span class="operator">=</span> Paths.get(storageDir, newFilename);</span><br><span class="line">            Files.createDirectories(filePath.getParent());</span><br><span class="line">            file.transferTo(filePath);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 5. 生成访问URL和Markdown引用路径</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">accessUrl</span> <span class="operator">=</span> generateAccessUrl(postTitle, newFilename);</span><br><span class="line">            <span class="type">String</span> <span class="variable">markdownPath</span> <span class="operator">=</span> generateMarkdownPath(postTitle, newFilename);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 6. 返回结果</span></span><br><span class="line">            Map&lt;String, String&gt; data = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">            data.put(<span class="string">&quot;url&quot;</span>, accessUrl);</span><br><span class="line">            data.put(<span class="string">&quot;markdownPath&quot;</span>, markdownPath);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>(<span class="number">200</span>, <span class="string">&quot;上传成功&quot;</span>, data);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;图片上传失败：&quot;</span>, e);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>(<span class="number">500</span>, <span class="string">&quot;图片上传失败：&quot;</span> + e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 检查文件类型是否允许</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isAllowedFileType</span><span class="params">(String fileExtension)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (fileExtension == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> fileUploadConfig.getAllowedTypes().contains(<span class="string">&quot;.&quot;</span> + fileExtension.toLowerCase());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 检查图片类型是否允许</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isAllowedImageType</span><span class="params">(String fileExtension)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (fileExtension == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> fileUploadConfig.getAllowedImageTypes().contains(<span class="string">&quot;.&quot;</span> + fileExtension.toLowerCase());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成文件保存路径</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">generateSavePath</span><span class="params">(String originalFilename)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 生成日期目录</span></span><br><span class="line"><span class="comment">//        String dateDir = LocalDateTime.now().format(DateTimeFormatter.ofPattern(&quot;yyyy/MM/dd&quot;));</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. 组合完整路径</span></span><br><span class="line"><span class="comment">//        return fileUploadConfig.getPath() + dateDir + File.separator + originalFilename;</span></span><br><span class="line">        <span class="keyword">return</span> fileUploadConfig.getPath()  + File.separator + originalFilename;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据原始文件路径生成一个唯一的文件路径</span></span><br><span class="line"><span class="comment">     * 如果文件已存在，则在文件名后添加递增的数字以确保路径唯一</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> original 原始文件路径</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 生成唯一的文件路径（通过添加序号）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Path <span class="title function_">generateUniqueFilePath</span><span class="params">(Path original)</span> &#123;</span><br><span class="line">        <span class="comment">// 获取原始路径的父目录</span></span><br><span class="line">        <span class="type">Path</span> <span class="variable">parent</span> <span class="operator">=</span> original.getParent();</span><br><span class="line">        <span class="comment">// 获取原始文件名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">filename</span> <span class="operator">=</span> original.getFileName().toString();</span><br><span class="line">        <span class="comment">// 移除文件名中的扩展名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">nameWithoutExt</span> <span class="operator">=</span> StringUtils.stripFilenameExtension(filename);</span><br><span class="line">        <span class="comment">// 获取文件名的扩展名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">extension</span> <span class="operator">=</span> StringUtils.getFilenameExtension(filename);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 初始化计数器用于生成唯一的文件名</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">counter</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// 初始化新路径为原始路径</span></span><br><span class="line">        <span class="type">Path</span> <span class="variable">newPath</span> <span class="operator">=</span> original;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 循环直到找到一个不存在的文件名</span></span><br><span class="line">        <span class="keyword">while</span> (Files.exists(newPath)) &#123;</span><br><span class="line">            <span class="comment">// 根据计数器生成新的文件名</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">newName</span> <span class="operator">=</span> String.format(<span class="string">&quot;%s(%d).%s&quot;</span>, nameWithoutExt, counter++, extension);</span><br><span class="line">            <span class="comment">// 在父目录下解析新的文件路径</span></span><br><span class="line">            newPath = parent.resolve(newName);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 返回唯一的文件路径</span></span><br><span class="line">        <span class="keyword">return</span> newPath;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成图片存储目录</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">generateStorageDir</span><span class="params">(String postTitle)</span> &#123;</span><br><span class="line">        <span class="comment">// 实现生成图片存储目录的逻辑</span></span><br><span class="line">        <span class="keyword">return</span> fileUploadConfig.getPath() + File.separator + <span class="string">&quot;images&quot;</span> + File.separator + postTitle;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理文件冲突</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">handleFileConflict</span><span class="params">(String storageDir, String originalFilename, FileConflictStrategy strategy)</span> &#123;</span><br><span class="line">        <span class="comment">// 实现处理文件冲突的逻辑</span></span><br><span class="line">        <span class="keyword">return</span> originalFilename;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成访问URL</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">generateAccessUrl</span><span class="params">(String postTitle, String filename)</span> &#123;</span><br><span class="line">        <span class="comment">// 实现生成访问URL的逻辑</span></span><br><span class="line">        <span class="keyword">return</span> fileUploadConfig.getPath() + <span class="string">&quot;images&quot;</span> + File.separator + postTitle + File.separator + filename;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成Markdown引用路径</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">generateMarkdownPath</span><span class="params">(String postTitle, String filename)</span> &#123;</span><br><span class="line">        <span class="comment">// 实现生成Markdown引用路径的逻辑</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;images&quot;</span> + File.separator + postTitle + File.separator + filename;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<h3 id="在filecontroller中添加对应的restful接口">在FileController中添加对应的Restful接口</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.luotao.job.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.luotao.job.service.FileService;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.utils.ResponseResult;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.utils.enums.FileConflictStrategy;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> luotao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 文件上传控制器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/file&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;文件上传接口&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> FileService fileService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 上传Markdown文件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file 文件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> strategy 冲突处理策略</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 上传结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/markdown&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;上传Markdown文件&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">uploadMarkdown</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestPart(&quot;file&quot;)</span> MultipartFile file,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(defaultValue = &quot;RENAME&quot;)</span> FileConflictStrategy strategy)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;上传Markdown文件，文件名：&#123;&#125;，冲突处理策略：&#123;&#125;&quot;</span>, file.getOriginalFilename(), strategy);</span><br><span class="line">        <span class="keyword">return</span> fileService.uploadMarkdown(file, strategy);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 读取Markdown文件内容</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> filePath 文件相对路径</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 文件内容</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/markdown&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;读取Markdown文件内容&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">readMarkdownContent</span><span class="params">(<span class="meta">@RequestParam</span> String filePath)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;读取Markdown文件内容，文件路径：&#123;&#125;&quot;</span>, filePath);</span><br><span class="line">        <span class="keyword">return</span> fileService.readMarkdownContent(filePath);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 上传图片文件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file 图片文件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> postTitle 博客文章标题</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> strategy 冲突处理策略</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 上传结果,包含访问URL和Markdown引用路径</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/image&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;上传图片文件&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">uploadImage</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestPart(&quot;file&quot;)</span> MultipartFile file,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(&quot;postTitle&quot;)</span> String postTitle,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(defaultValue = &quot;RENAME&quot;)</span> FileConflictStrategy strategy)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;上传图片文件,文章标题: &#123;&#125;, 文件名: &#123;&#125;, 冲突处理策略: &#123;&#125;&quot;</span>, postTitle, file.getOriginalFilename(), strategy);</span><br><span class="line">        <span class="keyword">return</span> fileService.uploadImage(file, postTitle, strategy);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<h3 id="添加文件上传相关配置">添加文件上传相关配置</h3>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 数据库</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/job?serverTimezone=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">xxx</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">xxx</span></span><br><span class="line">  <span class="attr">mvc:</span></span><br><span class="line">    <span class="comment"># Spring MVC 的路径匹配策略</span></span><br><span class="line">    <span class="attr">pathmatch:</span></span><br><span class="line">      <span class="attr">matching-strategy:</span> <span class="string">ant_path_matcher</span></span><br><span class="line">  <span class="attr">servlet:</span></span><br><span class="line">    <span class="attr">multipart:</span></span><br><span class="line">      <span class="attr">max-file-size:</span> <span class="string">10MB</span>        <span class="comment"># 单个文件大小限制</span></span><br><span class="line">      <span class="attr">max-request-size:</span> <span class="string">100MB</span>    <span class="comment"># 总请求大小限制</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span>              <span class="comment"># 开启文件上传</span></span><br><span class="line">      </span><br><span class="line"><span class="comment"># 自定义文件上传配置</span></span><br><span class="line"><span class="attr">file:</span></span><br><span class="line">  <span class="attr">upload:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">./uploads/markdown/</span>    <span class="comment"># 文件上传根路径</span></span><br><span class="line">    <span class="attr">allowed-types:</span>              <span class="comment"># 允许上传的文件类型</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">.md</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">.markdown</span></span><br></pre></td></tr></table></figure>
<h3 id="文件重复处理的枚举类fileconflictstrategy">文件重复处理的枚举类(FileConflictStrategy)</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.luotao.job.utils.enums;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> luotao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 文件冲突处理策略</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">FileConflictStrategy</span> &#123;</span><br><span class="line">    OVERWRITE,   <span class="comment">// 覆盖已存在的文件</span></span><br><span class="line">    RENAME,      <span class="comment">// 重命名新文件</span></span><br><span class="line">    REJECT       <span class="comment">// 拒绝上传</span></span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<h3 id="创建文件上传配置类fileuploadconfig">创建文件上传配置类(FileUploadConfig)</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.luotao.job.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> luotao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 文件上传配置类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;file.upload&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileUploadConfig</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文件上传根路径</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String path;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 允许上传的文件类型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; allowedTypes;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<h3 id="创建文件上传服务接口-fileservice-和实现-fileserviceimpl">创建文件上传服务接口(
FileService )和实现( FileServiceImpl)</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.luotao.job.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.luotao.job.utils.ResponseResult;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.utils.enums.FileConflictStrategy;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> luotao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 文件服务接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">FileService</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 上传Markdown文件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file 文件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> strategy 文件冲突处理策略</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 上传结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ResponseResult <span class="title function_">uploadMarkdown</span><span class="params">(MultipartFile file, FileConflictStrategy strategy)</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.luotao.job.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.luotao.job.config.FileUploadConfig;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.service.FileService;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.utils.ResponseResult;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.utils.enums.FileConflictStrategy;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Path;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.time.format.DateTimeFormatter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> luotao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 文件服务实现类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">FileService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> FileUploadConfig fileUploadConfig;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">uploadMarkdown</span><span class="params">(MultipartFile file, FileConflictStrategy strategy)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 校验文件是否为空</span></span><br><span class="line">        <span class="keyword">if</span> (file.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>(<span class="number">400</span>, <span class="string">&quot;文件不能为空&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 校验文件类型</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> file.getOriginalFilename();</span><br><span class="line">        <span class="type">String</span> <span class="variable">fileExtension</span> <span class="operator">=</span> StringUtils.getFilenameExtension(originalFilename);</span><br><span class="line">        <span class="keyword">if</span> (!isAllowedFileType(fileExtension)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>(<span class="number">400</span>, <span class="string">&quot;不支持的文件类型&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 3. 生成文件保存路径</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">savePath</span> <span class="operator">=</span> generateSavePath(originalFilename);</span><br><span class="line">            <span class="type">Path</span> <span class="variable">path</span> <span class="operator">=</span> Paths.get(savePath);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 4. 处理文件冲突</span></span><br><span class="line">            <span class="keyword">if</span> (Files.exists(path)) &#123;</span><br><span class="line">                <span class="keyword">switch</span> (strategy) &#123;</span><br><span class="line">                    <span class="keyword">case</span> REJECT:</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>(<span class="number">400</span>, <span class="string">&quot;文件已存在&quot;</span>);</span><br><span class="line">                    <span class="keyword">case</span> RENAME:</span><br><span class="line">                        path = generateUniqueFilePath(path);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> OVERWRITE:</span><br><span class="line">                        <span class="comment">// 默认覆盖，无需特殊处理</span></span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 5. 确保目录存在</span></span><br><span class="line">            Files.createDirectories(path.getParent());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 6. 保存文件</span></span><br><span class="line">            file.transferTo(path);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 7. 返回文件访问路径</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">accessPath</span> <span class="operator">=</span> path.toString().replace(fileUploadConfig.getPath(), <span class="string">&quot;&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>(<span class="number">200</span>, <span class="string">&quot;上传成功&quot;</span>, accessPath);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;文件上传失败：&quot;</span>, e);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>(<span class="number">500</span>, <span class="string">&quot;文件上传失败：&quot;</span> + e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 检查文件类型是否允许</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isAllowedFileType</span><span class="params">(String fileExtension)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (fileExtension == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> fileUploadConfig.getAllowedTypes().contains(<span class="string">&quot;.&quot;</span> + fileExtension.toLowerCase());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成文件保存路径</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">generateSavePath</span><span class="params">(String originalFilename)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 生成日期目录</span></span><br><span class="line"><span class="comment">//        String dateDir = LocalDateTime.now().format(DateTimeFormatter.ofPattern(&quot;yyyy/MM/dd&quot;));</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. 组合完整路径</span></span><br><span class="line"><span class="comment">//        return fileUploadConfig.getPath() + dateDir + File.separator + originalFilename;</span></span><br><span class="line">        <span class="keyword">return</span> fileUploadConfig.getPath()  + File.separator + originalFilename;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据原始文件路径生成一个唯一的文件路径</span></span><br><span class="line"><span class="comment">     * 如果文件已存在，则在文件名后添加递增的数字以确保路径唯一</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> original 原始文件路径</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 生成唯一的文件路径（通过添加序号）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Path <span class="title function_">generateUniqueFilePath</span><span class="params">(Path original)</span> &#123;</span><br><span class="line">        <span class="comment">// 获取原始路径的父目录</span></span><br><span class="line">        <span class="type">Path</span> <span class="variable">parent</span> <span class="operator">=</span> original.getParent();</span><br><span class="line">        <span class="comment">// 获取原始文件名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">filename</span> <span class="operator">=</span> original.getFileName().toString();</span><br><span class="line">        <span class="comment">// 移除文件名中的扩展名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">nameWithoutExt</span> <span class="operator">=</span> StringUtils.stripFilenameExtension(filename);</span><br><span class="line">        <span class="comment">// 获取文件名的扩展名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">extension</span> <span class="operator">=</span> StringUtils.getFilenameExtension(filename);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 初始化计数器用于生成唯一的文件名</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">counter</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// 初始化新路径为原始路径</span></span><br><span class="line">        <span class="type">Path</span> <span class="variable">newPath</span> <span class="operator">=</span> original;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 循环直到找到一个不存在的文件名</span></span><br><span class="line">        <span class="keyword">while</span> (Files.exists(newPath)) &#123;</span><br><span class="line">            <span class="comment">// 根据计数器生成新的文件名</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">newName</span> <span class="operator">=</span> String.format(<span class="string">&quot;%s(%d).%s&quot;</span>, nameWithoutExt, counter++, extension);</span><br><span class="line">            <span class="comment">// 在父目录下解析新的文件路径</span></span><br><span class="line">            newPath = parent.resolve(newName);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 返回唯一的文件路径</span></span><br><span class="line">        <span class="keyword">return</span> newPath;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<h3 id="创建文件上传控制器filecontroller">创建文件上传控制器(FileController)</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.luotao.job.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.luotao.job.service.FileService;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.utils.ResponseResult;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.utils.enums.FileConflictStrategy;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> luotao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 文件上传控制器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/file&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;文件上传接口&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> FileService fileService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 上传Markdown文件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file 文件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> strategy 冲突处理策略</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 上传结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/markdown&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;上传Markdown文件&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">uploadMarkdown</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestPart(&quot;file&quot;)</span> MultipartFile file,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(defaultValue = &quot;RENAME&quot;)</span> FileConflictStrategy strategy)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;上传Markdown文件，文件名：&#123;&#125;，冲突处理策略：&#123;&#125;&quot;</span>, file.getOriginalFilename(), strategy);</span><br><span class="line">        <span class="keyword">return</span> fileService.uploadMarkdown(file, strategy);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<h3 id="在fileservice接口中添加读取文件的方法">在FileService接口中添加读取文件的方法</h3>
<blockquote>
<p>设计说明：</p>
<ol type="1">
<li><p>接口设计：</p>
<p>使用GET方法获取文件内容</p>
<p>通过请求参数传递文件路径</p>
<p>返回文件的文本内容</p></li>
<li><p>实现类特点：</p>
<p>完整的路径构建和安全检查</p>
<p>文件类型验证</p>
<p>使用UTF-8编码读取文件内容</p></li>
<li><p>业务逻辑：</p>
<p>文件存在性检查</p>
<p>文件类型验证</p>
<p>文件内容读取</p>
<p>异常处理</p></li>
<li><p>安全特性：</p>
<p>路径合法性验证</p>
<p>文件类型限制</p>
<p>异常捕获和日志记录</p></li>
</ol>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 读取Markdown文件内容</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> filePath 文件相对路径</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 文件内容</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">ResponseResult <span class="title function_">readMarkdownContent</span><span class="params">(String filePath)</span>;</span><br></pre></td></tr></table></figure>
<h3 id="在fileserviceimpl中实现读取markdown文件内容的方法">在FileServiceImpl中实现读取Markdown文件内容的方法</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">readMarkdownContent</span><span class="params">(String filePath)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1. 构建完整的文件路径</span></span><br><span class="line">            <span class="type">Path</span> <span class="variable">fullPath</span> <span class="operator">=</span> Paths.get(fileUploadConfig.getPath(), filePath);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 2. 检查文件是否存在</span></span><br><span class="line">            <span class="keyword">if</span> (!Files.exists(fullPath)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>(<span class="number">404</span>, <span class="string">&quot;文件不存在&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 3. 检查文件类型</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">fileExtension</span> <span class="operator">=</span> StringUtils.getFilenameExtension(fullPath.toString());</span><br><span class="line">            <span class="keyword">if</span> (!isAllowedFileType(fileExtension)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>(<span class="number">400</span>, <span class="string">&quot;不支持的文件类型&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 4. 读取文件内容</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(Files.readAllBytes(fullPath), StandardCharsets.UTF_8);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 5. 返回文件内容</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>(<span class="number">200</span>, <span class="string">&quot;读取成功&quot;</span>, content);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;读取文件失败：&quot;</span>, e);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>(<span class="number">500</span>, <span class="string">&quot;读取文件失败：&quot;</span> + e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="在filecontroller中添加读取markdown文件内容的接口">在FileController中添加读取Markdown文件内容的接口</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 读取Markdown文件内容</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> filePath 文件相对路径</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 文件内容</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/markdown&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;读取Markdown文件内容&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">readMarkdownContent</span><span class="params">(<span class="meta">@RequestParam</span> String filePath)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;读取Markdown文件内容，文件路径：&#123;&#125;&quot;</span>, filePath);</span><br><span class="line">    <span class="keyword">return</span> fileService.readMarkdownContent(filePath);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="博客内容管理数据库设计">博客内容管理数据库设计</h2>
<ol type="1">
<li>一对多关系：</li>
</ol>
<p>用户(author_id) → 博客文章：一个用户可以发表多篇文章</p>
<p>分类 → 博客文章：一个分类可以包含多篇文章</p>
<ol start="2" type="1">
<li>多对多关系：</li>
</ol>
<p>博客文章 ↔︎ 标签：通过blog_post_tag关联表实现</p>
<h3 id="博客文章表-blog_post">博客文章表 (blog_post)</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `blog_post` (</span><br><span class="line">  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT &#x27;主键ID&#x27;,</span><br><span class="line">  `title` varchar(200) NOT NULL COMMENT &#x27;文章标题，必填，限制200字符&#x27;,</span><br><span class="line">  `content` LONGTEXT COMMENT &#x27; 文章内容，使用longtext类型存储Markdown格式内容&#x27;,</span><br><span class="line">  `summary` varchar(500) DEFAULT NULL COMMENT &#x27;文章摘要，可选，限制500字符，便于列表展示&#x27;,</span><br><span class="line">  `cover_image` TEXT DEFAULT NULL COMMENT &#x27;封面图片URL，可选，增强文章视觉&#x27;,</span><br><span class="line">  `category_id` bigint(20) DEFAULT NULL COMMENT &#x27;外键关联博客分类表&#x27;,</span><br><span class="line">  `author_id` bigint(20) NOT NULL COMMENT &#x27;外键关联用户表，记录作者信息&#x27;,</span><br><span class="line">  `status` tinyint(1) DEFAULT &#x27;0&#x27; COMMENT &#x27;文章状态(0:草稿,1:已发布,2:回收站)&#x27;,</span><br><span class="line">  `view_count` int(11) DEFAULT &#x27;0&#x27; COMMENT &#x27;浏览量统计&#x27;,</span><br><span class="line">  `comment_count` int(11) DEFAULT &#x27;0&#x27; COMMENT &#x27;评论数统计&#x27;,</span><br><span class="line">  `like_count` int(11) DEFAULT &#x27;0&#x27; COMMENT &#x27;点赞数统计&#x27;,</span><br><span class="line">  `is_top` tinyint(1) DEFAULT &#x27;0&#x27; COMMENT &#x27;是否置顶，用于首页或分类页置顶显示(0:否,1:是)&#x27;,</span><br><span class="line">  `is_original` tinyint(1) DEFAULT &#x27;1&#x27; COMMENT &#x27;是否原创，区分原创和转载内容(0:否,1:是)&#x27;,</span><br><span class="line">  `source_url` varchar(1000) DEFAULT NULL COMMENT &#x27;原文链接(非原创时)&#x27;,</span><br><span class="line">  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#x27; 创建时间，自动记录&#x27;,</span><br><span class="line">  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT &#x27;更新时间，自动更新&#x27;,</span><br><span class="line">  PRIMARY KEY (`id`),</span><br><span class="line">  KEY `idx_category` (`category_id`),</span><br><span class="line">  KEY `idx_author` (`author_id`),</span><br><span class="line">  KEY `idx_status` (`status`),</span><br><span class="line">  KEY `idx_create_time` (`create_time`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT=&#x27;博客文章表&#x27;;</span><br></pre></td></tr></table></figure>
<h3 id="博客分类表-blog_category">博客分类表 (blog_category)</h3>
<blockquote>
<p>分类名称唯一</p>
<p>一篇文章只能属于一个分类</p>
<p>分类有层级关系（通过sort字段排序）</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `blog_category` (</span><br><span class="line">  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT &#x27;主键ID&#x27;,</span><br><span class="line">  `name` varchar(50) NOT NULL COMMENT &#x27;分类名称&#x27;,</span><br><span class="line">  `description` varchar(200) DEFAULT NULL COMMENT &#x27;分类描述&#x27;,</span><br><span class="line">  `sort` int(11) DEFAULT &#x27;0&#x27; COMMENT &#x27;排序&#x27;,</span><br><span class="line">  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#x27;创建时间&#x27;,</span><br><span class="line">  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT &#x27;更新时间&#x27;,</span><br><span class="line">  PRIMARY KEY (`id`),</span><br><span class="line">  UNIQUE KEY `uk_name` (`name`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT=&#x27;博客分类表&#x27;;</span><br></pre></td></tr></table></figure>
<h3 id="博客标签表-blog_tag">博客标签表 (blog_tag)</h3>
<blockquote>
<p>标签名称唯一</p>
<p>一篇文章可以有多个标签</p>
<p>标签无层级关系</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `blog_tag` (</span><br><span class="line">  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT &#x27;主键ID&#x27;,</span><br><span class="line">  `name` varchar(50) NOT NULL COMMENT &#x27;标签名称&#x27;,</span><br><span class="line">  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#x27;创建时间&#x27;,</span><br><span class="line">  PRIMARY KEY (`id`),</span><br><span class="line">  UNIQUE KEY `uk_name` (`name`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT=&#x27;博客标签表&#x27;;</span><br></pre></td></tr></table></figure>
<h3 id="博客文章标签关联表-blog_post_tag">博客文章标签关联表
(blog_post_tag)</h3>
<blockquote>
<p>博客文章 ↔︎ 标签:使用中间表实现多对多关系</p>
<p>联合唯一索引确保一篇文章不会重复关联同一标签</p>
<p>双向索引优化查询性能</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `blog_post_tag` (</span><br><span class="line">  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT &#x27;主键ID&#x27;,</span><br><span class="line">  `post_id` bigint(20) NOT NULL COMMENT &#x27;文章ID&#x27;,</span><br><span class="line">  `tag_id` bigint(20) NOT NULL COMMENT &#x27;标签ID&#x27;,</span><br><span class="line">  PRIMARY KEY (`id`),</span><br><span class="line">  UNIQUE KEY `uk_post_tag` (`post_id`,`tag_id`),</span><br><span class="line">  KEY `idx_tag_id` (`tag_id`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT=&#x27;博客文章标签关联表&#x27;;</span><br></pre></td></tr></table></figure>
<h3 id="请求vo">请求VO</h3>
<blockquote>
<p>数据校验：</p>
<p>使用@NotBlank、<span class="citation" data-cites="Size等注解进行输入验证">@Size等注解进行输入验证</span></p>
<p>为必填字段添加非空校验</p>
<p>为长度受限字段添加长度校验</p>
<p>创建与更新区别：</p>
<p>创建VO：必填字段使用@NotBlank强制校验</p>
<p>更新VO：所有字段可选，支持部分更新</p>
<p>数据类型：</p>
<p>使用包装类型而非基本类型，避免默认值问题</p>
<p>使用List<Long>表示多对多关系（如标签）</Long></p>
</blockquote>
<h4 id="博客文章创建请求vo">博客文章创建请求VO</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.luotao.job.vo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.NotBlank;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.Size;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> luotao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 创建博客文章请求VO</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BlogPostCreateVo</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文章标题</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;文章标题不能为空&quot;)</span></span><br><span class="line">    <span class="meta">@Size(max = 200, message = &quot;文章标题不能超过200个字符&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文章内容(Markdown格式)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;文章内容不能为空&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文章摘要</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Size(max = 500, message = &quot;文章摘要不能超过500个字符&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String summary;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 封面图片URL</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String coverImage;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分类ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long categoryId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 标签ID列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Long&gt; tagIds;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 状态(0:草稿,1:已发布)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 是否置顶(0:否,1:是)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Boolean isTop;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 是否原创(0:否,1:是)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Boolean isOriginal;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 原文链接(非原创时)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String sourceUrl;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<h4 id="博客文章更新请求vo">博客文章更新请求VO</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.luotao.job.vo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.Size;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> luotao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 更新博客文章请求VO</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BlogPostUpdateVo</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文章标题</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Size(max = 200, message = &quot;文章标题不能超过200个字符&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文章内容(Markdown格式)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文章摘要</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Size(max = 500, message = &quot;文章摘要不能超过500个字符&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String summary;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 封面图片URL</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String coverImage;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分类ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long categoryId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 标签ID列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Long&gt; tagIds;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 状态(0:草稿,1:已发布,2:回收站)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 是否置顶(0:否,1:是)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Boolean isTop;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 是否原创(0:否,1:是)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Boolean isOriginal;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 原文链接(非原创时)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String sourceUrl;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<h4 id="博客分类请求vo">博客分类请求VO</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.luotao.job.vo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> luotao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 创建博客分类请求VO</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BlogCategoryCreateVo</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分类名称</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分类描述</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 排序</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Integer</span> <span class="variable">sort</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<h4 id="创建博客标签请求vo">创建博客标签请求VO</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.luotao.job.vo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> luotao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 创建博客标签请求VO</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BlogTagCreateVo</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 标签名称</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<h3 id="响应vo">响应VO</h3>
<blockquote>
<p>列表与详情区分：</p>
<p>列表VO：包含摘要信息，不包含完整内容</p>
<p>详情VO：包含完整内容和关联数据</p>
<p>数据冗余：</p>
<p>包含关联对象的名称（如分类名、作者名）</p>
<p>减少前端二次查询的需求</p>
<p>数据转换：</p>
<p>将数据库实体转换为前端友好的格式</p>
<p>隐藏不必要的实现细节</p>
</blockquote>
<h4 id="博客文章列表响应vo">博客文章列表响应VO</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.luotao.job.vo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> luotao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 博客文章列表响应VO</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BlogPostListVo</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文章ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文章标题</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文章摘要</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String summary;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 封面图片URL</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String coverImage;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分类ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long categoryId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分类名称</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String categoryName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 作者ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long authorId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 作者名称</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String authorName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 作者头像</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String authorAvatar;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 浏览量</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer viewCount;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 评论数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer commentCount;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 点赞数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer likeCount;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 是否置顶(0:否,1:是)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Boolean isTop;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 是否原创(0:否,1:是)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Boolean isOriginal;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createTime;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updateTime;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<h4 id="博客文章详情响应vo">博客文章详情响应VO</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.luotao.job.vo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> luotao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 博客文章详情响应VO</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BlogPostDetailVo</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文章ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文章标题</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文章内容(Markdown格式)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文章摘要</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String summary;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 封面图片URL</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String coverImage;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分类ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long categoryId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分类名称</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String categoryName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 标签列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;BlogTagVo&gt; tags;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 作者ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long authorId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 作者名称</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String authorName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 作者头像</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String authorAvatar;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 状态(0:草稿,1:已发布,2:回收站)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 浏览量</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer viewCount;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 评论数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer commentCount;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 点赞数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer likeCount;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 是否置顶(0:否,1:是)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Boolean isTop;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 是否原创(0:否,1:是)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Boolean isOriginal;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 原文链接(非原创时)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String sourceUrl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createTime;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updateTime;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<h4 id="博客分类vo">博客分类VO</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.luotao.job.vo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> luotao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 博客分类VO</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BlogCategoryVo</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分类ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分类名称</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分类描述</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文章数量</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer postCount;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<h4 id="博客标签vo">博客标签VO</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.luotao.job.vo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> luotao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 博客标签VO</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BlogTagVo</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 标签ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 标签名称</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文章数量</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer postCount;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<h3 id="查询参数vo">查询参数VO</h3>
<blockquote>
<p>分页参数：</p>
<p>默认值设置：页码默认为1，每页大小默认为10</p>
<p>支持自定义分页大小</p>
<p>过滤条件：</p>
<p>支持多维度过滤：分类、标签、关键词、状态</p>
<p>所有过滤条件均为可选</p>
<p>灵活查询：</p>
<p>支持组合查询条件</p>
<p>便于构建复杂的查询场景</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.luotao.job.vo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> luotao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 博客文章查询参数VO</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BlogPostQueryVo</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 页码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Integer</span> <span class="variable">page</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 每页大小</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Integer</span> <span class="variable">size</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分类ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long categoryId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 标签ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long tagId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 关键词</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String keyword;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 状态(0:草稿,1:已发布,2:回收站)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 作者ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long authorId;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<h3 id="实体类和mapper接口设计">实体类和Mapper接口设计</h3>
<blockquote>
<p>注解使用：</p>
<p><span class="citation" data-cites="TableName">@TableName</span>:
指定对应的数据库表名</p>
<p><span class="citation" data-cites="TableId">@TableId</span>:
指定主键字段，并设置自增策略</p>
<p><span class="citation" data-cites="Data">@Data</span>:
Lombok注解，自动生成getter/setter等方法</p>
<p>字段映射：</p>
<p>实体类字段名采用驼峰命名</p>
<p>数据库字段名采用下划线命名</p>
<p>通过MyBatis-Plus的配置自动转换</p>
<p>类型选择：</p>
<p>使用包装类型而非基本类型，避免默认值问题</p>
<p>使用LocalDateTime表示时间</p>
<p>自定义方法：</p>
<p>使用注解SQL：简单的查询和更新操作</p>
<p>使用XML映射：复杂的多表关联查询</p>
<p>性能优化：</p>
<p>增量更新：如浏览量、点赞数等统计字段</p>
<p>关联查询：按需加载关联数据</p>
<p>功能设计：</p>
<p>分页查询：支持多条件组合过滤</p>
<p>统计查询：分类和标签的文章数量统计</p>
<p>关联查询：文章与标签的多对多关系处理</p>
</blockquote>
<figure>
<img src="/2025/03/29/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F/image-20250330160209402.png" alt="image-20250330160209402">
<figcaption aria-hidden="true">image-20250330160209402</figcaption>
</figure>
<figure>
<img src="/2025/03/29/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F/image-20250330160224181.png" alt="image-20250330160224181">
<figcaption aria-hidden="true">image-20250330160224181</figcaption>
</figure>
<h4 id="博客文章mapper接口-blogpostmapper">博客文章Mapper接口
(BlogPostMapper)</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.luotao.job.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.metadata.IPage;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.pagination.Page;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.domain.BlogPost;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.vo.BlogPostListVo;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Param;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Update;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> luotao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 博客文章Mapper接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BlogPostMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;BlogPost&gt; &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页查询文章列表</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> page 分页参数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> categoryId 分类ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> tagId 标签ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> keyword 关键词</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> status 状态</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 分页结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    IPage&lt;BlogPostListVo&gt; <span class="title function_">selectPostList</span><span class="params">(Page&lt;BlogPostListVo&gt; page, </span></span><br><span class="line"><span class="params">                                         <span class="meta">@Param(&quot;categoryId&quot;)</span> Long categoryId,</span></span><br><span class="line"><span class="params">                                         <span class="meta">@Param(&quot;tagId&quot;)</span> Long tagId,</span></span><br><span class="line"><span class="params">                                         <span class="meta">@Param(&quot;keyword&quot;)</span> String keyword,</span></span><br><span class="line"><span class="params">                                         <span class="meta">@Param(&quot;status&quot;)</span> Integer status)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 增加文章浏览量</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> postId 文章ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 影响行数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Update(&quot;UPDATE blog_post SET view_count = view_count + 1 WHERE id = #&#123;postId&#125;&quot;)</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">incrementViewCount</span><span class="params">(<span class="meta">@Param(&quot;postId&quot;)</span> Long postId)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 增加文章点赞数</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> postId 文章ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 影响行数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Update(&quot;UPDATE blog_post SET like_count = like_count + 1 WHERE id = #&#123;postId&#125;&quot;)</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">incrementLikeCount</span><span class="params">(<span class="meta">@Param(&quot;postId&quot;)</span> Long postId)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 增加文章评论数</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> postId 文章ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 影响行数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Update(&quot;UPDATE blog_post SET comment_count = comment_count + 1 WHERE id = #&#123;postId&#125;&quot;)</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">incrementCommentCount</span><span class="params">(<span class="meta">@Param(&quot;postId&quot;)</span> Long postId)</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<h4 id="博客分类mapper接口-blogcategorymapper">博客分类Mapper接口
(BlogCategoryMapper)</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.luotao.job.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.domain.BlogCategory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Select;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> luotao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 博客分类Mapper接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BlogCategoryMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;BlogCategory&gt; &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询所有分类及其文章数量</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 分类列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Select(&quot;SELECT c.*, COUNT(p.id) as post_count &quot; +</span></span><br><span class="line"><span class="meta">            &quot;FROM blog_category c &quot; +</span></span><br><span class="line"><span class="meta">            &quot;LEFT JOIN blog_post p ON c.id = p.category_id AND p.status = 1 &quot; +</span></span><br><span class="line"><span class="meta">            &quot;GROUP BY c.id &quot; +</span></span><br><span class="line"><span class="meta">            &quot;ORDER BY c.sort ASC, c.create_time DESC&quot;)</span></span><br><span class="line">    List&lt;BlogCategory&gt; <span class="title function_">selectCategoryWithCount</span><span class="params">()</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<h4 id="博客标签mapper接口-blogtagmapper">博客标签Mapper接口
(BlogTagMapper)</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.luotao.job.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.domain.BlogTag;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Param;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Select;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> luotao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 博客标签Mapper接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BlogTagMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;BlogTag&gt; &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询文章的所有标签</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> postId 文章ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 标签列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Select(&quot;SELECT t.* FROM blog_tag t &quot; +</span></span><br><span class="line"><span class="meta">            &quot;INNER JOIN blog_post_tag pt ON t.id = pt.tag_id &quot; +</span></span><br><span class="line"><span class="meta">            &quot;WHERE pt.post_id = #&#123;postId&#125;&quot;)</span></span><br><span class="line">    List&lt;BlogTag&gt; <span class="title function_">selectTagsByPostId</span><span class="params">(<span class="meta">@Param(&quot;postId&quot;)</span> Long postId)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询所有标签及其文章数量</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 标签列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Select(&quot;SELECT t.*, COUNT(pt.post_id) as post_count &quot; +</span></span><br><span class="line"><span class="meta">            &quot;FROM blog_tag t &quot; +</span></span><br><span class="line"><span class="meta">            &quot;LEFT JOIN blog_post_tag pt ON t.id = pt.tag_id &quot; +</span></span><br><span class="line"><span class="meta">            &quot;LEFT JOIN blog_post p ON pt.post_id = p.id AND p.status = 1 &quot; +</span></span><br><span class="line"><span class="meta">            &quot;GROUP BY t.id &quot; +</span></span><br><span class="line"><span class="meta">            &quot;ORDER BY post_count DESC, t.create_time DESC&quot;)</span></span><br><span class="line">    List&lt;BlogTag&gt; <span class="title function_">selectTagWithCount</span><span class="params">()</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<h4 id="博客文章标签关联mapper接口-blogposttagmapper">博客文章标签关联Mapper接口
(BlogPostTagMapper)</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.luotao.job.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.domain.BlogPostTag;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Delete;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Param;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> luotao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 博客文章标签关联Mapper接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BlogPostTagMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;BlogPostTag&gt; &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除文章的所有标签关联</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> postId 文章ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 影响行数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Delete(&quot;DELETE FROM blog_post_tag WHERE post_id = #&#123;postId&#125;&quot;)</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">deleteByPostId</span><span class="params">(<span class="meta">@Param(&quot;postId&quot;)</span> Long postId)</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<h4 id="blogpostmapper.xml实现复杂的查询">BlogPostMapper.xml实现复杂的查询</h4>
<blockquote>
<p>动态SQL：</p>
<p>使用<code>&lt;if&gt;</code>标签实现条件查询</p>
<p>支持多条件组合过滤</p>
<p>多表关联：</p>
<p>左连接(LEFT JOIN)：获取分类和作者信息</p>
<p>内连接(INNER JOIN)：按标签筛选文章</p>
<p>排序策略：</p>
<p>置顶文章优先显示</p>
<p>按创建时间倒序排列</p>
<p>结果映射：</p>
<p>直接映射到VO对象，减少代码转换工作</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 分页查询文章列表 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectPostList&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.luotao.job.vo.BlogPostListVo&quot;</span>&gt;</span></span><br><span class="line">      SELECT</span><br><span class="line">      p.id,</span><br><span class="line">      p.title,</span><br><span class="line">      p.summary,</span><br><span class="line">      p.cover_image,</span><br><span class="line">      p.category_id,</span><br><span class="line">      c.name as category_name,</span><br><span class="line">      p.author_id,</span><br><span class="line">      u.username as author_name,</span><br><span class="line">      u.avatar as author_avatar,</span><br><span class="line">      p.view_count,</span><br><span class="line">      p.comment_count,</span><br><span class="line">      p.like_count,</span><br><span class="line">      p.is_top,</span><br><span class="line">      p.is_original,</span><br><span class="line">      p.create_time,</span><br><span class="line">      p.update_time</span><br><span class="line">      FROM</span><br><span class="line">      blog_post p</span><br><span class="line">      LEFT JOIN</span><br><span class="line">      blog_category c ON p.category_id = c.id</span><br><span class="line">      LEFT JOIN</span><br><span class="line">      user u ON p.author_id = u.id</span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;tagId != null&quot;</span>&gt;</span></span><br><span class="line">          INNER JOIN</span><br><span class="line">          blog_post_tag pt ON p.id = pt.post_id AND pt.tag_id = #&#123;tagId&#125;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">      WHERE</span><br><span class="line">      1 = 1</span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;status != null&quot;</span>&gt;</span></span><br><span class="line">          AND p.status = #&#123;status&#125;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;categoryId != null&quot;</span>&gt;</span></span><br><span class="line">          AND p.category_id = #&#123;categoryId&#125;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;keyword != null and keyword != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">          AND (</span><br><span class="line">          p.title LIKE CONCAT(&#x27;%&#x27;, #&#123;keyword&#125;, &#x27;%&#x27;)</span><br><span class="line">          OR p.summary LIKE CONCAT(&#x27;%&#x27;, #&#123;keyword&#125;, &#x27;%&#x27;)</span><br><span class="line">          OR p.content LIKE CONCAT(&#x27;%&#x27;, #&#123;keyword&#125;, &#x27;%&#x27;)</span><br><span class="line">          )</span><br><span class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">      ORDER BY</span><br><span class="line">      p.is_top DESC,</span><br><span class="line">      p.create_time DESC</span><br><span class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>Service层设计:</p>
<p>在涉及多表操作的方法上添加@Transactional注解</p>
<p>设置rollbackFor = Exception.class确保任何异常都会触发回滚</p>
<p>Controller层设计：</p>
</blockquote>
<h4 id="blogpostcontroller">BlogPostController</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.luotao.job.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.luotao.job.service.BlogTagService;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.utils.ResponseResult;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.vo.BlogTagVo;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiParam;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> luotao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 博客标签控制器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/blog/tags&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;博客标签管理接口&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BlogTagController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> BlogTagService blogTagService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取所有标签列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;获取所有标签列表&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult&lt;List&lt;BlogTagVo&gt;&gt; <span class="title function_">getAllTags</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> blogTagService.getAllTags();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建标签</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;创建标签&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult&lt;Long&gt; <span class="title function_">createTag</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@ApiParam(&quot;标签名称&quot;)</span> <span class="meta">@RequestParam</span> String name)</span> &#123;</span><br><span class="line">        <span class="comment">// 检查标签名称是否为空</span></span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.hasText(name)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(<span class="number">400</span>, <span class="string">&quot;标签名称不能为空&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> blogTagService.createTag(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新标签</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PutMapping(&quot;/&#123;tagId&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;更新标签&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult&lt;Void&gt; <span class="title function_">updateTag</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@ApiParam(&quot;标签ID&quot;)</span> <span class="meta">@PathVariable</span> Long tagId,</span></span><br><span class="line"><span class="params">            <span class="meta">@ApiParam(&quot;标签名称&quot;)</span> <span class="meta">@RequestParam</span> String name)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> blogTagService.updateTag(tagId, name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除标签</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/&#123;tagId&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;删除标签&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult&lt;Void&gt; <span class="title function_">deleteTag</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@ApiParam(&quot;标签ID&quot;)</span> <span class="meta">@PathVariable</span> Long tagId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> blogTagService.deleteTag(tagId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取文章的标签列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/post/&#123;postId&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;获取文章的标签列表&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult&lt;List&lt;BlogTagVo&gt;&gt; <span class="title function_">getPostTags</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@ApiParam(&quot;文章ID&quot;)</span> <span class="meta">@PathVariable</span> Long postId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> blogTagService.getPostTags(postId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<h4 id="blogpostservice">BlogPostService</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.luotao.job.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.pagination.Page;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.IService;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.domain.BlogPost;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.utils.ResponseResult;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.vo.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* <span class="doctag">@author</span> T</span></span><br><span class="line"><span class="comment">* <span class="doctag">@description</span> 针对表【blog_post(博客文章表)】的数据库操作Service</span></span><br><span class="line"><span class="comment">* <span class="doctag">@createDate</span> 2025-03-30 16:02:34</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BlogPostService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;BlogPost&gt; &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建博客文章</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId 用户ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> createVo 创建文章请求</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 创建结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ResponseResult&lt;Long&gt; <span class="title function_">createPost</span><span class="params">(Long userId, BlogPostCreateVo createVo)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新博客文章</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId 用户ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> postId 文章ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> updateVo 更新文章请求</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 更新结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ResponseResult&lt;Void&gt; <span class="title function_">updatePost</span><span class="params">(Long userId, Long postId, BlogPostUpdateVo updateVo)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取博客文章详情</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> postId 文章ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> increaseViewCount 是否增加浏览量</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 文章详情</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ResponseResult&lt;BlogPostDetailVo&gt; <span class="title function_">getPostDetail</span><span class="params">(Long postId, <span class="type">boolean</span> increaseViewCount)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页查询博客文章列表</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> queryVo 查询参数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 分页结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ResponseResult&lt;Page&lt;BlogPostListVo&gt;&gt; <span class="title function_">getPostList</span><span class="params">(BlogPostQueryVo queryVo)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除博客文章</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId 用户ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> postId 文章ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 删除结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ResponseResult&lt;Void&gt; <span class="title function_">deletePost</span><span class="params">(Long userId, Long postId)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将文章移至回收站</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId 用户ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> postId 文章ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 操作结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ResponseResult&lt;Void&gt; <span class="title function_">moveToRecycleBin</span><span class="params">(Long userId, Long postId)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 从回收站恢复文章</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId 用户ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> postId 文章ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 操作结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ResponseResult&lt;Void&gt; <span class="title function_">restoreFromRecycleBin</span><span class="params">(Long userId, Long postId)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 点赞文章</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> postId 文章ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 操作结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ResponseResult&lt;Void&gt; <span class="title function_">likePost</span><span class="params">(Long postId)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取用户的文章列表</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId 用户ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> status 状态</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 文章列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ResponseResult&lt;List&lt;BlogPostListVo&gt;&gt; <span class="title function_">getUserPosts</span><span class="params">(Long userId, Integer status)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="blogpostserviceimpl">BlogPostServiceImpl</h4>
<blockquote>
<p>数据校验：</p>
<p>创建和更新分类时，检查名称是否为空</p>
<p>检查分类名称是否已存在，避免重复</p>
<p>删除分类前，检查是否有文章使用该分类</p>
<p>业务逻辑：</p>
<p>获取分类列表时，同时查询每个分类下的文章数量</p>
<p>更新分类时，只更新有变化的字段</p>
<p>删除分类时，如果有关联文章则拒绝删除</p>
<p>性能优化：</p>
<p>使用自定义SQL查询分类及其文章数量</p>
<p>使用Lambda表达式构建查询条件</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.luotao.job.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.metadata.IPage;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.pagination.Page;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.domain.BlogPost;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.domain.BlogPostTag;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.domain.BlogTag;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.domain.User;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.mapper.BlogPostMapper;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.mapper.BlogPostTagMapper;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.mapper.BlogTagMapper;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.mapper.UserMapper;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.service.BlogPostService;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.utils.ResponseResult;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.vo.*;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeanUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> luotao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 博客文章服务实现类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BlogPostServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;BlogPostMapper, BlogPost&gt; <span class="keyword">implements</span> <span class="title class_">BlogPostService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> BlogPostTagMapper blogPostTagMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> BlogTagMapper blogTagMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建博客文章</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId   用户ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> createVo 创建文章请求</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 创建结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult&lt;Long&gt; <span class="title function_">createPost</span><span class="params">(Long userId, BlogPostCreateVo createVo)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 检查用户是否存在</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.selectById(userId);</span><br><span class="line">        <span class="keyword">if</span> (user == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(<span class="number">400</span>, <span class="string">&quot;用户不存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 构建博客文章对象</span></span><br><span class="line">        <span class="type">BlogPost</span> <span class="variable">blogPost</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BlogPost</span>();</span><br><span class="line">        BeanUtils.copyProperties(createVo, blogPost);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. 设置作者ID和默认值</span></span><br><span class="line">        blogPost.setAuthorId(userId);</span><br><span class="line">        blogPost.setViewCount(<span class="number">0</span>);</span><br><span class="line">        blogPost.setCommentCount(<span class="number">0</span>);</span><br><span class="line">        blogPost.setLikeCount(<span class="number">0</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 4. 如果摘要为空，自动生成摘要</span></span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.hasText(blogPost.getSummary()) &amp;&amp; StringUtils.hasText(blogPost.getContent())) &#123;</span><br><span class="line">            <span class="comment">// 从内容中提取前100个字符作为摘要</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> blogPost.getContent();</span><br><span class="line">            <span class="comment">// 去除Markdown标记</span></span><br><span class="line">            content = content.replaceAll(<span class="string">&quot;#+\\s*&quot;</span>, <span class="string">&quot;&quot;</span>)  <span class="comment">// 标题</span></span><br><span class="line">                    .replaceAll(<span class="string">&quot;!?\\[.*?\\]\\(.*?\\)&quot;</span>, <span class="string">&quot;&quot;</span>) <span class="comment">// 链接和图片</span></span><br><span class="line">                    .replaceAll(<span class="string">&quot;\\*\\*|__&quot;</span>, <span class="string">&quot;&quot;</span>) <span class="comment">// 粗体</span></span><br><span class="line">                    .replaceAll(<span class="string">&quot;\\*|_&quot;</span>, <span class="string">&quot;&quot;</span>)     <span class="comment">// 斜体</span></span><br><span class="line">                    .replaceAll(<span class="string">&quot;`.*?`&quot;</span>, <span class="string">&quot;&quot;</span>)     <span class="comment">// 行内代码</span></span><br><span class="line">                    .replaceAll(<span class="string">&quot;```[\\s\\S]*?```&quot;</span>, <span class="string">&quot;&quot;</span>) <span class="comment">// 代码块</span></span><br><span class="line">                    .replaceAll(<span class="string">&quot;\\n&quot;</span>, <span class="string">&quot; &quot;</span>);     <span class="comment">// 换行</span></span><br><span class="line">            </span><br><span class="line">            blogPost.setSummary(content.length() &gt; <span class="number">100</span> ? content.substring(<span class="number">0</span>, <span class="number">100</span>) + <span class="string">&quot;...&quot;</span> : content);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 5. 保存文章</span></span><br><span class="line">        save(blogPost);</span><br><span class="line">        <span class="type">Long</span> <span class="variable">postId</span> <span class="operator">=</span> blogPost.getId();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 6. 处理标签关联</span></span><br><span class="line">        <span class="keyword">if</span> (createVo.getTagIds() != <span class="literal">null</span> &amp;&amp; !createVo.getTagIds().isEmpty()) &#123;</span><br><span class="line">            List&lt;BlogPostTag&gt; postTags = createVo.getTagIds().stream()</span><br><span class="line">                    .map(tagId -&gt; &#123;</span><br><span class="line">                        <span class="type">BlogPostTag</span> <span class="variable">postTag</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BlogPostTag</span>();</span><br><span class="line">                        postTag.setPostId(postId);</span><br><span class="line">                        postTag.setTagId(tagId);</span><br><span class="line">                        <span class="keyword">return</span> postTag;</span><br><span class="line">                    &#125;)</span><br><span class="line">                    .collect(Collectors.toList());</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 批量插入标签关联</span></span><br><span class="line">            <span class="keyword">for</span> (BlogPostTag postTag : postTags) &#123;</span><br><span class="line">                blogPostTagMapper.insert(postTag);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(<span class="number">200</span>, <span class="string">&quot;创建成功&quot;</span>, postId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新博客文章</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId   用户ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> postId   文章ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> updateVo 更新文章请求</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 更新结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult&lt;Void&gt; <span class="title function_">updatePost</span><span class="params">(Long userId, Long postId, BlogPostUpdateVo updateVo)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 检查文章是否存在</span></span><br><span class="line">        <span class="type">BlogPost</span> <span class="variable">blogPost</span> <span class="operator">=</span> getById(postId);</span><br><span class="line">        <span class="keyword">if</span> (blogPost == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(<span class="number">404</span>, <span class="string">&quot;文章不存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. 检查权限（只有作者或管理员可以修改）</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.selectById(userId);</span><br><span class="line">        <span class="keyword">if</span> (user == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(<span class="number">400</span>, <span class="string">&quot;用户不存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!blogPost.getAuthorId().equals(userId) &amp;&amp; !<span class="string">&quot;ADMIN&quot;</span>.equals(user.getRole())) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(<span class="number">403</span>, <span class="string">&quot;无权限修改此文章&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. 更新文章基本信息</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">needUpdate</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (StringUtils.hasText(updateVo.getTitle())) &#123;</span><br><span class="line">            blogPost.setTitle(updateVo.getTitle());</span><br><span class="line">            needUpdate = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (updateVo.getContent() != <span class="literal">null</span>) &#123;</span><br><span class="line">            blogPost.setContent(updateVo.getContent());</span><br><span class="line">            needUpdate = <span class="literal">true</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 如果内容更新了，且摘要为空或也要更新，则重新生成摘要</span></span><br><span class="line">            <span class="keyword">if</span> ((!StringUtils.hasText(blogPost.getSummary()) || StringUtils.hasText(updateVo.getSummary())) </span><br><span class="line">                    &amp;&amp; StringUtils.hasText(updateVo.getContent())) &#123;</span><br><span class="line">                <span class="comment">// 从内容中提取前100个字符作为摘要</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> updateVo.getContent();</span><br><span class="line">                <span class="comment">// 去除Markdown标记</span></span><br><span class="line">                content = content.replaceAll(<span class="string">&quot;#+\\s*&quot;</span>, <span class="string">&quot;&quot;</span>)  <span class="comment">// 标题</span></span><br><span class="line">                        .replaceAll(<span class="string">&quot;!?\\[.*?\\]\\(.*?\\)&quot;</span>, <span class="string">&quot;&quot;</span>) <span class="comment">// 链接和图片</span></span><br><span class="line">                        .replaceAll(<span class="string">&quot;\\*\\*|__&quot;</span>, <span class="string">&quot;&quot;</span>) <span class="comment">// 粗体</span></span><br><span class="line">                        .replaceAll(<span class="string">&quot;\\*|_&quot;</span>, <span class="string">&quot;&quot;</span>)     <span class="comment">// 斜体</span></span><br><span class="line">                        .replaceAll(<span class="string">&quot;`.*?`&quot;</span>, <span class="string">&quot;&quot;</span>)     <span class="comment">// 行内代码</span></span><br><span class="line">                        .replaceAll(<span class="string">&quot;```[\\s\\S]*?```&quot;</span>, <span class="string">&quot;&quot;</span>) <span class="comment">// 代码块</span></span><br><span class="line">                        .replaceAll(<span class="string">&quot;\\n&quot;</span>, <span class="string">&quot; &quot;</span>);     <span class="comment">// 换行</span></span><br><span class="line">                </span><br><span class="line">                blogPost.setSummary(content.length() &gt; <span class="number">100</span> ? content.substring(<span class="number">0</span>, <span class="number">100</span>) + <span class="string">&quot;...&quot;</span> : content);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (StringUtils.hasText(updateVo.getSummary())) &#123;</span><br><span class="line">            blogPost.setSummary(updateVo.getSummary());</span><br><span class="line">            needUpdate = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (updateVo.getCoverImage() != <span class="literal">null</span>) &#123;</span><br><span class="line">            blogPost.setCoverImage(updateVo.getCoverImage());</span><br><span class="line">            needUpdate = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (updateVo.getCategoryId() != <span class="literal">null</span>) &#123;</span><br><span class="line">            blogPost.setCategoryId(updateVo.getCategoryId());</span><br><span class="line">            needUpdate = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (updateVo.getStatus() != <span class="literal">null</span>) &#123;</span><br><span class="line">            blogPost.setStatus(updateVo.getStatus());</span><br><span class="line">            needUpdate = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (updateVo.getIsTop() != <span class="literal">null</span>) &#123;</span><br><span class="line">            blogPost.setIsTop(updateVo.getIsTop());</span><br><span class="line">            needUpdate = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (updateVo.getIsOriginal() != <span class="literal">null</span>) &#123;</span><br><span class="line">            blogPost.setIsOriginal(updateVo.getIsOriginal());</span><br><span class="line">            needUpdate = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (updateVo.getSourceUrl() != <span class="literal">null</span>) &#123;</span><br><span class="line">            blogPost.setSourceUrl(updateVo.getSourceUrl());</span><br><span class="line">            needUpdate = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 4. 更新文章</span></span><br><span class="line">        <span class="keyword">if</span> (needUpdate) &#123;</span><br><span class="line">            updateById(blogPost);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 5. 处理标签关联</span></span><br><span class="line">        <span class="keyword">if</span> (updateVo.getTagIds() != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 先删除原有标签关联</span></span><br><span class="line">            blogPostTagMapper.deleteByPostId(postId);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 添加新的标签关联</span></span><br><span class="line">            <span class="keyword">if</span> (!updateVo.getTagIds().isEmpty()) &#123;</span><br><span class="line">                List&lt;BlogPostTag&gt; postTags = updateVo.getTagIds().stream()</span><br><span class="line">                        .map(tagId -&gt; &#123;</span><br><span class="line">                            <span class="type">BlogPostTag</span> <span class="variable">postTag</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BlogPostTag</span>();</span><br><span class="line">                            postTag.setPostId(postId);</span><br><span class="line">                            postTag.setTagId(tagId);</span><br><span class="line">                            <span class="keyword">return</span> postTag;</span><br><span class="line">                        &#125;)</span><br><span class="line">                        .collect(Collectors.toList());</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 批量插入标签关联</span></span><br><span class="line">                <span class="keyword">for</span> (BlogPostTag postTag : postTags) &#123;</span><br><span class="line">                    blogPostTagMapper.insert(postTag);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(<span class="number">200</span>, <span class="string">&quot;更新成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取博客文章详情</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> postId           文章ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> increaseViewCount 是否增加浏览量</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 文章详情</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult&lt;BlogPostDetailVo&gt; <span class="title function_">getPostDetail</span><span class="params">(Long postId, <span class="type">boolean</span> increaseViewCount)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 查询文章</span></span><br><span class="line">        <span class="type">BlogPost</span> <span class="variable">blogPost</span> <span class="operator">=</span> getById(postId);</span><br><span class="line">        <span class="keyword">if</span> (blogPost == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(<span class="number">404</span>, <span class="string">&quot;文章不存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. 增加浏览量</span></span><br><span class="line">        <span class="keyword">if</span> (increaseViewCount) &#123;</span><br><span class="line">            baseMapper.incrementViewCount(postId);</span><br><span class="line">            blogPost.setViewCount(blogPost.getViewCount() + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. 查询作者信息</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">author</span> <span class="operator">=</span> userMapper.selectById(blogPost.getAuthorId());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 4. 查询标签信息</span></span><br><span class="line">        List&lt;BlogTag&gt; tags = blogTagMapper.selectTagsByPostId(postId);</span><br><span class="line">        List&lt;BlogTagVo&gt; tagVos = tags.stream().map(tag -&gt; &#123;</span><br><span class="line">            <span class="type">BlogTagVo</span> <span class="variable">tagVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BlogTagVo</span>();</span><br><span class="line">            tagVo.setId(tag.getId());</span><br><span class="line">            tagVo.setName(tag.getName());</span><br><span class="line">            <span class="keyword">return</span> tagVo;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 5. 构建详情VO</span></span><br><span class="line">        <span class="type">BlogPostDetailVo</span> <span class="variable">detailVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BlogPostDetailVo</span>();</span><br><span class="line">        BeanUtils.copyProperties(blogPost, detailVo);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 设置作者信息</span></span><br><span class="line">        <span class="keyword">if</span> (author != <span class="literal">null</span>) &#123;</span><br><span class="line">            detailVo.setAuthorName(author.getUsername());</span><br><span class="line">            detailVo.setAuthorAvatar(author.getAvatar());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 设置标签信息</span></span><br><span class="line">        detailVo.setTags(tagVos);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(<span class="number">200</span>, <span class="string">&quot;获取成功&quot;</span>, detailVo);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页查询博客文章列表</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> queryVo 查询参数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 分页结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult&lt;Page&lt;BlogPostListVo&gt;&gt; <span class="title function_">getPostList</span><span class="params">(BlogPostQueryVo queryVo)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 创建分页对象</span></span><br><span class="line">        Page&lt;BlogPostListVo&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(queryVo.getPage(), queryVo.getSize());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. 调用Mapper查询</span></span><br><span class="line">        IPage&lt;BlogPostListVo&gt; postPage = baseMapper.selectPostList(</span><br><span class="line">                page,</span><br><span class="line">                queryVo.getCategoryId(),</span><br><span class="line">                queryVo.getTagId(),</span><br><span class="line">                queryVo.getKeyword(),</span><br><span class="line">                queryVo.getStatus()</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(<span class="number">200</span>, <span class="string">&quot;获取成功&quot;</span>, (Page&lt;BlogPostListVo&gt;) postPage);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除博客文章</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId 用户ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> postId 文章ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 删除结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult&lt;Void&gt; <span class="title function_">deletePost</span><span class="params">(Long userId, Long postId)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 检查文章是否存在</span></span><br><span class="line">        <span class="type">BlogPost</span> <span class="variable">blogPost</span> <span class="operator">=</span> getById(postId);</span><br><span class="line">        <span class="keyword">if</span> (blogPost == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(<span class="number">404</span>, <span class="string">&quot;文章不存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. 检查权限（只有作者或管理员可以删除）</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.selectById(userId);</span><br><span class="line">        <span class="keyword">if</span> (user == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(<span class="number">400</span>, <span class="string">&quot;用户不存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!blogPost.getAuthorId().equals(userId) &amp;&amp; !<span class="string">&quot;ADMIN&quot;</span>.equals(user.getRole())) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(<span class="number">403</span>, <span class="string">&quot;无权限删除此文章&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. 删除标签关联</span></span><br><span class="line">        blogPostTagMapper.deleteByPostId(postId);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 4. 删除文章</span></span><br><span class="line">        removeById(postId);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(<span class="number">200</span>, <span class="string">&quot;删除成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将文章移至回收站</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId 用户ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> postId 文章ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 操作结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult&lt;Void&gt; <span class="title function_">moveToRecycleBin</span><span class="params">(Long userId, Long postId)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 检查文章是否存在</span></span><br><span class="line">        <span class="type">BlogPost</span> <span class="variable">blogPost</span> <span class="operator">=</span> getById(postId);</span><br><span class="line">        <span class="keyword">if</span> (blogPost == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(<span class="number">404</span>, <span class="string">&quot;文章不存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. 检查权限（只有作者或管理员可以操作）</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.selectById(userId);</span><br><span class="line">        <span class="keyword">if</span> (user == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(<span class="number">400</span>, <span class="string">&quot;用户不存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!blogPost.getAuthorId().equals(userId) &amp;&amp; !<span class="string">&quot;ADMIN&quot;</span>.equals(user.getRole())) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(<span class="number">403</span>, <span class="string">&quot;无权限操作此文章&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. 更新状态为回收站(2)</span></span><br><span class="line">        blogPost.setStatus(<span class="number">2</span>);</span><br><span class="line">        updateById(blogPost);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(<span class="number">200</span>, <span class="string">&quot;已移至回收站&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 从回收站恢复文章</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId 用户ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> postId 文章ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 操作结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult&lt;Void&gt; <span class="title function_">restoreFromRecycleBin</span><span class="params">(Long userId, Long postId)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 检查文章是否存在</span></span><br><span class="line">        <span class="type">BlogPost</span> <span class="variable">blogPost</span> <span class="operator">=</span> getById(postId);</span><br><span class="line">        <span class="keyword">if</span> (blogPost == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(<span class="number">404</span>, <span class="string">&quot;文章不存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. 检查文章是否在回收站</span></span><br><span class="line">        <span class="keyword">if</span> (blogPost.getStatus() != <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(<span class="number">400</span>, <span class="string">&quot;文章不在回收站&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. 检查权限（只有作者或管理员可以操作）</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.selectById(userId);</span><br><span class="line">        <span class="keyword">if</span> (user == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(<span class="number">400</span>, <span class="string">&quot;用户不存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!blogPost.getAuthorId().equals(userId) &amp;&amp; !<span class="string">&quot;ADMIN&quot;</span>.equals(user.getRole())) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(<span class="number">403</span>, <span class="string">&quot;无权限操作此文章&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 4. 恢复为草稿状态(0)</span></span><br><span class="line">        blogPost.setStatus(<span class="number">0</span>);</span><br><span class="line">        updateById(blogPost);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(<span class="number">200</span>, <span class="string">&quot;已从回收站恢复&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 点赞文章</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> postId 文章ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 操作结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult&lt;Void&gt; <span class="title function_">likePost</span><span class="params">(Long postId)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 检查文章是否存在</span></span><br><span class="line">        <span class="type">BlogPost</span> <span class="variable">blogPost</span> <span class="operator">=</span> getById(postId);</span><br><span class="line">        <span class="keyword">if</span> (blogPost == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(<span class="number">404</span>, <span class="string">&quot;文章不存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. 增加点赞数</span></span><br><span class="line">        baseMapper.incrementLikeCount(postId);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(<span class="number">200</span>, <span class="string">&quot;点赞成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取用户的文章列表</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId 用户ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> status 状态</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 文章列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult&lt;List&lt;BlogPostListVo&gt;&gt; <span class="title function_">getUserPosts</span><span class="params">(Long userId, Integer status)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 检查用户是否存在</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.selectById(userId);</span><br><span class="line">        <span class="keyword">if</span> (user == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(<span class="number">400</span>, <span class="string">&quot;用户不存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. 创建查询对象</span></span><br><span class="line">        <span class="type">BlogPostQueryVo</span> <span class="variable">queryVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BlogPostQueryVo</span>();</span><br><span class="line">        queryVo.setAuthorId(userId);</span><br><span class="line">        queryVo.setStatus(status);</span><br><span class="line">        queryVo.setPage(<span class="number">1</span>);</span><br><span class="line">        queryVo.setSize(Integer.MAX_VALUE); <span class="comment">// 获取所有文章</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. 查询文章列表</span></span><br><span class="line">        ResponseResult&lt;Page&lt;BlogPostListVo&gt;&gt; result = getPostList(queryVo);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (result.getCode() != <span class="number">200</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(result.getCode(), result.getMsg());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line"><span class="comment">//        return new ResponseResult&lt;&gt;(200, &quot;获取成功&quot;, result.getData().getRecords());</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>(<span class="number">200</span>, <span class="string">&quot;获取成功&quot;</span>, result.getData());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="blogcategorycontroller">BlogCategoryController</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.luotao.job.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.luotao.job.service.BlogCategoryService;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.utils.ResponseResult;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.vo.BlogCategoryVo;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.vo.BlogCategoryCreateVo;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiParam;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> luotao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 博客分类控制器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/blog/categories&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;博客分类管理接口&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BlogCategoryController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> BlogCategoryService blogCategoryService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取所有分类列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;获取所有分类列表&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult&lt;List&lt;BlogCategoryVo&gt;&gt; <span class="title function_">getAllCategories</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> blogCategoryService.getAllCategories();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建分类</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;创建分类&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult&lt;Long&gt; <span class="title function_">createCategory</span><span class="params">(<span class="meta">@RequestBody</span> BlogCategoryCreateVo categoryVo)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            log.info(<span class="string">&quot;创建分类，参数：&#123;&#125;&quot;</span>, categoryVo);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (!StringUtils.hasText(categoryVo.getName())) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(<span class="number">400</span>, <span class="string">&quot;分类名称不能为空&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> blogCategoryService.createCategory(</span><br><span class="line">                categoryVo.getName(), </span><br><span class="line">                categoryVo.getDescription(), </span><br><span class="line">                categoryVo.getSort()</span><br><span class="line">            );</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;创建分类失败: &quot;</span>, e);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(<span class="number">500</span>, <span class="string">&quot;创建分类失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新分类</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PutMapping(&quot;/&#123;categoryId&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;更新分类&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult&lt;Void&gt; <span class="title function_">updateCategory</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@ApiParam(&quot;分类ID&quot;)</span> <span class="meta">@PathVariable</span> Long categoryId,</span></span><br><span class="line"><span class="params">            <span class="meta">@ApiParam(&quot;分类名称&quot;)</span> <span class="meta">@RequestParam(required = false)</span> String name,</span></span><br><span class="line"><span class="params">            <span class="meta">@ApiParam(&quot;分类描述&quot;)</span> <span class="meta">@RequestParam(required = false)</span> String description,</span></span><br><span class="line"><span class="params">            <span class="meta">@ApiParam(&quot;排序&quot;)</span> <span class="meta">@RequestParam(required = false)</span> Integer sort)</span> &#123;</span><br><span class="line">        System.out.println(categoryId );</span><br><span class="line">        System.out.println(name );</span><br><span class="line">        System.out.println(description );</span><br><span class="line">        System.out.println(sort );</span><br><span class="line">        <span class="keyword">return</span> blogCategoryService.updateCategory(categoryId, name, description, sort);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除分类</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/&#123;categoryId&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;删除分类&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult&lt;Void&gt; <span class="title function_">deleteCategory</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@ApiParam(&quot;分类ID&quot;)</span> <span class="meta">@PathVariable</span> Long categoryId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> blogCategoryService.deleteCategory(categoryId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<h4 id="blogcategoryservice">BlogCategoryService</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.luotao.job.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.IService;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.domain.BlogCategory;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.utils.ResponseResult;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.vo.BlogCategoryVo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> luotao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 博客分类服务接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BlogCategoryService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;BlogCategory&gt; &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取所有分类列表</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 分类列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ResponseResult&lt;List&lt;BlogCategoryVo&gt;&gt; <span class="title function_">getAllCategories</span><span class="params">()</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建分类</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name 分类名称</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> description 分类描述</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sort 排序</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 创建结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ResponseResult&lt;Long&gt; <span class="title function_">createCategory</span><span class="params">(String name, String description, Integer sort)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新分类</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> categoryId 分类ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name 分类名称</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> description 分类描述</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sort 排序</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 更新结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ResponseResult&lt;Void&gt; <span class="title function_">updateCategory</span><span class="params">(Long categoryId, String name, String description, Integer sort)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除分类</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> categoryId 分类ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 删除结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ResponseResult&lt;Void&gt; <span class="title function_">deleteCategory</span><span class="params">(Long categoryId)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="blogcategoryserviceimpl">BlogCategoryServiceImpl</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.luotao.job.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.domain.BlogCategory;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.domain.BlogPost;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.mapper.BlogCategoryMapper;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.mapper.BlogPostMapper;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.service.BlogCategoryService;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.utils.ResponseResult;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.vo.BlogCategoryVo;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> luotao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 博客分类服务实现类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BlogCategoryServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;BlogCategoryMapper, BlogCategory&gt; <span class="keyword">implements</span> <span class="title class_">BlogCategoryService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> BlogPostMapper blogPostMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取所有分类列表</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 分类列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult&lt;List&lt;BlogCategoryVo&gt;&gt; <span class="title function_">getAllCategories</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 查询所有分类及其文章数量</span></span><br><span class="line">        List&lt;BlogCategory&gt; categories = baseMapper.selectCategoryWithCount();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. 转换为VO对象</span></span><br><span class="line">        List&lt;BlogCategoryVo&gt; categoryVos = categories.stream().map(category -&gt; &#123;</span><br><span class="line">            <span class="type">BlogCategoryVo</span> <span class="variable">categoryVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BlogCategoryVo</span>();</span><br><span class="line">            categoryVo.setId(category.getId());</span><br><span class="line">            categoryVo.setName(category.getName());</span><br><span class="line">            categoryVo.setDescription(category.getDescription());</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 查询该分类下的文章数量</span></span><br><span class="line">            LambdaQueryWrapper&lt;BlogPost&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">            queryWrapper.eq(BlogPost::getCategoryId, category.getId())</span><br><span class="line">                    .eq(BlogPost::getStatus, <span class="number">1</span>); <span class="comment">// 只统计已发布的文章</span></span><br><span class="line"><span class="comment">//            int count = blogPostMapper.selectCount(queryWrapper);</span></span><br><span class="line">            <span class="type">Long</span> <span class="variable">countLong</span> <span class="operator">=</span> blogPostMapper.selectCount(queryWrapper);</span><br><span class="line">            <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> (countLong == <span class="literal">null</span>) ? <span class="number">0</span> : countLong.intValue(); <span class="comment">// 显式转换并处理 null 情</span></span><br><span class="line">            categoryVo.setPostCount(count);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> categoryVo;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(<span class="number">200</span>, <span class="string">&quot;获取成功&quot;</span>, categoryVos);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建分类</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name        分类名称</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> description 分类描述</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sort        排序</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 创建结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult&lt;Long&gt; <span class="title function_">createCategory</span><span class="params">(String name, String description, Integer sort)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1. 检查分类名称是否已存在</span></span><br><span class="line">            LambdaQueryWrapper&lt;BlogCategory&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">            queryWrapper.eq(BlogCategory::getName, name);</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.count(queryWrapper) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(<span class="number">400</span>, <span class="string">&quot;分类名称已存在&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 2. 创建分类</span></span><br><span class="line">            <span class="type">BlogCategory</span> <span class="variable">category</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BlogCategory</span>();</span><br><span class="line">            category.setName(name);</span><br><span class="line">            category.setDescription(description);</span><br><span class="line">            category.setSort(sort != <span class="literal">null</span> ? sort : <span class="number">0</span>);</span><br><span class="line">            category.setCreateTime(LocalDateTime.now());</span><br><span class="line">            category.setUpdateTime(LocalDateTime.now());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 3. 保存分类</span></span><br><span class="line">            <span class="built_in">this</span>.save(category);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(<span class="number">200</span>, <span class="string">&quot;创建成功&quot;</span>, category.getId());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;创建分类失败: &quot;</span>, e);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(<span class="number">500</span>, <span class="string">&quot;创建分类失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新分类</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> categoryId  分类ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name        分类名称</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> description 分类描述</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sort        排序</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 更新结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult&lt;Void&gt; <span class="title function_">updateCategory</span><span class="params">(Long categoryId, String name, String description, Integer sort)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 检查分类是否存在</span></span><br><span class="line">        <span class="type">BlogCategory</span> <span class="variable">category</span> <span class="operator">=</span> getById(categoryId);</span><br><span class="line">        <span class="keyword">if</span> (category == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(<span class="number">404</span>, <span class="string">&quot;分类不存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. 如果修改了名称，检查名称是否已存在</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.hasText(name) &amp;&amp; !name.equals(category.getName())) &#123;</span><br><span class="line">            LambdaQueryWrapper&lt;BlogCategory&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">            queryWrapper.eq(BlogCategory::getName, name);</span><br><span class="line">            <span class="keyword">if</span> (baseMapper.selectCount(queryWrapper) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(<span class="number">400</span>, <span class="string">&quot;分类名称已存在&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            category.setName(name);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. 更新其他字段</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.hasText(description)) &#123;</span><br><span class="line">            category.setDescription(description);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (sort != <span class="literal">null</span>) &#123;</span><br><span class="line">            category.setSort(sort);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        category.setUpdateTime(LocalDateTime.now());</span><br><span class="line">        updateById(category);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(<span class="number">200</span>, <span class="string">&quot;更新成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除分类</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> categoryId 分类ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 删除结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult&lt;Void&gt; <span class="title function_">deleteCategory</span><span class="params">(Long categoryId)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 检查分类是否存在</span></span><br><span class="line">        <span class="type">BlogCategory</span> <span class="variable">category</span> <span class="operator">=</span> getById(categoryId);</span><br><span class="line">        <span class="keyword">if</span> (category == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(<span class="number">404</span>, <span class="string">&quot;分类不存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. 检查是否有文章使用该分类</span></span><br><span class="line">        LambdaQueryWrapper&lt;BlogPost&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(BlogPost::getCategoryId, categoryId);</span><br><span class="line">        <span class="type">long</span> <span class="variable">count</span> <span class="operator">=</span> blogPostMapper.selectCount(queryWrapper);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(<span class="number">400</span>, <span class="string">&quot;该分类下有&quot;</span> + count + <span class="string">&quot;篇文章，无法删除&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. 删除分类</span></span><br><span class="line">        removeById(categoryId);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(<span class="number">200</span>, <span class="string">&quot;删除成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="blogtagcontroller">BlogTagController</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.luotao.job.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.luotao.job.service.BlogTagService;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.utils.ResponseResult;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.vo.BlogTagCreateVo;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.vo.BlogTagVo;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiParam;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> luotao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 博客标签控制器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/blog/tags&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;博客标签管理接口&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BlogTagController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> BlogTagService blogTagService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取所有标签列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;获取所有标签列表&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult&lt;List&lt;BlogTagVo&gt;&gt; <span class="title function_">getAllTags</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> blogTagService.getAllTags();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建标签</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;创建标签&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult&lt;Long&gt; <span class="title function_">createTag</span><span class="params">(<span class="meta">@RequestBody</span> BlogTagCreateVo tagVo)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            log.info(<span class="string">&quot;创建标签，参数：&#123;&#125;&quot;</span>, tagVo);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (!StringUtils.hasText(tagVo.getName())) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(<span class="number">400</span>, <span class="string">&quot;标签名称不能为空&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> blogTagService.createTag(tagVo.getName());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;创建标签失败: &quot;</span>, e);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(<span class="number">500</span>, <span class="string">&quot;创建标签失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新标签</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PutMapping(&quot;/&#123;tagId&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;更新标签&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult&lt;Void&gt; <span class="title function_">updateTag</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@ApiParam(&quot;标签ID&quot;)</span> <span class="meta">@PathVariable</span> Long tagId,</span></span><br><span class="line"><span class="params">            <span class="meta">@ApiParam(&quot;标签名称&quot;)</span> <span class="meta">@RequestParam</span> String name)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> blogTagService.updateTag(tagId, name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除标签</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/&#123;tagId&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;删除标签&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult&lt;Void&gt; <span class="title function_">deleteTag</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@ApiParam(&quot;标签ID&quot;)</span> <span class="meta">@PathVariable</span> Long tagId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> blogTagService.deleteTag(tagId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取文章的标签列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/post/&#123;postId&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;获取文章的标签列表&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult&lt;List&lt;BlogTagVo&gt;&gt; <span class="title function_">getPostTags</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@ApiParam(&quot;文章ID&quot;)</span> <span class="meta">@PathVariable</span> Long postId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> blogTagService.getPostTags(postId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<h4 id="blogtagservice">BlogTagService</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.luotao.job.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.IService;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.domain.BlogTag;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.utils.ResponseResult;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.vo.BlogTagVo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> luotao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 博客标签服务接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BlogTagService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;BlogTag&gt; &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取所有标签列表</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 标签列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ResponseResult&lt;List&lt;BlogTagVo&gt;&gt; <span class="title function_">getAllTags</span><span class="params">()</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建标签</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name 标签名称</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 创建结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ResponseResult&lt;Long&gt; <span class="title function_">createTag</span><span class="params">(String name)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新标签</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> tagId 标签ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name 标签名称</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 更新结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ResponseResult&lt;Void&gt; <span class="title function_">updateTag</span><span class="params">(Long tagId, String name)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除标签</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> tagId 标签ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 删除结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ResponseResult&lt;Void&gt; <span class="title function_">deleteTag</span><span class="params">(Long tagId)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取文章的标签列表</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> postId 文章ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 标签列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ResponseResult&lt;List&lt;BlogTagVo&gt;&gt; <span class="title function_">getPostTags</span><span class="params">(Long postId)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="blogtagserviceimpl">BlogTagServiceImpl</h4>
<blockquote>
<p>数据校验：</p>
<p>创建和更新标签时，检查名称是否为空</p>
<p>检查标签名称是否已存在，避免重复</p>
<p>删除标签前，检查是否有文章使用该标签</p>
<p>业务逻辑：</p>
<p>获取标签列表时，同时查询每个标签关联的文章数量</p>
<p>获取文章标签时，使用自定义SQL直接查询关联标签</p>
<p>删除标签时，如果有关联文章则拒绝删除</p>
<p>性能优化：</p>
<p>使用自定义SQL查询标签及其文章数量</p>
<p>使用Stream API进行数据转换</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.luotao.job.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.domain.BlogPostTag;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.domain.BlogTag;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.mapper.BlogPostTagMapper;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.mapper.BlogTagMapper;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.service.BlogTagService;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.utils.ResponseResult;</span><br><span class="line"><span class="keyword">import</span> com.luotao.job.vo.BlogTagVo;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> luotao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 博客标签服务实现类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BlogTagServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;BlogTagMapper, BlogTag&gt; <span class="keyword">implements</span> <span class="title class_">BlogTagService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> BlogPostTagMapper blogPostTagMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取所有标签列表</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 标签列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult&lt;List&lt;BlogTagVo&gt;&gt; <span class="title function_">getAllTags</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 查询所有标签及其文章数量</span></span><br><span class="line">        List&lt;BlogTag&gt; tags = baseMapper.selectTagWithCount();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. 转换为VO对象</span></span><br><span class="line">        List&lt;BlogTagVo&gt; tagVos = tags.stream().map(tag -&gt; &#123;</span><br><span class="line">            <span class="type">BlogTagVo</span> <span class="variable">tagVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BlogTagVo</span>();</span><br><span class="line">            tagVo.setId(tag.getId());</span><br><span class="line">            tagVo.setName(tag.getName());</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 查询使用该标签的文章数量</span></span><br><span class="line">            LambdaQueryWrapper&lt;BlogPostTag&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">            queryWrapper.eq(BlogPostTag::getTagId, tag.getId());</span><br><span class="line"><span class="comment">//            int count = blogPostTagMapper.selectCount(queryWrapper);</span></span><br><span class="line">            <span class="type">Long</span> <span class="variable">countLong</span> <span class="operator">=</span> blogPostTagMapper.selectCount(queryWrapper);</span><br><span class="line">            <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> (countLong == <span class="literal">null</span>) ? <span class="number">0</span> : countLong.intValue();</span><br><span class="line">            tagVo.setPostCount(count);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> tagVo;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(<span class="number">200</span>, <span class="string">&quot;获取成功&quot;</span>, tagVos);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建标签</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name 标签名称</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 创建结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult&lt;Long&gt; <span class="title function_">createTag</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1. 检查标签名称是否已存在</span></span><br><span class="line">            LambdaQueryWrapper&lt;BlogTag&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">            queryWrapper.eq(BlogTag::getName, name);</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.count(queryWrapper) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(<span class="number">400</span>, <span class="string">&quot;标签名称已存在&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 2. 创建标签</span></span><br><span class="line">            <span class="type">BlogTag</span> <span class="variable">tag</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BlogTag</span>();</span><br><span class="line">            tag.setName(name);</span><br><span class="line">            tag.setCreateTime(LocalDateTime.now());</span><br><span class="line">            tag.setUpdateTime(LocalDateTime.now());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 3. 保存标签</span></span><br><span class="line">            <span class="built_in">this</span>.save(tag);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(<span class="number">200</span>, <span class="string">&quot;创建成功&quot;</span>, tag.getId());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;创建标签失败: &quot;</span>, e);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(<span class="number">500</span>, <span class="string">&quot;创建标签失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新标签</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> tagId 标签ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name  标签名称</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 更新结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult&lt;Void&gt; <span class="title function_">updateTag</span><span class="params">(Long tagId, String name)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 检查标签是否存在</span></span><br><span class="line">        <span class="type">BlogTag</span> <span class="variable">tag</span> <span class="operator">=</span> getById(tagId);</span><br><span class="line">        <span class="keyword">if</span> (tag == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(<span class="number">404</span>, <span class="string">&quot;标签不存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. 检查标签名称是否为空</span></span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.hasText(name)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(<span class="number">400</span>, <span class="string">&quot;标签名称不能为空&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. 如果修改了名称，检查名称是否已存在</span></span><br><span class="line">        <span class="keyword">if</span> (!name.equals(tag.getName())) &#123;</span><br><span class="line">            LambdaQueryWrapper&lt;BlogTag&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">            queryWrapper.eq(BlogTag::getName, name);</span><br><span class="line">            <span class="keyword">if</span> (baseMapper.selectCount(queryWrapper) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(<span class="number">400</span>, <span class="string">&quot;标签名称已存在&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 4. 更新标签</span></span><br><span class="line">        tag.setName(name);</span><br><span class="line">        updateById(tag);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(<span class="number">200</span>, <span class="string">&quot;更新成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除标签</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> tagId 标签ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 删除结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult&lt;Void&gt; <span class="title function_">deleteTag</span><span class="params">(Long tagId)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 检查标签是否存在</span></span><br><span class="line">        <span class="type">BlogTag</span> <span class="variable">tag</span> <span class="operator">=</span> getById(tagId);</span><br><span class="line">        <span class="keyword">if</span> (tag == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(<span class="number">404</span>, <span class="string">&quot;标签不存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. 检查是否有文章使用该标签</span></span><br><span class="line">        LambdaQueryWrapper&lt;BlogPostTag&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(BlogPostTag::getTagId, tagId);</span><br><span class="line"><span class="comment">//        int count = blogPostTagMapper.selectCount(queryWrapper);</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">countLong</span> <span class="operator">=</span> blogPostTagMapper.selectCount(queryWrapper);</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> (countLong == <span class="literal">null</span>) ? <span class="number">0</span> : countLong.intValue();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(<span class="number">400</span>, <span class="string">&quot;该标签下有&quot;</span> + count + <span class="string">&quot;篇文章，无法删除&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. 删除标签</span></span><br><span class="line">        removeById(tagId);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(<span class="number">200</span>, <span class="string">&quot;删除成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取文章的标签列表</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> postId 文章ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 标签列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult&lt;List&lt;BlogTagVo&gt;&gt; <span class="title function_">getPostTags</span><span class="params">(Long postId)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 查询文章的所有标签</span></span><br><span class="line">        List&lt;BlogTag&gt; tags = baseMapper.selectTagsByPostId(postId);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. 转换为VO对象</span></span><br><span class="line">        List&lt;BlogTagVo&gt; tagVos = tags.stream().map(tag -&gt; &#123;</span><br><span class="line">            <span class="type">BlogTagVo</span> <span class="variable">tagVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BlogTagVo</span>();</span><br><span class="line">            tagVo.setId(tag.getId());</span><br><span class="line">            tagVo.setName(tag.getName());</span><br><span class="line">            <span class="keyword">return</span> tagVo;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>&lt;&gt;(<span class="number">200</span>, <span class="string">&quot;获取成功&quot;</span>, tagVos);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>博客文章CRUD</p>
<p>分类管理</p>
<p>标签管理</p>
<p>Markdown导入导出</p>
<p>文章统计</p>
<p>评论管理模块</p>
<p>用户权限管理</p>
<p>搜索功能</p>
<h1 id="前端">前端</h1>
<p><a target="_blank" rel="noopener" href="https://code-farmer-i.github.io/vue-markdown-editor/zh/quick-start.html#安装支持-vue3-的版本">安装
| v-md-editor</a></p>
<p><code>Vue3 + Element Plus + Vue Router + Vuex</code></p>
<h3 id="步骤1更新左侧菜单">步骤1：更新左侧菜单</h3>
<p>首先，我们需要更新LeftMenu.vue，添加博客管理相关菜单项。</p>
<h3 id="步骤2添加api封装">步骤2：添加API封装</h3>
<p>在apis.js中添加博客相关API封装。</p>
<h3 id="步骤3创建博客管理视图组件">步骤3：创建博客管理视图组件</h3>
<p>创建以下视图组件：</p>
<p>BlogLayout.vue - 博客管理布局</p>
<p>BlogPosts.vue - 文章列表</p>
<p>BlogPostEdit.vue - 文章编辑（创建/修改）</p>
<p>BlogCategories.vue - 分类管理</p>
<p>BlogTags.vue - 标签管理</p>
<p>BlogRecycle.vue - 回收站</p>
<h3 id="步骤4更新路由配置">步骤4：更新路由配置</h3>
<p>在router/index.js中添加博客管理相关路由。</p>
<h3 id="步骤5实现各功能模块">步骤5：实现各功能模块</h3>
<p>逐步实现各功能模块的具体功能</p>
<h2 id="v-md-editor">v-md-editor</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i @kangc/v-md-editor@next -S</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;./router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;./store&#x27;</span></span><br><span class="line"><span class="comment">// 引入element-plus组件库</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ElementPlus</span> <span class="keyword">from</span> <span class="string">&#x27;element-plus&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;element-plus/dist/index.css&#x27;</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="title class_">ElementPlusIconsVue</span> <span class="keyword">from</span> <span class="string">&#x27;@element-plus/icons-vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VueMarkdownEditor</span> <span class="keyword">from</span> <span class="string">&#x27;@kangc/v-md-editor&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;@kangc/v-md-editor/lib/style/base-editor.css&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> vuepressTheme <span class="keyword">from</span> <span class="string">&#x27;@kangc/v-md-editor/lib/theme/vuepress.js&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;@kangc/v-md-editor/lib/theme/style/vuepress.css&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Prism</span> <span class="keyword">from</span> <span class="string">&#x27;prismjs&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">VueMarkdownEditor</span>.<span class="title function_">use</span>(vuepressTheme, &#123;</span><br><span class="line">  <span class="title class_">Prism</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 定义特性标志解决控制台警告：在生产环境中，为了获得更好的树摇优化，Vue 需要特定的特性标志，以减小生成的生产包的大小。</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="property">__VUE_PROD_DEVTOOLS__</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable language_">window</span>.<span class="property">__VUE_PROD_HYDRATION_MISMATCH_DETAILS__</span> = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册所有 Element Plus 图标</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> [key, component] <span class="keyword">of</span> <span class="title class_">Object</span>.<span class="title function_">entries</span>(<span class="title class_">ElementPlusIconsVue</span>)) &#123;</span><br><span class="line">  app.<span class="title function_">component</span>(key, component)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(store) <span class="comment">// vuex状态管理</span></span><br><span class="line">app.<span class="title function_">use</span>(router)</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title class_">ElementPlus</span>)</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title class_">VueMarkdownEditor</span>)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>) <span class="comment">// 绑定到id为app的元素上</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="博客管理菜单项">博客管理菜单项</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;el-menu</span><br><span class="line">        :default-active=&quot;activeIndex&quot;</span><br><span class="line">        class=&quot;el-menu-vertical&quot;</span><br><span class="line">        :collapse=&quot;isCollapse&quot;</span><br><span class="line">        background-color=&quot;#545c64&quot;</span><br><span class="line">        text-color=&quot;#fff&quot;</span><br><span class="line">        active-text-color=&quot;#ffd04b&quot;</span><br><span class="line">        router</span><br><span class="line">        &gt;</span><br><span class="line">            &lt;el-menu-item index=&quot;/&quot;&gt;</span><br><span class="line">                &lt;el-icon&gt;&lt;Odometer /&gt;&lt;/el-icon&gt;</span><br><span class="line">                &lt;span&gt;数据分析&lt;/span&gt;</span><br><span class="line">            &lt;/el-menu-item&gt;</span><br><span class="line"></span><br><span class="line">            &lt;el-menu-item index=&quot;/dataList&quot;&gt;</span><br><span class="line">                &lt;el-icon&gt;&lt;Document /&gt;&lt;/el-icon&gt;</span><br><span class="line">                &lt;span&gt;数据列表&lt;/span&gt;</span><br><span class="line">            &lt;/el-menu-item&gt;</span><br><span class="line">            </span><br><span class="line">            &lt;el-menu-item index=&quot;/statistics&quot;&gt;</span><br><span class="line">                &lt;el-icon&gt;&lt;PieChart /&gt;&lt;/el-icon&gt;</span><br><span class="line">                &lt;span&gt;数据统计&lt;/span&gt;</span><br><span class="line">            &lt;/el-menu-item&gt;</span><br><span class="line"></span><br><span class="line">            &lt;!-- 博客管理菜单 --&gt;</span><br><span class="line">            &lt;el-sub-menu index=&quot;/blog&quot;&gt;</span><br><span class="line">                &lt;template #title&gt;</span><br><span class="line">                    &lt;el-icon&gt;&lt;Edit /&gt;&lt;/el-icon&gt;</span><br><span class="line">                    &lt;span&gt;博客管理&lt;/span&gt;</span><br><span class="line">                &lt;/template&gt;</span><br><span class="line">                &lt;el-menu-item index=&quot;/blog/posts&quot;&gt;</span><br><span class="line">                    &lt;el-icon&gt;&lt;Document /&gt;&lt;/el-icon&gt;</span><br><span class="line">                    &lt;span&gt;文章管理&lt;/span&gt;</span><br><span class="line">                &lt;/el-menu-item&gt;</span><br><span class="line">                &lt;el-menu-item index=&quot;/blog/categories&quot;&gt;</span><br><span class="line">                    &lt;el-icon&gt;&lt;Folder /&gt;&lt;/el-icon&gt;</span><br><span class="line">                    &lt;span&gt;分类管理&lt;/span&gt;</span><br><span class="line">                &lt;/el-menu-item&gt;</span><br><span class="line">                &lt;el-menu-item index=&quot;/blog/tags&quot;&gt;</span><br><span class="line">                    &lt;el-icon&gt;&lt;Collection /&gt;&lt;/el-icon&gt;</span><br><span class="line">                    &lt;span&gt;标签管理&lt;/span&gt;</span><br><span class="line">                &lt;/el-menu-item&gt;</span><br><span class="line">                &lt;el-menu-item index=&quot;/blog/recycle&quot;&gt;</span><br><span class="line">                    &lt;el-icon&gt;&lt;Delete /&gt;&lt;/el-icon&gt;</span><br><span class="line">                    &lt;span&gt;回收站&lt;/span&gt;</span><br><span class="line">                &lt;/el-menu-item&gt;</span><br><span class="line">            &lt;/el-sub-menu&gt;</span><br><span class="line">        &lt;/el-menu&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref, onMounted, watch &#125; from &#x27;vue&#x27;</span><br><span class="line">import &#123; useRoute &#125; from &#x27;vue-router&#x27;</span><br><span class="line">import &#123; </span><br><span class="line">    Document, </span><br><span class="line">    Odometer, </span><br><span class="line">    PieChart, </span><br><span class="line">    Edit, </span><br><span class="line">    Folder, </span><br><span class="line">    Collection, </span><br><span class="line">    Delete </span><br><span class="line">&#125; from &#x27;@element-plus/icons-vue&#x27;</span><br><span class="line"></span><br><span class="line">// 控制菜单是否折叠</span><br><span class="line">const isCollapse = ref(false)</span><br><span class="line">// 当前激活的菜单项</span><br><span class="line">const activeIndex = ref(&#x27;/&#x27;)</span><br><span class="line">// 获取当前路由</span><br><span class="line">const route = useRoute()</span><br><span class="line"></span><br><span class="line">// 监听路由变化，更新激活的菜单项</span><br><span class="line">watch(() =&gt; route.path, (newPath) =&gt; &#123;</span><br><span class="line">    activeIndex.value = newPath</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// 组件挂载时，根据当前路由设置激活的菜单项</span><br><span class="line">onMounted(() =&gt; &#123;</span><br><span class="line">    activeIndex.value = route.path</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;less&quot; scoped&gt;</span><br><span class="line">.el-menu-vertical &#123;</span><br><span class="line">    height: 100%;</span><br><span class="line">    border-right: none;</span><br><span class="line">&#125;</span><br><span class="line">.el-menu-vertical:not(.el-menu--collapse) &#123;</span><br><span class="line">    width: 200px;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<h2 id="博客管理路由">博客管理路由</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">import &#123; createRouter, createWebHashHistory &#125; from &#x27;vue-router&#x27;</span><br><span class="line">import DataList from &#x27;@/views/DataList.vue&#x27;</span><br><span class="line">import Statistics from &#x27;@/views/Statistics.vue&#x27;</span><br><span class="line">import Analysis from &#x27;@/views/Analysis.vue&#x27;</span><br><span class="line"></span><br><span class="line">const routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    path: &#x27;/&#x27;,</span><br><span class="line">    name: &#x27;Analysis&#x27;,</span><br><span class="line">    component: Analysis,</span><br><span class="line">    meta:&#123;</span><br><span class="line">      title: &#x27;数据分析&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: &#x27;/dataList&#x27;,</span><br><span class="line">    name: &#x27;DataList&#x27;,</span><br><span class="line">    component: DataList,</span><br><span class="line">    meta: &#123;</span><br><span class="line">      title: &#x27;数据列表&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: &#x27;/statistics&#x27;,</span><br><span class="line">    name: &#x27;Statistics&#x27;,</span><br><span class="line">    component: Statistics,</span><br><span class="line">    meta:&#123;</span><br><span class="line">      title: &#x27;数据统计&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  // 博客管理路由</span><br><span class="line">  &#123;</span><br><span class="line">    path: &#x27;/blog&#x27;,</span><br><span class="line">    name: &#x27;Blog&#x27;,</span><br><span class="line">    redirect: &#x27;/blog/posts&#x27;,</span><br><span class="line">    meta: &#123;</span><br><span class="line">      title: &#x27;博客管理&#x27;</span><br><span class="line">    &#125;,</span><br><span class="line">    children: [</span><br><span class="line">      &#123;</span><br><span class="line">        path: &#x27;posts&#x27;,</span><br><span class="line">        name: &#x27;BlogPosts&#x27;,</span><br><span class="line">        component: () =&gt; import(&#x27;@/views/blog/BlogPosts.vue&#x27;),</span><br><span class="line">        meta: &#123;</span><br><span class="line">          title: &#x27;文章管理&#x27;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        path: &#x27;post/create&#x27;,</span><br><span class="line">        name: &#x27;BlogPostCreate&#x27;,</span><br><span class="line">        component: () =&gt; import(&#x27;@/views/blog/BlogPostEdit.vue&#x27;),</span><br><span class="line">        meta: &#123;</span><br><span class="line">          title: &#x27;创建文章&#x27;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        path: &#x27;post/edit/:id&#x27;,</span><br><span class="line">        name: &#x27;BlogPostEdit&#x27;,</span><br><span class="line">        component: () =&gt; import(&#x27;@/views/blog/BlogPostEdit.vue&#x27;),</span><br><span class="line">        meta: &#123;</span><br><span class="line">          title: &#x27;编辑文章&#x27;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        path: &#x27;categories&#x27;,</span><br><span class="line">        name: &#x27;BlogCategories&#x27;,</span><br><span class="line">        component: () =&gt; import(&#x27;@/views/blog/BlogCategories.vue&#x27;),</span><br><span class="line">        meta: &#123;</span><br><span class="line">          title: &#x27;分类管理&#x27;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        path: &#x27;tags&#x27;,</span><br><span class="line">        name: &#x27;BlogTags&#x27;,</span><br><span class="line">        component: () =&gt; import(&#x27;@/views/blog/BlogTags.vue&#x27;),</span><br><span class="line">        meta: &#123;</span><br><span class="line">          title: &#x27;标签管理&#x27;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        path: &#x27;recycle&#x27;,</span><br><span class="line">        name: &#x27;BlogRecycle&#x27;,</span><br><span class="line">        component: () =&gt; import(&#x27;@/views/blog/BlogRecycle.vue&#x27;),</span><br><span class="line">        meta: &#123;</span><br><span class="line">          title: &#x27;回收站&#x27;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">const router = createRouter(&#123;</span><br><span class="line">  history: createWebHashHistory(),</span><br><span class="line">  routes</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// 遍历路由以设置title</span><br><span class="line">router.beforeEach((to, from, next) =&gt; &#123;</span><br><span class="line">  document.title = to.meta.title</span><br><span class="line">  next()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">export default router</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="在-apis.js-中添加博客相关的api封装">在 apis.js
中添加博客相关的API封装</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br></pre></td><td class="code"><pre><span class="line">// 业务请求</span><br><span class="line">import&#123;request&#125; from &#x27;./axiosConfig&#x27;;</span><br><span class="line">// `vue.config.js`中配置了代理解决跨域。前端请求时url带该前缀时走代理请求到target指定的后端服务器上，并且请求路径中的该前缀被去掉，还原成后端接口原来的路径。</span><br><span class="line">const prefix =&#x27;/api&#x27;</span><br><span class="line">// 请求分页查询岗位数据的接口,参数page是想要获取第几页，即当前选中页码</span><br><span class="line">export function getJobListData(page)&#123;</span><br><span class="line">    return request(&#123;</span><br><span class="line">        url:prefix + &#x27;/job/v1/page/&#x27; + page,</span><br><span class="line">        method:&#x27;get&#x27;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 封装按类别统计的业务请求</span><br><span class="line">export function getJobByCategory()&#123;</span><br><span class="line">    return request(&#123;</span><br><span class="line">        url:prefix + &#x27;/job/v1/category/statistics&#x27;,</span><br><span class="line">        method:&#x27;get&#x27;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 封装按城市统计的业务请求</span><br><span class="line">export function getJobByCity()&#123;</span><br><span class="line">    return request(&#123;</span><br><span class="line">        url:prefix + &#x27;/job/v1/city/statistics&#x27;,</span><br><span class="line">        method:&#x27;get&#x27;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">// 封装按城市统计的业务请求</span><br><span class="line">export function getJobByProvince()&#123;</span><br><span class="line">    return request(&#123;</span><br><span class="line">        url:prefix + &#x27;/job/v1/province/statistics&#x27;,</span><br><span class="line">        method:&#x27;get&#x27;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// =================== 博客管理相关API ===================</span><br><span class="line"></span><br><span class="line">// 博客文章相关API</span><br><span class="line">// 获取文章列表</span><br><span class="line">export function getBlogPosts(queryParams) &#123;</span><br><span class="line">    return request(&#123;</span><br><span class="line">        url: prefix + &#x27;/blog/posts&#x27;,</span><br><span class="line">        method: &#x27;get&#x27;,</span><br><span class="line">        params: queryParams</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 获取文章详情</span><br><span class="line">export function getBlogPostDetail(postId, increaseViewCount = true) &#123;</span><br><span class="line">    return request(&#123;</span><br><span class="line">        url: prefix + `/blog/posts/$&#123;postId&#125;`,</span><br><span class="line">        method: &#x27;get&#x27;,</span><br><span class="line">        params: &#123; increaseViewCount &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 创建文章</span><br><span class="line">export function createBlogPost(userId, postData) &#123;</span><br><span class="line">    return request(&#123;</span><br><span class="line">        url: prefix + &#x27;/blog/posts&#x27;,</span><br><span class="line">        method: &#x27;post&#x27;,</span><br><span class="line">        params: &#123; userId &#125;,// 查询参数 如/api/blog/posts?userId=1。</span><br><span class="line">        data: postData</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 更新文章</span><br><span class="line">export function updateBlogPost(userId, postId, postData) &#123;</span><br><span class="line">    return request(&#123;</span><br><span class="line">        url: prefix + `/blog/posts/$&#123;postId&#125;`,</span><br><span class="line">        method: &#x27;put&#x27;,</span><br><span class="line">        params: &#123; userId &#125;,</span><br><span class="line">        data: postData</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 删除文章</span><br><span class="line">export function deleteBlogPost(userId, postId) &#123;</span><br><span class="line">    return request(&#123;</span><br><span class="line">        url: prefix + `/blog/posts/$&#123;postId&#125;`,</span><br><span class="line">        method: &#x27;delete&#x27;,</span><br><span class="line">        params: &#123; userId &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 将文章移至回收站</span><br><span class="line">export function moveBlogPostToRecycleBin(userId, postId) &#123;</span><br><span class="line">    return request(&#123;</span><br><span class="line">        url: prefix + `/blog/posts/$&#123;postId&#125;/recycle`,</span><br><span class="line">        method: &#x27;put&#x27;,</span><br><span class="line">        params: &#123; userId &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 从回收站恢复文章</span><br><span class="line">export function restoreBlogPostFromRecycleBin(userId, postId) &#123;</span><br><span class="line">    return request(&#123;</span><br><span class="line">        url: prefix + `/blog/posts/$&#123;postId&#125;/restore`,</span><br><span class="line">        method: &#x27;put&#x27;,</span><br><span class="line">        params: &#123; userId &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 获取用户的文章列表</span><br><span class="line">export function getUserBlogPosts(userId, status) &#123;</span><br><span class="line">    return request(&#123;</span><br><span class="line">        url: prefix + `/blog/posts/user/$&#123;userId&#125;`,</span><br><span class="line">        method: &#x27;get&#x27;,</span><br><span class="line">        params: &#123; status &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 博客分类相关API</span><br><span class="line">// 获取所有分类</span><br><span class="line">export function getBlogCategories() &#123;</span><br><span class="line">    return request(&#123;</span><br><span class="line">        url: prefix + &#x27;/blog/categories&#x27;,</span><br><span class="line">        method: &#x27;get&#x27;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 创建分类</span><br><span class="line">export function createBlogCategory(name, description, sort) &#123;</span><br><span class="line">    return request(&#123;</span><br><span class="line">        url: prefix + &#x27;/blog/categories&#x27;,</span><br><span class="line">        method: &#x27;post&#x27;,</span><br><span class="line">        params: &#123; </span><br><span class="line">            name: name,</span><br><span class="line">            description: description,</span><br><span class="line">            sort: sort</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 更新分类</span><br><span class="line">export function updateBlogCategory(categoryId, name, description, sort) &#123;</span><br><span class="line">    // 确保 categoryId 是数值类型</span><br><span class="line">    categoryId = Number(categoryId);</span><br><span class="line">    </span><br><span class="line">    // 只传递非空参数</span><br><span class="line">    const params = &#123;&#125;;</span><br><span class="line">    if (name !== undefined &amp;&amp; name !== null) params.name = name;</span><br><span class="line">    if (description !== undefined &amp;&amp; description !== null) params.description = description;</span><br><span class="line">    if (sort !== undefined &amp;&amp; sort !== null) params.sort = sort;</span><br><span class="line">    </span><br><span class="line">    return request(&#123;</span><br><span class="line">        url: prefix + `/blog/categories/$&#123;categoryId&#125;`,</span><br><span class="line">        method: &#x27;put&#x27;,</span><br><span class="line">        params: params</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 删除分类</span><br><span class="line">export function deleteBlogCategory(categoryId) &#123;</span><br><span class="line">    return request(&#123;</span><br><span class="line">        url: prefix + `/blog/categories/$&#123;categoryId&#125;`,</span><br><span class="line">        method: &#x27;delete&#x27;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 博客标签相关API</span><br><span class="line">// 获取所有标签</span><br><span class="line">export function getBlogTags() &#123;</span><br><span class="line">    return request(&#123;</span><br><span class="line">        url: prefix + &#x27;/blog/tags&#x27;,</span><br><span class="line">        method: &#x27;get&#x27;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 创建标签</span><br><span class="line">export function createBlogTag(name) &#123;</span><br><span class="line">    return request(&#123;</span><br><span class="line">        url: prefix + &#x27;/blog/tags&#x27;,</span><br><span class="line">        // url: prefix + &#x27;/api/blog/tags&#x27;, </span><br><span class="line">        method: &#x27;post&#x27;,</span><br><span class="line">        params: &#123; name &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 更新标签</span><br><span class="line">export function updateBlogTag(tagId, name) &#123;</span><br><span class="line">    return request(&#123;</span><br><span class="line">        url: prefix + `/blog/tags/$&#123;tagId&#125;`,</span><br><span class="line">        method: &#x27;put&#x27;,</span><br><span class="line">        params: &#123; name &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 删除标签</span><br><span class="line">export function deleteBlogTag(tagId) &#123;</span><br><span class="line">    return request(&#123;</span><br><span class="line">        url: prefix + `/blog/tags/$&#123;tagId&#125;`,</span><br><span class="line">        method: &#x27;delete&#x27;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 获取文章的标签</span><br><span class="line">export function getBlogPostTags(postId) &#123;</span><br><span class="line">    return request(&#123;</span><br><span class="line">        url: prefix + `/blog/tags/post/$&#123;postId&#125;`,</span><br><span class="line">        method: &#x27;get&#x27;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="在-axiosconfig.js-中添加请求和响应拦截器来记录详细信息">在
axiosConfig.js 中添加请求和响应拦截器来记录详细信息</h2>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Axios 的核心设计允许通过传递配置对象来动态定义请求行为。</span></span><br><span class="line"><span class="comment">当你调用 instance(config) 时，Axios 会将 config 合并到实例的默认配置中（如 baseURL 和 timeout），然后发起请求。</span></span><br><span class="line"><span class="comment">调用 request(config) 发起 HTTP 请求。</span></span><br><span class="line"><span class="comment">如果请求成功，进入 .then 回调，response 是 Axios 返回的响应对象。</span></span><br><span class="line"><span class="comment">如果请求失败（如网络错误或服务器返回错误状态码），进入 .catch 回调.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// 声明函数并将其导出，以便在其他模块中使用。config 参数是一个对象，包含请求的配置信息。</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">request</span>(<span class="params">config</span>)&#123;</span><br><span class="line">    <span class="comment">// 创建Axios的实例本质上是一个函数，可以直接接收一个配置对象（config）作为参数，并根据该配置发起 HTTP 请求。</span></span><br><span class="line">    <span class="keyword">const</span> instance = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line">        <span class="attr">baseURL</span>:<span class="string">&quot;&quot;</span>, <span class="comment">// 请求的基础 URL</span></span><br><span class="line">        <span class="attr">timeout</span>:<span class="number">8000</span>,<span class="comment">// 请求超时时间</span></span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加请求拦截器</span></span><br><span class="line">    instance.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(</span><br><span class="line">        <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;请求配置:&#x27;</span>, config);</span><br><span class="line">            <span class="keyword">return</span> config;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;请求错误:&#x27;</span>, error);</span><br><span class="line">            <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">        &#125;</span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加响应拦截器</span></span><br><span class="line">    instance.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(</span><br><span class="line">        <span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;响应数据:&#x27;</span>, response);</span><br><span class="line">            <span class="keyword">return</span> response;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;响应错误:&#x27;</span>, error);</span><br><span class="line">            <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">        &#125;</span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">instance</span>(config); <span class="comment">//使用刚刚创建的 Axios 实例发送请求。Axios 实例会根据这些配置发送请求，并返回一个 Promise，该 Promise 解析为响应数据。</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="创建博客文章列表组件blogposts.vue">创建博客文章列表组件（BlogPosts.vue）</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;blog-posts-container&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;page-header&quot;&gt;</span><br><span class="line">      &lt;h2&gt;文章管理&lt;/h2&gt;</span><br><span class="line">      &lt;el-button type=&quot;primary&quot; @click=&quot;goToCreatePost&quot;&gt;</span><br><span class="line">        &lt;el-icon&gt;&lt;Plus /&gt;&lt;/el-icon&gt;新建文章</span><br><span class="line">      &lt;/el-button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 搜索区域 --&gt;</span><br><span class="line">    &lt;div class=&quot;search-container&quot;&gt;</span><br><span class="line">      &lt;el-form :inline=&quot;true&quot; :model=&quot;searchForm&quot; class=&quot;search-form&quot;&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;标题&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;searchForm.title&quot; placeholder=&quot;请输入文章标题&quot; clearable /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;分类&quot;&gt;</span><br><span class="line">          &lt;el-select v-model=&quot;searchForm.categoryId&quot; placeholder=&quot;请选择分类&quot; clearable&gt;</span><br><span class="line">            &lt;el-option v-for=&quot;item in categories&quot; :key=&quot;item.id&quot; :label=&quot;item.name&quot; :value=&quot;item.id&quot; /&gt;</span><br><span class="line">          &lt;/el-select&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;状态&quot;&gt;</span><br><span class="line">          &lt;el-select v-model=&quot;searchForm.status&quot; placeholder=&quot;请选择状态&quot; clearable&gt;</span><br><span class="line">            &lt;el-option :label=&quot;&#x27;草稿&#x27;&quot; :value=&quot;0&quot; /&gt;</span><br><span class="line">            &lt;el-option :label=&quot;&#x27;已发布&#x27;&quot; :value=&quot;1&quot; /&gt;</span><br><span class="line">          &lt;/el-select&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item&gt;</span><br><span class="line">          &lt;el-button type=&quot;primary&quot; @click=&quot;handleSearch&quot;&gt;</span><br><span class="line">            &lt;el-icon&gt;&lt;Search /&gt;&lt;/el-icon&gt;搜索</span><br><span class="line">          &lt;/el-button&gt;</span><br><span class="line">          &lt;el-button @click=&quot;resetSearch&quot;&gt;</span><br><span class="line">            &lt;el-icon&gt;&lt;Refresh /&gt;&lt;/el-icon&gt;重置</span><br><span class="line">          &lt;/el-button&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">      &lt;/el-form&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 文章列表 --&gt;</span><br><span class="line">    &lt;el-table</span><br><span class="line">      v-loading=&quot;loading&quot;</span><br><span class="line">      :data=&quot;postList&quot;</span><br><span class="line">      border</span><br><span class="line">      style=&quot;width: 100%&quot;</span><br><span class="line">      @selection-change=&quot;handleSelectionChange&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;el-table-column type=&quot;selection&quot; width=&quot;55&quot; /&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;title&quot; label=&quot;标题&quot; min-width=&quot;200&quot;&gt;</span><br><span class="line">        &lt;template #default=&quot;scope&quot;&gt;</span><br><span class="line">          &lt;el-tooltip :content=&quot;scope.row.title&quot; placement=&quot;top&quot; :show-after=&quot;1000&quot;&gt;</span><br><span class="line">            &lt;span class=&quot;post-title&quot;&gt;&#123;&#123; scope.row.title &#125;&#125;&lt;/span&gt;</span><br><span class="line">          &lt;/el-tooltip&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;categoryName&quot; label=&quot;分类&quot; width=&quot;120&quot; /&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;viewCount&quot; label=&quot;浏览量&quot; width=&quot;100&quot; sortable /&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;commentCount&quot; label=&quot;评论数&quot; width=&quot;100&quot; sortable /&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;likeCount&quot; label=&quot;点赞数&quot; width=&quot;100&quot; sortable /&gt;</span><br><span class="line">      &lt;el-table-column label=&quot;状态&quot; width=&quot;100&quot;&gt;</span><br><span class="line">        &lt;template #default=&quot;scope&quot;&gt;</span><br><span class="line">          &lt;el-tag :type=&quot;scope.row.status === 1 ? &#x27;success&#x27; : &#x27;info&#x27;&quot;&gt;</span><br><span class="line">            &#123;&#123; scope.row.status === 1 ? &#x27;已发布&#x27; : &#x27;草稿&#x27; &#125;&#125;</span><br><span class="line">          &lt;/el-tag&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;createTime&quot; label=&quot;创建时间&quot; width=&quot;180&quot; sortable /&gt;</span><br><span class="line">      &lt;el-table-column label=&quot;操作&quot; width=&quot;220&quot; fixed=&quot;right&quot;&gt;</span><br><span class="line">        &lt;template #default=&quot;scope&quot;&gt;</span><br><span class="line">          &lt;el-button size=&quot;small&quot; @click=&quot;viewPost(scope.row)&quot;&gt;查看&lt;/el-button&gt;</span><br><span class="line">          &lt;el-button size=&quot;small&quot; type=&quot;primary&quot; @click=&quot;editPost(scope.row)&quot;&gt;编辑&lt;/el-button&gt;</span><br><span class="line">          &lt;el-button </span><br><span class="line">            size=&quot;small&quot; </span><br><span class="line">            type=&quot;danger&quot; </span><br><span class="line">            @click=&quot;moveToRecycleBin(scope.row)&quot;</span><br><span class="line">            v-if=&quot;scope.row.status !== 2&quot;</span><br><span class="line">          &gt;删除&lt;/el-button&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">    &lt;/el-table&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 分页 --&gt;</span><br><span class="line">    &lt;div class=&quot;pagination-container&quot;&gt;</span><br><span class="line">      &lt;el-pagination</span><br><span class="line">        v-model:current-page=&quot;currentPage&quot;</span><br><span class="line">        v-model:page-size=&quot;pageSize&quot;</span><br><span class="line">        :page-sizes=&quot;[10, 20, 50, 100]&quot;</span><br><span class="line">        layout=&quot;total, sizes, prev, pager, next, jumper&quot;</span><br><span class="line">        :total=&quot;total&quot;</span><br><span class="line">        @size-change=&quot;handleSizeChange&quot;</span><br><span class="line">        @current-change=&quot;handleCurrentChange&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 批量操作 --&gt;</span><br><span class="line">    &lt;div class=&quot;batch-actions&quot; v-if=&quot;selectedPosts.length &gt; 0&quot;&gt;</span><br><span class="line">      &lt;el-button type=&quot;danger&quot; @click=&quot;batchMoveToRecycleBin&quot;&gt;</span><br><span class="line">        批量删除 (&#123;&#123; selectedPosts.length &#125;&#125;)</span><br><span class="line">      &lt;/el-button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref, reactive, onMounted &#125; from &#x27;vue&#x27;</span><br><span class="line">import &#123; useRouter &#125; from &#x27;vue-router&#x27;</span><br><span class="line">import &#123; ElMessage, ElMessageBox &#125; from &#x27;element-plus&#x27;</span><br><span class="line">import &#123; Plus, Search, Refresh &#125; from &#x27;@element-plus/icons-vue&#x27;</span><br><span class="line">import &#123; getBlogPosts, getBlogCategories, moveBlogPostToRecycleBin &#125; from &#x27;@/utils/apis&#x27;</span><br><span class="line"></span><br><span class="line">const router = useRouter()</span><br><span class="line">const loading = ref(false)</span><br><span class="line">const postList = ref([])</span><br><span class="line">const categories = ref([])</span><br><span class="line">const selectedPosts = ref([])</span><br><span class="line">const total = ref(0)</span><br><span class="line">const currentPage = ref(1)</span><br><span class="line">const pageSize = ref(10)</span><br><span class="line"></span><br><span class="line">// 搜索表单</span><br><span class="line">const searchForm = reactive(&#123;</span><br><span class="line">  title: &#x27;&#x27;,</span><br><span class="line">  categoryId: &#x27;&#x27;,</span><br><span class="line">  status: &#x27;&#x27;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// 获取文章列表</span><br><span class="line">const fetchPosts = async () =&gt; &#123;</span><br><span class="line">  loading.value = true</span><br><span class="line">  try &#123;</span><br><span class="line">    const params = &#123;</span><br><span class="line">      page: currentPage.value,</span><br><span class="line">      size: pageSize.value,</span><br><span class="line">      title: searchForm.title || undefined,</span><br><span class="line">      categoryId: searchForm.categoryId || undefined,</span><br><span class="line">      status: searchForm.status !== &#x27;&#x27; ? searchForm.status : undefined</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    const res = await getBlogPosts(params)</span><br><span class="line">    if (res.data &amp;&amp; res.data.code === 200) &#123;</span><br><span class="line">      postList.value = res.data.data.records</span><br><span class="line">      total.value = res.data.data.total</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      ElMessage.error(res.data.msg || &#x27;获取文章列表失败&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; catch (error) &#123;</span><br><span class="line">    console.error(&#x27;获取文章列表出错:&#x27;, error)</span><br><span class="line">    ElMessage.error(&#x27;获取文章列表失败&#x27;)</span><br><span class="line">  &#125; finally &#123;</span><br><span class="line">    loading.value = false</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 获取分类列表</span><br><span class="line">const fetchCategories = async () =&gt; &#123;</span><br><span class="line">  try &#123;</span><br><span class="line">    const res = await getBlogCategories()</span><br><span class="line">    if (res.data &amp;&amp; res.data.code === 200) &#123;</span><br><span class="line">      categories.value = res.data.data</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      ElMessage.error(res.data.msg || &#x27;获取分类列表失败&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; catch (error) &#123;</span><br><span class="line">    console.error(&#x27;获取分类列表出错:&#x27;, error)</span><br><span class="line">    ElMessage.error(&#x27;获取分类列表失败&#x27;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 搜索</span><br><span class="line">const handleSearch = () =&gt; &#123;</span><br><span class="line">  currentPage.value = 1</span><br><span class="line">  fetchPosts()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 重置搜索</span><br><span class="line">const resetSearch = () =&gt; &#123;</span><br><span class="line">  searchForm.title = &#x27;&#x27;</span><br><span class="line">  searchForm.categoryId = &#x27;&#x27;</span><br><span class="line">  searchForm.status = &#x27;&#x27;</span><br><span class="line">  currentPage.value = 1</span><br><span class="line">  fetchPosts()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 页码变化</span><br><span class="line">const handleCurrentChange = (val) =&gt; &#123;</span><br><span class="line">  currentPage.value = val</span><br><span class="line">  fetchPosts()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 每页条数变化</span><br><span class="line">const handleSizeChange = (val) =&gt; &#123;</span><br><span class="line">  pageSize.value = val</span><br><span class="line">  currentPage.value = 1</span><br><span class="line">  fetchPosts()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 选择变化</span><br><span class="line">const handleSelectionChange = (selection) =&gt; &#123;</span><br><span class="line">  selectedPosts.value = selection</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 查看文章</span><br><span class="line">const viewPost = (row) =&gt; &#123;</span><br><span class="line">  // 这里可以跳转到文章详情页或者打开预览弹窗</span><br><span class="line">  ElMessage.info(&#x27;查看文章: &#x27; + row.title)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 编辑文章</span><br><span class="line">const editPost = (row) =&gt; &#123;</span><br><span class="line">  router.push(`/blog/post/edit/$&#123;row.id&#125;`)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 新建文章</span><br><span class="line">const goToCreatePost = () =&gt; &#123;</span><br><span class="line">  router.push(&#x27;/blog/post/create&#x27;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 移动到回收站</span><br><span class="line">const moveToRecycleBin = (row) =&gt; &#123;</span><br><span class="line">  ElMessageBox.confirm(</span><br><span class="line">    `确定要将文章 &quot;$&#123;row.title&#125;&quot; 移至回收站吗？`,</span><br><span class="line">    &#x27;提示&#x27;,</span><br><span class="line">    &#123;</span><br><span class="line">      confirmButtonText: &#x27;确定&#x27;,</span><br><span class="line">      cancelButtonText: &#x27;取消&#x27;,</span><br><span class="line">      type: &#x27;warning&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">  ).then(async () =&gt; &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">      // 这里使用一个固定的用户ID，实际应用中应该从登录用户信息中获取</span><br><span class="line">      const userId = 1</span><br><span class="line">      const res = await moveBlogPostToRecycleBin(userId, row.id)</span><br><span class="line">      if (res.data &amp;&amp; res.data.code === 200) &#123;</span><br><span class="line">        ElMessage.success(&#x27;已将文章移至回收站&#x27;)</span><br><span class="line">        fetchPosts()</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        ElMessage.error(res.data.msg || &#x27;操作失败&#x27;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; catch (error) &#123;</span><br><span class="line">      console.error(&#x27;移动到回收站出错:&#x27;, error)</span><br><span class="line">      ElMessage.error(&#x27;操作失败&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;).catch(() =&gt; &#123;</span><br><span class="line">    // 取消操作</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 批量移动到回收站</span><br><span class="line">const batchMoveToRecycleBin = () =&gt; &#123;</span><br><span class="line">  if (selectedPosts.value.length === 0) &#123;</span><br><span class="line">    ElMessage.warning(&#x27;请选择要删除的文章&#x27;)</span><br><span class="line">    return</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ElMessageBox.confirm(</span><br><span class="line">    `确定要将选中的 $&#123;selectedPosts.value.length&#125; 篇文章移至回收站吗？`,</span><br><span class="line">    &#x27;提示&#x27;,</span><br><span class="line">    &#123;</span><br><span class="line">      confirmButtonText: &#x27;确定&#x27;,</span><br><span class="line">      cancelButtonText: &#x27;取消&#x27;,</span><br><span class="line">      type: &#x27;warning&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">  ).then(async () =&gt; &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">      const userId = 1 // 固定用户ID，实际应用中应该从登录用户信息中获取</span><br><span class="line">      const promises = selectedPosts.value.map(post =&gt; </span><br><span class="line">        moveBlogPostToRecycleBin(userId, post.id)</span><br><span class="line">      )</span><br><span class="line">      </span><br><span class="line">      await Promise.all(promises)</span><br><span class="line">      ElMessage.success(&#x27;已将选中文章移至回收站&#x27;)</span><br><span class="line">      fetchPosts()</span><br><span class="line">    &#125; catch (error) &#123;</span><br><span class="line">      console.error(&#x27;批量移动到回收站出错:&#x27;, error)</span><br><span class="line">      ElMessage.error(&#x27;操作失败&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;).catch(() =&gt; &#123;</span><br><span class="line">    // 取消操作</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 组件挂载时获取数据</span><br><span class="line">onMounted(() =&gt; &#123;</span><br><span class="line">  fetchCategories()</span><br><span class="line">  fetchPosts()</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.blog-posts-container &#123;</span><br><span class="line">  padding: 20px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.page-header &#123;</span><br><span class="line">  display: flex;</span><br><span class="line">  justify-content: space-between;</span><br><span class="line">  align-items: center;</span><br><span class="line">  margin-bottom: 20px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.search-container &#123;</span><br><span class="line">  margin-bottom: 20px;</span><br><span class="line">  background-color: #f5f7fa;</span><br><span class="line">  padding: 15px;</span><br><span class="line">  border-radius: 4px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.post-title &#123;</span><br><span class="line">  display: inline-block;</span><br><span class="line">  max-width: 300px;</span><br><span class="line">  overflow: hidden;</span><br><span class="line">  text-overflow: ellipsis;</span><br><span class="line">  white-space: nowrap;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.pagination-container &#123;</span><br><span class="line">  margin-top: 20px;</span><br><span class="line">  display: flex;</span><br><span class="line">  justify-content: flex-end;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.batch-actions &#123;</span><br><span class="line">  margin-top: 20px;</span><br><span class="line">  padding: 10px;</span><br><span class="line">  background-color: #f5f7fa;</span><br><span class="line">  border-radius: 4px;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt; </span><br></pre></td></tr></table></figure>
<h2 id="博客文章编辑组件blogpostedit.vue">博客文章编辑组件(BlogPostEdit.vue)</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;blog-post-edit-container&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;page-header&quot;&gt;</span><br><span class="line">      &lt;h2&gt;&#123;&#123; isEdit ? &#x27;编辑文章&#x27; : &#x27;创建文章&#x27; &#125;&#125;&lt;/h2&gt;</span><br><span class="line">      &lt;div class=&quot;header-actions&quot;&gt;</span><br><span class="line">        &lt;el-button @click=&quot;goBack&quot;&gt;返回&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; @click=&quot;saveAsDraft&quot;&gt;保存草稿&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type=&quot;success&quot; @click=&quot;publishPost&quot;&gt;发布文章&lt;/el-button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form :model=&quot;postForm&quot; :rules=&quot;rules&quot; ref=&quot;postFormRef&quot; label-width=&quot;100px&quot; class=&quot;post-form&quot;&gt;</span><br><span class="line">      &lt;el-form-item label=&quot;文章标题&quot; prop=&quot;title&quot;&gt;</span><br><span class="line">        &lt;el-input v-model=&quot;postForm.title&quot; placeholder=&quot;请输入文章标题&quot; maxlength=&quot;200&quot; show-word-limit /&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">      &lt;el-form-item label=&quot;文章分类&quot; prop=&quot;categoryId&quot;&gt;</span><br><span class="line">        &lt;el-select v-model=&quot;postForm.categoryId&quot; placeholder=&quot;请选择分类&quot;&gt;</span><br><span class="line">          &lt;el-option v-for=&quot;item in categories&quot; :key=&quot;item.id&quot; :label=&quot;item.name&quot; :value=&quot;item.id&quot; /&gt;</span><br><span class="line">        &lt;/el-select&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">      &lt;el-form-item label=&quot;文章标签&quot;&gt;</span><br><span class="line">        &lt;el-select</span><br><span class="line">          v-model=&quot;postForm.tagIds&quot;</span><br><span class="line">          multiple</span><br><span class="line">          filterable</span><br><span class="line">          :allow-create=&quot;false&quot;</span><br><span class="line">          placeholder=&quot;请选择标签&quot;</span><br><span class="line">          @change=&quot;handleTagSelect&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;el-option</span><br><span class="line">            v-for=&quot;item in tagOptions&quot;</span><br><span class="line">            :key=&quot;item.value&quot;</span><br><span class="line">            :label=&quot;item.label&quot;</span><br><span class="line">            :value=&quot;item.value&quot;</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;/el-select&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">      &lt;el-form-item label=&quot;文章摘要&quot;&gt;</span><br><span class="line">        &lt;el-input</span><br><span class="line">          v-model=&quot;postForm.summary&quot;</span><br><span class="line">          type=&quot;textarea&quot;</span><br><span class="line">          :rows=&quot;3&quot;</span><br><span class="line">          placeholder=&quot;请输入文章摘要（选填）&quot;</span><br><span class="line">          maxlength=&quot;500&quot;</span><br><span class="line">          show-word-limit</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">      &lt;el-form-item label=&quot;封面图片&quot;&gt;</span><br><span class="line">        &lt;el-upload</span><br><span class="line">          class=&quot;cover-uploader&quot;</span><br><span class="line">          action=&quot;#&quot;</span><br><span class="line">          :http-request=&quot;uploadCover&quot;</span><br><span class="line">          :show-file-list=&quot;false&quot;</span><br><span class="line">          :before-upload=&quot;beforeCoverUpload&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;img v-if=&quot;postForm.coverImage&quot; :src=&quot;postForm.coverImage&quot; class=&quot;cover-image&quot; /&gt;</span><br><span class="line">          &lt;el-icon v-else class=&quot;cover-uploader-icon&quot;&gt;&lt;Plus /&gt;&lt;/el-icon&gt;</span><br><span class="line">        &lt;/el-upload&gt;</span><br><span class="line">        &lt;div class=&quot;upload-tip&quot;&gt;建议尺寸: 1200 x 675 像素&lt;/div&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">      &lt;el-form-item label=&quot;文章内容&quot; prop=&quot;content&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;editor-container&quot;&gt;</span><br><span class="line">          &lt;v-md-editor v-model=&quot;postForm.content&quot; height=&quot;500px&quot; @change=&quot;handleEditorChange&quot;&gt;&lt;/v-md-editor&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">      &lt;el-form-item label=&quot;文章设置&quot;&gt;</span><br><span class="line">        &lt;el-checkbox v-model=&quot;postForm.isTop&quot;&gt;置顶文章&lt;/el-checkbox&gt;</span><br><span class="line">        &lt;el-checkbox v-model=&quot;postForm.isOriginal&quot;&gt;原创文章&lt;/el-checkbox&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">      &lt;el-form-item v-if=&quot;!postForm.isOriginal&quot; label=&quot;原文链接&quot;&gt;</span><br><span class="line">        &lt;el-input v-model=&quot;postForm.sourceUrl&quot; placeholder=&quot;请输入原文链接&quot; /&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">    &lt;/el-form&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref, reactive, computed, onMounted &#125; from &#x27;vue&#x27;</span><br><span class="line">import &#123; useRoute, useRouter &#125; from &#x27;vue-router&#x27;</span><br><span class="line">import &#123; ElMessage, ElMessageBox &#125; from &#x27;element-plus&#x27;</span><br><span class="line">import &#123; Plus &#125; from &#x27;@element-plus/icons-vue&#x27;</span><br><span class="line">import &#123; </span><br><span class="line">  getBlogPostDetail, </span><br><span class="line">  createBlogPost, </span><br><span class="line">  updateBlogPost, </span><br><span class="line">  getBlogCategories, </span><br><span class="line">  getBlogTags,</span><br><span class="line">  getBlogPostTags</span><br><span class="line">&#125; from &#x27;@/utils/apis&#x27;</span><br><span class="line"></span><br><span class="line">const route = useRoute()//当前路由对象</span><br><span class="line">const router = useRouter()</span><br><span class="line">const postFormRef = ref(null)</span><br><span class="line">const categories = ref([])</span><br><span class="line">const tags = ref([])</span><br><span class="line"></span><br><span class="line">// 判断是编辑还是创建</span><br><span class="line">const isEdit = computed(() =&gt; route.params.id !== undefined) //通过 useRoute().params 获取在路由定义中使用占位符（如 :id）来表示可以变化的部分。</span><br><span class="line">const postId = computed(() =&gt; route.params.id)</span><br><span class="line"></span><br><span class="line">// 表单数据</span><br><span class="line">const postForm = reactive(&#123;</span><br><span class="line">  title: &#x27;&#x27;,</span><br><span class="line">  content: &#x27;&#x27;,</span><br><span class="line">  summary: &#x27;&#x27;,</span><br><span class="line">  coverImage: &#x27;&#x27;,</span><br><span class="line">  categoryId: &#x27;&#x27;,</span><br><span class="line">  tagIds: [],</span><br><span class="line">  isTop: false,</span><br><span class="line">  isOriginal: true,</span><br><span class="line">  sourceUrl: &#x27;&#x27;,</span><br><span class="line">  status: 0 // 0: 草稿, 1: 已发布</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// 表单验证规则</span><br><span class="line">const rules = &#123;</span><br><span class="line">  title: [</span><br><span class="line">    &#123; required: true, message: &#x27;请输入文章标题&#x27;, trigger: &#x27;blur&#x27; &#125;,</span><br><span class="line">    &#123; min: 2, max: 200, message: &#x27;标题长度在 2 到 200 个字符&#x27;, trigger: &#x27;blur&#x27; &#125;</span><br><span class="line">  ],</span><br><span class="line">  categoryId: [</span><br><span class="line">    &#123; required: true, message: &#x27;请选择文章分类&#x27;, trigger: &#x27;change&#x27; &#125;</span><br><span class="line">  ],</span><br><span class="line">  content: [</span><br><span class="line">    &#123; required: true, message: &#x27;请输入文章内容&#x27;, trigger: &#x27;blur&#x27; &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 获取文章详情</span><br><span class="line">const fetchPostDetail = async () =&gt; &#123;</span><br><span class="line">  if (!isEdit.value) return</span><br><span class="line">  </span><br><span class="line">  try &#123;</span><br><span class="line">    const res = await getBlogPostDetail(postId.value, false)</span><br><span class="line">    if (res.data &amp;&amp; res.data.code === 200) &#123;</span><br><span class="line">      const postDetail = res.data.data</span><br><span class="line">      </span><br><span class="line">      // 填充表单数据</span><br><span class="line">      postForm.title = postDetail.title</span><br><span class="line">      postForm.content = postDetail.content</span><br><span class="line">      postForm.summary = postDetail.summary</span><br><span class="line">      postForm.coverImage = postDetail.coverImage</span><br><span class="line">      postForm.categoryId = postDetail.categoryId</span><br><span class="line">      postForm.isTop = postDetail.isTop</span><br><span class="line">      postForm.isOriginal = postDetail.isOriginal</span><br><span class="line">      postForm.sourceUrl = postDetail.sourceUrl</span><br><span class="line">      postForm.status = postDetail.status</span><br><span class="line">      </span><br><span class="line">      // 获取文章标签</span><br><span class="line">      fetchPostTags()</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      ElMessage.error(res.data.msg || &#x27;获取文章详情失败&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; catch (error) &#123;</span><br><span class="line">    console.error(&#x27;获取文章详情出错:&#x27;, error)</span><br><span class="line">    ElMessage.error(&#x27;获取文章详情失败&#x27;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 获取文章标签</span><br><span class="line">const fetchPostTags = async () =&gt; &#123;</span><br><span class="line">  try &#123;</span><br><span class="line">    const res = await getBlogPostTags(postId.value)</span><br><span class="line">    if (res.data &amp;&amp; res.data.code === 200) &#123;</span><br><span class="line">      postForm.tagIds = res.data.data.map(tag =&gt; tag.id)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; catch (error) &#123;</span><br><span class="line">    console.error(&#x27;获取文章标签出错:&#x27;, error)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 获取分类列表</span><br><span class="line">const fetchCategories = async () =&gt; &#123;</span><br><span class="line">  try &#123;</span><br><span class="line">    const res = await getBlogCategories()</span><br><span class="line">    if (res.data &amp;&amp; res.data.code === 200) &#123;</span><br><span class="line">      categories.value = res.data.data</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      ElMessage.error(res.data.msg || &#x27;获取分类列表失败&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; catch (error) &#123;</span><br><span class="line">    console.error(&#x27;获取分类列表出错:&#x27;, error)</span><br><span class="line">    ElMessage.error(&#x27;获取分类列表失败&#x27;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 获取标签列表</span><br><span class="line">const fetchTags = async () =&gt; &#123;</span><br><span class="line">  try &#123;</span><br><span class="line">    const res = await getBlogTags()</span><br><span class="line">    if (res.data &amp;&amp; res.data.code === 200) &#123;</span><br><span class="line">      tags.value = res.data.data</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      ElMessage.error(res.data.msg || &#x27;获取标签列表失败&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; catch (error) &#123;</span><br><span class="line">    console.error(&#x27;获取标签列表出错:&#x27;, error)</span><br><span class="line">    ElMessage.error(&#x27;获取标签列表失败&#x27;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 上传封面图片前的验证</span><br><span class="line">const beforeCoverUpload = (file) =&gt; &#123;</span><br><span class="line">  const isImage = file.type.startsWith(&#x27;image/&#x27;)</span><br><span class="line">  const isLt2M = file.size / 1024 / 1024 &lt; 2</span><br><span class="line"></span><br><span class="line">  if (!isImage) &#123;</span><br><span class="line">    ElMessage.error(&#x27;封面图片只能是图片格式!&#x27;)</span><br><span class="line">  &#125;</span><br><span class="line">  if (!isLt2M) &#123;</span><br><span class="line">    ElMessage.error(&#x27;封面图片大小不能超过 2MB!&#x27;)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  return isImage &amp;&amp; isLt2M</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 上传封面图片</span><br><span class="line">const uploadCover = (options) =&gt; &#123;</span><br><span class="line">  // 这里应该调用实际的上传API，这里仅做演示</span><br><span class="line">  // 实际项目中，应该将文件上传到服务器，然后获取返回的URL</span><br><span class="line">  const file = options.file</span><br><span class="line">  const reader = new FileReader()</span><br><span class="line">  reader.readAsDataURL(file)</span><br><span class="line">  reader.onload = () =&gt; &#123;</span><br><span class="line">    postForm.coverImage = reader.result</span><br><span class="line">    ElMessage.success(&#x27;封面上传成功&#x27;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 编辑器内容变化</span><br><span class="line">const handleEditorChange = (text) =&gt; &#123;</span><br><span class="line">  postForm.content = text</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 保存草稿</span><br><span class="line">const saveAsDraft = () =&gt; &#123;</span><br><span class="line">  postForm.status = 0</span><br><span class="line">  savePost()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 发布文章</span><br><span class="line">const publishPost = () =&gt; &#123;</span><br><span class="line">  postForm.status = 1</span><br><span class="line">  savePost()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 保存文章</span><br><span class="line">const savePost = () =&gt; &#123;</span><br><span class="line">  postFormRef.value.validate(async (valid) =&gt; &#123;</span><br><span class="line">    /*  valid 是 el-form 组件的 validate 方法回调函数中的参数，表示表单验证的结果。它是由框架自动生成并传递给回调函数的布尔值*/</span><br><span class="line">    if (!valid) &#123;</span><br><span class="line">      ElMessage.error(&#x27;请完善表单信息&#x27;)</span><br><span class="line">      return</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    try &#123;</span><br><span class="line">      // 构建请求数据</span><br><span class="line">      const postData = &#123;</span><br><span class="line">        title: postForm.title,</span><br><span class="line">        content: postForm.content,</span><br><span class="line">        summary: postForm.summary,</span><br><span class="line">        coverImage: postForm.coverImage,</span><br><span class="line">        categoryId: postForm.categoryId,</span><br><span class="line">        tagIds: postForm.tagIds,</span><br><span class="line">        isTop: postForm.isTop,</span><br><span class="line">        isOriginal: postForm.isOriginal,</span><br><span class="line">        sourceUrl: postForm.sourceUrl,</span><br><span class="line">        status: postForm.status</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      // 确保标签ID是数值类型</span><br><span class="line">      if (postData.tagIds &amp;&amp; postData.tagIds.length &gt; 0) &#123;</span><br><span class="line">        postData.tagIds = postData.tagIds.map(id =&gt; &#123;</span><br><span class="line">          // 尝试将ID转换为数值</span><br><span class="line">          const numId = Number(id);</span><br><span class="line">          // 检查转换结果是否是有效数字</span><br><span class="line">          if (isNaN(numId)) &#123;</span><br><span class="line">            throw new Error(`标签ID &quot;$&#123;id&#125;&quot; 不是有效的数字`);</span><br><span class="line">          &#125;</span><br><span class="line">          return numId;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      // 固定用户ID，实际应用中应该从登录用户信息中获取</span><br><span class="line">      const userId = 1</span><br><span class="line">      let res</span><br><span class="line"></span><br><span class="line">      if (isEdit.value) &#123;</span><br><span class="line">        // 更新文章</span><br><span class="line">        res = await updateBlogPost(userId, postId.value, postData)</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        // 创建文章</span><br><span class="line">        res = await createBlogPost(userId, postData)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      if (res.data &amp;&amp; res.data.code === 200) &#123;</span><br><span class="line">        ElMessage.success(postForm.status === 1 ? &#x27;文章发布成功&#x27; : &#x27;草稿保存成功&#x27;)</span><br><span class="line">        router.push(&#x27;/blog/posts&#x27;) // 路由到文章管理</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        ElMessage.error(res.data.msg || &#x27;操作失败&#x27;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; catch (error) &#123;</span><br><span class="line">      console.error(&#x27;保存文章出错:&#x27;, error)</span><br><span class="line">      ElMessage.error(&#x27;操作失败&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 返回列表</span><br><span class="line">const goBack = () =&gt; &#123;</span><br><span class="line">  ElMessageBox.confirm(</span><br><span class="line">    &#x27;确定要离开吗？未保存的内容将会丢失&#x27;,</span><br><span class="line">    &#x27;提示&#x27;,</span><br><span class="line">    &#123;</span><br><span class="line">      confirmButtonText: &#x27;确定&#x27;,</span><br><span class="line">      cancelButtonText: &#x27;取消&#x27;,</span><br><span class="line">      type: &#x27;warning&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">  ).then(() =&gt; &#123;</span><br><span class="line">    router.push(&#x27;/blog/posts&#x27;)</span><br><span class="line">  &#125;).catch(() =&gt; &#123;</span><br><span class="line">    // 取消操作</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 标签选择器配置</span><br><span class="line">const handleTagSelect = (value) =&gt; &#123;</span><br><span class="line">  // 确保所有选中的标签ID都是数值</span><br><span class="line">  postForm.tagIds = value.map(id =&gt; Number(id));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 加载标签列表</span><br><span class="line">const loadTags = async () =&gt; &#123;</span><br><span class="line">  try &#123;</span><br><span class="line">    const res = await getBlogTags();</span><br><span class="line">    if (res.data &amp;&amp; res.data.code === 200) &#123;</span><br><span class="line">      // 确保标签选项的值是数值类型</span><br><span class="line">      tagOptions.value = (res.data.data || []).map(tag =&gt; (&#123;</span><br><span class="line">        value: Number(tag.id),  // 确保ID是数值</span><br><span class="line">        label: tag.name</span><br><span class="line">      &#125;));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; catch (error) &#123;</span><br><span class="line">    console.error(&#x27;加载标签失败:&#x27;, error);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 组件挂载时获取数据</span><br><span class="line">onMounted(() =&gt; &#123;</span><br><span class="line">  fetchCategories()</span><br><span class="line">  fetchTags()</span><br><span class="line">  if (isEdit.value) &#123;</span><br><span class="line">    fetchPostDetail()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.blog-post-edit-container &#123;</span><br><span class="line">  padding: 20px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.page-header &#123;</span><br><span class="line">  display: flex;</span><br><span class="line">  justify-content: space-between;</span><br><span class="line">  align-items: center;</span><br><span class="line">  margin-bottom: 20px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.post-form &#123;</span><br><span class="line">  background-color: #fff;</span><br><span class="line">  padding: 20px;</span><br><span class="line">  border-radius: 4px;</span><br><span class="line">  box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.editor-container &#123;</span><br><span class="line">  border: 1px solid #dcdfe6;</span><br><span class="line">  border-radius: 4px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.cover-uploader &#123;</span><br><span class="line">  width: 300px;</span><br><span class="line">  height: 169px;</span><br><span class="line">  border: 1px dashed #d9d9d9;</span><br><span class="line">  border-radius: 6px;</span><br><span class="line">  cursor: pointer;</span><br><span class="line">  position: relative;</span><br><span class="line">  overflow: hidden;</span><br><span class="line">  display: flex;</span><br><span class="line">  justify-content: center;</span><br><span class="line">  align-items: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.cover-uploader:hover &#123;</span><br><span class="line">  border-color: #409eff;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.cover-uploader-icon &#123;</span><br><span class="line">  font-size: 28px;</span><br><span class="line">  color: #8c939d;</span><br><span class="line">  width: 300px;</span><br><span class="line">  height: 169px;</span><br><span class="line">  line-height: 169px;</span><br><span class="line">  text-align: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.cover-image &#123;</span><br><span class="line">  width: 100%;</span><br><span class="line">  height: 100%;</span><br><span class="line">  object-fit: cover;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.upload-tip &#123;</span><br><span class="line">  font-size: 12px;</span><br><span class="line">  color: #606266;</span><br><span class="line">  margin-top: 5px;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt; </span><br></pre></td></tr></table></figure>
<h4 id="section"></h4>
<h2 id="博客分类管理组件blogcategories.vue">博客分类管理组件(BlogCategories.vue)</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;blog-categories-container&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;page-header&quot;&gt;</span><br><span class="line">      &lt;h2&gt;分类管理&lt;/h2&gt;</span><br><span class="line">      &lt;el-button type=&quot;primary&quot; @click=&quot;showAddCategoryDialog&quot;&gt;</span><br><span class="line">        &lt;el-icon&gt;&lt;Plus /&gt;&lt;/el-icon&gt;新建分类</span><br><span class="line">      &lt;/el-button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 分类列表 --&gt;</span><br><span class="line">    &lt;el-table</span><br><span class="line">      v-loading=&quot;loading&quot;</span><br><span class="line">      :data=&quot;categories&quot;</span><br><span class="line">      border</span><br><span class="line">      style=&quot;width: 100%&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;id&quot; label=&quot;ID&quot; width=&quot;80&quot; /&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;name&quot; label=&quot;分类名称&quot; min-width=&quot;150&quot; /&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;description&quot; label=&quot;描述&quot; min-width=&quot;200&quot; /&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;postCount&quot; label=&quot;文章数量&quot; width=&quot;100&quot; sortable /&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;sort&quot; label=&quot;排序&quot; width=&quot;80&quot; sortable /&gt;</span><br><span class="line">      &lt;el-table-column label=&quot;操作&quot; width=&quot;180&quot; fixed=&quot;right&quot;&gt;</span><br><span class="line">        &lt;template #default=&quot;scope&quot;&gt;</span><br><span class="line">          &lt;el-button size=&quot;small&quot; type=&quot;primary&quot; @click=&quot;showEditCategoryDialog(scope.row)&quot;&gt;编辑&lt;/el-button&gt;</span><br><span class="line">          &lt;el-button </span><br><span class="line">            size=&quot;small&quot; </span><br><span class="line">            type=&quot;danger&quot; </span><br><span class="line">            @click=&quot;deleteCategory(scope.row)&quot;</span><br><span class="line">            :disabled=&quot;scope.row.postCount &gt; 0&quot;</span><br><span class="line">          &gt;删除&lt;/el-button&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">    &lt;/el-table&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 新增/编辑分类对话框 --&gt;</span><br><span class="line">    &lt;el-dialog</span><br><span class="line">      :title=&quot;dialogType === &#x27;add&#x27; ? &#x27;新建分类&#x27; : &#x27;编辑分类&#x27;&quot;</span><br><span class="line">      v-model=&quot;dialogVisible&quot;</span><br><span class="line">      width=&quot;500px&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;el-form :model=&quot;categoryForm&quot; :rules=&quot;rules&quot; ref=&quot;categoryFormRef&quot; label-width=&quot;80px&quot;&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;分类名称&quot; prop=&quot;name&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;categoryForm.name&quot; placeholder=&quot;请输入分类名称&quot; /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;描述&quot; prop=&quot;description&quot;&gt;</span><br><span class="line">          &lt;el-input </span><br><span class="line">            v-model=&quot;categoryForm.description&quot; </span><br><span class="line">            type=&quot;textarea&quot; </span><br><span class="line">            :rows=&quot;3&quot; </span><br><span class="line">            placeholder=&quot;请输入分类描述&quot; </span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;排序&quot; prop=&quot;sort&quot;&gt;</span><br><span class="line">          &lt;el-input-number v-model=&quot;categoryForm.sort&quot; :min=&quot;0&quot; :max=&quot;999&quot; /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">      &lt;/el-form&gt;</span><br><span class="line">      &lt;template #footer&gt;</span><br><span class="line">        &lt;span class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">          &lt;el-button @click=&quot;dialogVisible = false&quot;&gt;取消&lt;/el-button&gt;</span><br><span class="line">          &lt;el-button type=&quot;primary&quot; @click=&quot;submitCategoryForm&quot;&gt;确定&lt;/el-button&gt;</span><br><span class="line">        &lt;/span&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">    &lt;/el-dialog&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref, reactive, onMounted &#125; from &#x27;vue&#x27;</span><br><span class="line">import &#123; ElMessage, ElMessageBox &#125; from &#x27;element-plus&#x27;</span><br><span class="line">import &#123; </span><br><span class="line">  getBlogCategories, </span><br><span class="line">  createBlogCategory, </span><br><span class="line">  updateBlogCategory, </span><br><span class="line">  deleteBlogCategory </span><br><span class="line">&#125; from &#x27;@/utils/apis&#x27;</span><br><span class="line"></span><br><span class="line">// 分类列表数据</span><br><span class="line">const categories = ref([])</span><br><span class="line">// 加载状态</span><br><span class="line">const loading = ref(false)</span><br><span class="line">// 对话框可见性</span><br><span class="line">const dialogVisible = ref(false)</span><br><span class="line">// 对话框类型：add-新增，edit-编辑</span><br><span class="line">const dialogType = ref(&#x27;add&#x27;)</span><br><span class="line">// 分类表单引用</span><br><span class="line">const categoryFormRef = ref(null)</span><br><span class="line">// 当前编辑的分类ID</span><br><span class="line">const currentCategoryId = ref(null)</span><br><span class="line"></span><br><span class="line">// 分类表单数据</span><br><span class="line">const categoryForm = reactive(&#123;</span><br><span class="line">  name: &#x27;&#x27;,</span><br><span class="line">  description: &#x27;&#x27;,</span><br><span class="line">  sort: 0</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// 表单验证规则</span><br><span class="line">const rules = &#123;</span><br><span class="line">  name: [</span><br><span class="line">    &#123; required: true, message: &#x27;请输入分类名称&#x27;, trigger: &#x27;blur&#x27; &#125;,</span><br><span class="line">    &#123; max: 50, message: &#x27;分类名称不能超过50个字符&#x27;, trigger: &#x27;blur&#x27; &#125;</span><br><span class="line">  ],</span><br><span class="line">  description: [</span><br><span class="line">    &#123; max: 200, message: &#x27;描述不能超过200个字符&#x27;, trigger: &#x27;blur&#x27; &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 获取分类列表</span><br><span class="line">const fetchCategories = async () =&gt; &#123;</span><br><span class="line">  loading.value = true</span><br><span class="line">  try &#123;</span><br><span class="line">    const res = await getBlogCategories()</span><br><span class="line">    if (res.data &amp;&amp; res.data.code === 200) &#123;</span><br><span class="line">      categories.value = res.data.data || []</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      ElMessage.error(res.data?.msg || &#x27;获取分类列表失败&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; catch (error) &#123;</span><br><span class="line">    console.error(&#x27;获取分类列表出错:&#x27;, error)</span><br><span class="line">    ElMessage.error(&#x27;获取分类列表失败&#x27;)</span><br><span class="line">  &#125; finally &#123;</span><br><span class="line">    loading.value = false</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 显示新增分类对话框</span><br><span class="line">const showAddCategoryDialog = () =&gt; &#123;</span><br><span class="line">  dialogType.value = &#x27;add&#x27;</span><br><span class="line">  resetCategoryForm()</span><br><span class="line">  dialogVisible.value = true</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 显示编辑分类对话框</span><br><span class="line">const showEditCategoryDialog = (category) =&gt; &#123;</span><br><span class="line">  dialogType.value = &#x27;edit&#x27;</span><br><span class="line">  </span><br><span class="line">  // 确保 category.id 是有效的数值</span><br><span class="line">  currentCategoryId.value = Number(category.id)</span><br><span class="line">  </span><br><span class="line">  // 填充表单数据</span><br><span class="line">  categoryForm.name = category.name</span><br><span class="line">  categoryForm.description = category.description || &#x27;&#x27;</span><br><span class="line">  categoryForm.sort = category.sort || 0</span><br><span class="line">  </span><br><span class="line">  dialogVisible.value = true</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 重置分类表单</span><br><span class="line">const resetCategoryForm = () =&gt; &#123;</span><br><span class="line">  if (categoryFormRef.value) &#123;</span><br><span class="line">    categoryFormRef.value.resetFields()</span><br><span class="line">  &#125;</span><br><span class="line">  categoryForm.name = &#x27;&#x27;</span><br><span class="line">  categoryForm.description = &#x27;&#x27;</span><br><span class="line">  categoryForm.sort = 0</span><br><span class="line">  currentCategoryId.value = null</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 提交分类表单</span><br><span class="line">const submitCategoryForm = async () =&gt; &#123;</span><br><span class="line">  if (!categoryFormRef.value) return</span><br><span class="line">  </span><br><span class="line">  await categoryFormRef.value.validate(async (valid) =&gt; &#123;</span><br><span class="line">    if (!valid) return</span><br><span class="line">    </span><br><span class="line">    try &#123;</span><br><span class="line">      if (dialogType.value === &#x27;add&#x27;) &#123;</span><br><span class="line">        // 新增分类</span><br><span class="line">        const res = await createBlogCategory(</span><br><span class="line">          categoryForm.name,</span><br><span class="line">          categoryForm.description,</span><br><span class="line">          categoryForm.sort</span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        if (res.data &amp;&amp; res.data.code === 200) &#123;</span><br><span class="line">          ElMessage.success(&#x27;分类创建成功&#x27;)</span><br><span class="line">          dialogVisible.value = false</span><br><span class="line">          fetchCategories()</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          ElMessage.error(res.data?.msg || &#x27;创建分类失败&#x27;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        // 编辑分类 - 确保 currentCategoryId.value 是有效的数值</span><br><span class="line">        if (!currentCategoryId.value) &#123;</span><br><span class="line">          ElMessage.error(&#x27;分类ID无效&#x27;)</span><br><span class="line">          return</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // 打印调试信息</span><br><span class="line">        console.log(&#x27;更新分类ID:&#x27;, currentCategoryId.value, typeof currentCategoryId.value)</span><br><span class="line">        console.log(&#x27;更新分类参数:&#x27;, &#123;</span><br><span class="line">          name: categoryForm.name,</span><br><span class="line">          description: categoryForm.description,</span><br><span class="line">          sort: categoryForm.sort</span><br><span class="line">        &#125;)</span><br><span class="line">        </span><br><span class="line">        const res = await updateBlogCategory(</span><br><span class="line">          currentCategoryId.value,</span><br><span class="line">          categoryForm.name,</span><br><span class="line">          categoryForm.description,</span><br><span class="line">          categoryForm.sort</span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        if (res.data &amp;&amp; res.data.code === 200) &#123;</span><br><span class="line">          ElMessage.success(&#x27;分类更新成功&#x27;)</span><br><span class="line">          dialogVisible.value = false</span><br><span class="line">          fetchCategories()</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          ElMessage.error(res.data?.msg || &#x27;更新分类失败&#x27;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; catch (error) &#123;</span><br><span class="line">      console.error(&#x27;提交分类表单出错:&#x27;, error)</span><br><span class="line">      ElMessage.error(&#x27;操作失败&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 删除分类</span><br><span class="line">const deleteCategory = (category) =&gt; &#123;</span><br><span class="line">  if (category.postCount &gt; 0) &#123;</span><br><span class="line">    ElMessage.warning(`该分类下有$&#123;category.postCount&#125;篇文章，无法删除`)</span><br><span class="line">    return</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  ElMessageBox.confirm(</span><br><span class="line">    `确定要删除分类&quot;$&#123;category.name&#125;&quot;吗？`,</span><br><span class="line">    &#x27;提示&#x27;,</span><br><span class="line">    &#123;</span><br><span class="line">      confirmButtonText: &#x27;确定&#x27;,</span><br><span class="line">      cancelButtonText: &#x27;取消&#x27;,</span><br><span class="line">      type: &#x27;warning&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">  ).then(async () =&gt; &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">      const res = await deleteBlogCategory(category.id)</span><br><span class="line">      </span><br><span class="line">      if (res.data &amp;&amp; res.data.code === 200) &#123;</span><br><span class="line">        ElMessage.success(&#x27;分类删除成功&#x27;)</span><br><span class="line">        fetchCategories()</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        ElMessage.error(res.data?.msg || &#x27;删除分类失败&#x27;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; catch (error) &#123;</span><br><span class="line">      console.error(&#x27;删除分类出错:&#x27;, error)</span><br><span class="line">      ElMessage.error(&#x27;删除失败&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;).catch(() =&gt; &#123;</span><br><span class="line">    // 取消操作</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 组件挂载时获取数据</span><br><span class="line">onMounted(() =&gt; &#123;</span><br><span class="line">  fetchCategories()</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.blog-categories-container &#123;</span><br><span class="line">  padding: 20px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.page-header &#123;</span><br><span class="line">  display: flex;</span><br><span class="line">  justify-content: space-between;</span><br><span class="line">  align-items: center;</span><br><span class="line">  margin-bottom: 20px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.dialog-footer &#123;</span><br><span class="line">  display: flex;</span><br><span class="line">  justify-content: flex-end;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt; </span><br></pre></td></tr></table></figure>
<h2 id="博客标签管理组件blogtags.vue">博客标签管理组件(BlogTags.vue)</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;blog-tags-container&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;page-header&quot;&gt;</span><br><span class="line">      &lt;h2&gt;标签管理&lt;/h2&gt;</span><br><span class="line">      &lt;el-button type=&quot;primary&quot; @click=&quot;showAddTagDialog&quot;&gt;</span><br><span class="line">        &lt;el-icon&gt;&lt;Plus /&gt;&lt;/el-icon&gt;新建标签</span><br><span class="line">      &lt;/el-button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 标签列表 --&gt;</span><br><span class="line">    &lt;el-table</span><br><span class="line">      v-loading=&quot;loading&quot;</span><br><span class="line">      :data=&quot;tags&quot;</span><br><span class="line">      border</span><br><span class="line">      style=&quot;width: 100%&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;id&quot; label=&quot;ID&quot; width=&quot;80&quot; /&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;name&quot; label=&quot;标签名称&quot; min-width=&quot;150&quot; /&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;postCount&quot; label=&quot;文章数量&quot; width=&quot;100&quot; sortable /&gt;</span><br><span class="line">      &lt;el-table-column label=&quot;操作&quot; width=&quot;180&quot; fixed=&quot;right&quot;&gt;</span><br><span class="line">        &lt;template #default=&quot;scope&quot;&gt;</span><br><span class="line">          &lt;el-button size=&quot;small&quot; type=&quot;primary&quot; @click=&quot;showEditTagDialog(scope.row)&quot;&gt;编辑&lt;/el-button&gt;</span><br><span class="line">          &lt;el-button </span><br><span class="line">            size=&quot;small&quot; </span><br><span class="line">            type=&quot;danger&quot; </span><br><span class="line">            @click=&quot;deleteTag(scope.row)&quot;</span><br><span class="line">            :disabled=&quot;scope.row.postCount &gt; 0&quot;</span><br><span class="line">          &gt;删除&lt;/el-button&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">    &lt;/el-table&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 新增/编辑标签对话框 --&gt;</span><br><span class="line">    &lt;el-dialog</span><br><span class="line">      :title=&quot;dialogType === &#x27;add&#x27; ? &#x27;新建标签&#x27; : &#x27;编辑标签&#x27;&quot;</span><br><span class="line">      v-model=&quot;dialogVisible&quot;</span><br><span class="line">      width=&quot;400px&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;el-form :model=&quot;tagForm&quot; :rules=&quot;rules&quot; ref=&quot;tagFormRef&quot; label-width=&quot;80px&quot;&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;标签名称&quot; prop=&quot;name&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;tagForm.name&quot; placeholder=&quot;请输入标签名称&quot; /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">      &lt;/el-form&gt;</span><br><span class="line">      &lt;template #footer&gt;</span><br><span class="line">        &lt;span class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">          &lt;el-button @click=&quot;dialogVisible = false&quot;&gt;取消&lt;/el-button&gt;</span><br><span class="line">          &lt;el-button type=&quot;primary&quot; @click=&quot;submitTagForm&quot;&gt;确定&lt;/el-button&gt;</span><br><span class="line">        &lt;/span&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">    &lt;/el-dialog&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref, reactive, onMounted &#125; from &#x27;vue&#x27;</span><br><span class="line">import &#123; ElMessage, ElMessageBox &#125; from &#x27;element-plus&#x27;</span><br><span class="line">import &#123; </span><br><span class="line">  getBlogTags, </span><br><span class="line">  createBlogTag, </span><br><span class="line">  updateBlogTag, </span><br><span class="line">  deleteBlogTag </span><br><span class="line">&#125; from &#x27;@/utils/apis&#x27;</span><br><span class="line"></span><br><span class="line">// 标签列表数据</span><br><span class="line">const tags = ref([])</span><br><span class="line">// 加载状态</span><br><span class="line">const loading = ref(false)</span><br><span class="line">// 对话框可见性</span><br><span class="line">const dialogVisible = ref(false)</span><br><span class="line">// 对话框类型：add-新增，edit-编辑</span><br><span class="line">const dialogType = ref(&#x27;add&#x27;)</span><br><span class="line">// 标签表单引用</span><br><span class="line">const tagFormRef = ref(null)</span><br><span class="line">// 当前编辑的标签ID</span><br><span class="line">const currentTagId = ref(null)</span><br><span class="line"></span><br><span class="line">// 标签表单数据</span><br><span class="line">const tagForm = reactive(&#123;</span><br><span class="line">  name: &#x27;&#x27;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// 表单验证规则</span><br><span class="line">const rules = &#123;</span><br><span class="line">  name: [</span><br><span class="line">    &#123; required: true, message: &#x27;请输入标签名称&#x27;, trigger: &#x27;blur&#x27; &#125;,</span><br><span class="line">    &#123; max: 50, message: &#x27;标签名称不能超过50个字符&#x27;, trigger: &#x27;blur&#x27; &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 获取标签列表</span><br><span class="line">const fetchTags = async () =&gt; &#123;</span><br><span class="line">  loading.value = true</span><br><span class="line">  try &#123;</span><br><span class="line">    const res = await getBlogTags()</span><br><span class="line">    if (res.data &amp;&amp; res.data.code === 200) &#123;</span><br><span class="line">      tags.value = res.data.data || []</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      ElMessage.error(res.data?.msg || &#x27;获取标签列表失败&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; catch (error) &#123;</span><br><span class="line">    console.error(&#x27;获取标签列表出错:&#x27;, error)</span><br><span class="line">    ElMessage.error(&#x27;获取标签列表失败&#x27;)</span><br><span class="line">  &#125; finally &#123;</span><br><span class="line">    loading.value = false</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 显示新增标签对话框</span><br><span class="line">const showAddTagDialog = () =&gt; &#123;</span><br><span class="line">  dialogType.value = &#x27;add&#x27;</span><br><span class="line">  resetTagForm()</span><br><span class="line">  dialogVisible.value = true</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 显示编辑标签对话框</span><br><span class="line">const showEditTagDialog = (tag) =&gt; &#123;</span><br><span class="line">  dialogType.value = &#x27;edit&#x27;</span><br><span class="line">  currentTagId.value = tag.id</span><br><span class="line">  resetTagForm()</span><br><span class="line">  </span><br><span class="line">  // 填充表单数据</span><br><span class="line">  tagForm.name = tag.name</span><br><span class="line">  </span><br><span class="line">  dialogVisible.value = true</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 重置标签表单</span><br><span class="line">const resetTagForm = () =&gt; &#123;</span><br><span class="line">  if (tagFormRef.value) &#123;</span><br><span class="line">    tagFormRef.value.resetFields()</span><br><span class="line">  &#125;</span><br><span class="line">  tagForm.name = &#x27;&#x27;</span><br><span class="line">  currentTagId.value = null</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 提交标签表单</span><br><span class="line">const submitTagForm = async () =&gt; &#123;</span><br><span class="line">  if (!tagFormRef.value) return</span><br><span class="line">  </span><br><span class="line">  await tagFormRef.value.validate(async (valid) =&gt; &#123;</span><br><span class="line">    if (!valid) return</span><br><span class="line">    </span><br><span class="line">    try &#123;</span><br><span class="line">      if (dialogType.value === &#x27;add&#x27;) &#123;</span><br><span class="line">        // 新增标签</span><br><span class="line">        const res = await createBlogTag(tagForm.name)</span><br><span class="line">        console.log(&#x27;@&#x27;,res);</span><br><span class="line">        </span><br><span class="line">        if (res.data &amp;&amp; res.data.code === 200) &#123;</span><br><span class="line">          ElMessage.success(&#x27;标签创建成功&#x27;)</span><br><span class="line">          dialogVisible.value = false</span><br><span class="line">          fetchTags()</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          ElMessage.error(res.data?.msg || &#x27;创建标签失败&#x27;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        // 编辑标签</span><br><span class="line">        const res = await updateBlogTag(currentTagId.value, tagForm.name)</span><br><span class="line">        </span><br><span class="line">        if (res.data &amp;&amp; res.data.code === 200) &#123;</span><br><span class="line">          ElMessage.success(&#x27;标签更新成功&#x27;)</span><br><span class="line">          dialogVisible.value = false</span><br><span class="line">          fetchTags()</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          ElMessage.error(res.data?.msg || &#x27;更新标签失败&#x27;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; catch (error) &#123;</span><br><span class="line">      console.error(&#x27;提交标签表单出错:&#x27;, error)</span><br><span class="line">      ElMessage.error(&#x27;操作失败&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 删除标签</span><br><span class="line">const deleteTag = (tag) =&gt; &#123;</span><br><span class="line">  if (tag.postCount &gt; 0) &#123;</span><br><span class="line">    ElMessage.warning(`该标签下有$&#123;tag.postCount&#125;篇文章，无法删除`)</span><br><span class="line">    return</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  ElMessageBox.confirm(</span><br><span class="line">    `确定要删除标签&quot;$&#123;tag.name&#125;&quot;吗？`,</span><br><span class="line">    &#x27;提示&#x27;,</span><br><span class="line">    &#123;</span><br><span class="line">      confirmButtonText: &#x27;确定&#x27;,</span><br><span class="line">      cancelButtonText: &#x27;取消&#x27;,</span><br><span class="line">      type: &#x27;warning&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">  ).then(async () =&gt; &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">      const res = await deleteBlogTag(tag.id)</span><br><span class="line">      </span><br><span class="line">      if (res.data &amp;&amp; res.data.code === 200) &#123;</span><br><span class="line">        ElMessage.success(&#x27;标签删除成功&#x27;)</span><br><span class="line">        fetchTags()</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        ElMessage.error(res.data?.msg || &#x27;删除标签失败&#x27;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; catch (error) &#123;</span><br><span class="line">      console.error(&#x27;删除标签出错:&#x27;, error)</span><br><span class="line">      ElMessage.error(&#x27;删除失败&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;).catch(() =&gt; &#123;</span><br><span class="line">    // 取消操作</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 组件挂载时获取数据</span><br><span class="line">onMounted(() =&gt; &#123;</span><br><span class="line">  fetchTags()</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.blog-tags-container &#123;</span><br><span class="line">  padding: 20px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.page-header &#123;</span><br><span class="line">  display: flex;</span><br><span class="line">  justify-content: space-between;</span><br><span class="line">  align-items: center;</span><br><span class="line">  margin-bottom: 20px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.dialog-footer &#123;</span><br><span class="line">  display: flex;</span><br><span class="line">  justify-content: flex-end;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt; </span><br></pre></td></tr></table></figure>
<h2 id="博客回收站组件blogrecycle.vue">博客回收站组件(BlogRecycle.vue)</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;blog-recycle-container&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;page-header&quot;&gt;</span><br><span class="line">      &lt;h2&gt;回收站&lt;/h2&gt;</span><br><span class="line">      &lt;div class=&quot;header-actions&quot;&gt;</span><br><span class="line">        &lt;el-button type=&quot;danger&quot; @click=&quot;batchDeletePosts&quot; :disabled=&quot;selectedPosts.length === 0&quot;&gt;</span><br><span class="line">          &lt;el-icon&gt;&lt;Delete /&gt;&lt;/el-icon&gt;永久删除</span><br><span class="line">        &lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type=&quot;success&quot; @click=&quot;batchRestorePosts&quot; :disabled=&quot;selectedPosts.length === 0&quot;&gt;</span><br><span class="line">          &lt;el-icon&gt;&lt;RefreshRight /&gt;&lt;/el-icon&gt;恢复文章</span><br><span class="line">        &lt;/el-button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 文章列表 --&gt;</span><br><span class="line">    &lt;el-table</span><br><span class="line">      v-loading=&quot;loading&quot;</span><br><span class="line">      :data=&quot;postList&quot;</span><br><span class="line">      border</span><br><span class="line">      style=&quot;width: 100%&quot;</span><br><span class="line">      @selection-change=&quot;handleSelectionChange&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;el-table-column type=&quot;selection&quot; width=&quot;55&quot; /&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;title&quot; label=&quot;标题&quot; min-width=&quot;200&quot;&gt;</span><br><span class="line">        &lt;template #default=&quot;scope&quot;&gt;</span><br><span class="line">          &lt;el-tooltip :content=&quot;scope.row.title&quot; placement=&quot;top&quot; :show-after=&quot;1000&quot;&gt;</span><br><span class="line">            &lt;span class=&quot;post-title&quot;&gt;&#123;&#123; scope.row.title &#125;&#125;&lt;/span&gt;</span><br><span class="line">          &lt;/el-tooltip&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;categoryName&quot; label=&quot;分类&quot; width=&quot;120&quot; /&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;authorName&quot; label=&quot;作者&quot; width=&quot;120&quot; /&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;createTime&quot; label=&quot;创建时间&quot; width=&quot;180&quot; sortable /&gt;</span><br><span class="line">      &lt;el-table-column label=&quot;操作&quot; width=&quot;180&quot; fixed=&quot;right&quot;&gt;</span><br><span class="line">        &lt;template #default=&quot;scope&quot;&gt;</span><br><span class="line">          &lt;el-button size=&quot;small&quot; type=&quot;success&quot; @click=&quot;restorePost(scope.row)&quot;&gt;恢复&lt;/el-button&gt;</span><br><span class="line">          &lt;el-button size=&quot;small&quot; type=&quot;danger&quot; @click=&quot;deletePost(scope.row)&quot;&gt;删除&lt;/el-button&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">    &lt;/el-table&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 分页 --&gt;</span><br><span class="line">    &lt;div class=&quot;pagination-container&quot;&gt;</span><br><span class="line">      &lt;el-pagination</span><br><span class="line">        v-model:current-page=&quot;currentPage&quot;</span><br><span class="line">        v-model:page-size=&quot;pageSize&quot;</span><br><span class="line">        :page-sizes=&quot;[10, 20, 50, 100]&quot;</span><br><span class="line">        layout=&quot;total, sizes, prev, pager, next, jumper&quot;</span><br><span class="line">        :total=&quot;total&quot;</span><br><span class="line">        @size-change=&quot;handleSizeChange&quot;</span><br><span class="line">        @current-change=&quot;handleCurrentChange&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref, reactive, onMounted &#125; from &#x27;vue&#x27;</span><br><span class="line">import &#123; ElMessage, ElMessageBox &#125; from &#x27;element-plus&#x27;</span><br><span class="line">import &#123; </span><br><span class="line">  getBlogPosts, </span><br><span class="line">  deleteBlogPost, </span><br><span class="line">  restoreBlogPostFromRecycleBin </span><br><span class="line">&#125; from &#x27;@/utils/apis&#x27;</span><br><span class="line"></span><br><span class="line">// 文章列表数据</span><br><span class="line">const postList = ref([])</span><br><span class="line">// 加载状态</span><br><span class="line">const loading = ref(false)</span><br><span class="line">// 选中的文章</span><br><span class="line">const selectedPosts = ref([])</span><br><span class="line">// 分页相关</span><br><span class="line">const currentPage = ref(1)</span><br><span class="line">const pageSize = ref(10)</span><br><span class="line">const total = ref(0)</span><br><span class="line"></span><br><span class="line">// 获取回收站文章列表</span><br><span class="line">const fetchPosts = async () =&gt; &#123;</span><br><span class="line">  loading.value = true</span><br><span class="line">  try &#123;</span><br><span class="line">    const res = await getBlogPosts(&#123;</span><br><span class="line">      page: currentPage.value,</span><br><span class="line">      size: pageSize.value,</span><br><span class="line">      status: 2 // 回收站状态</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    if (res.data &amp;&amp; res.data.code === 200) &#123;</span><br><span class="line">      const data = res.data.data</span><br><span class="line">      postList.value = data.records || []</span><br><span class="line">      total.value = data.total || 0</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      ElMessage.error(res.data?.msg || &#x27;获取回收站文章失败&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; catch (error) &#123;</span><br><span class="line">    console.error(&#x27;获取回收站文章出错:&#x27;, error)</span><br><span class="line">    ElMessage.error(&#x27;获取回收站文章失败&#x27;)</span><br><span class="line">  &#125; finally &#123;</span><br><span class="line">    loading.value = false</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 处理选择变化</span><br><span class="line">const handleSelectionChange = (selection) =&gt; &#123;</span><br><span class="line">  selectedPosts.value = selection</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 处理每页显示数量变化</span><br><span class="line">const handleSizeChange = (size) =&gt; &#123;</span><br><span class="line">  pageSize.value = size</span><br><span class="line">  fetchPosts()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 处理页码变化</span><br><span class="line">const handleCurrentChange = (page) =&gt; &#123;</span><br><span class="line">  currentPage.value = page</span><br><span class="line">  fetchPosts()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 恢复单篇文章</span><br><span class="line">const restorePost = (post) =&gt; &#123;</span><br><span class="line">  ElMessageBox.confirm(</span><br><span class="line">    `确定要恢复文章&quot;$&#123;post.title&#125;&quot;吗？`,</span><br><span class="line">    &#x27;提示&#x27;,</span><br><span class="line">    &#123;</span><br><span class="line">      confirmButtonText: &#x27;确定&#x27;,</span><br><span class="line">      cancelButtonText: &#x27;取消&#x27;,</span><br><span class="line">      type: &#x27;info&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">  ).then(async () =&gt; &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">      const userId = 1 // 固定用户ID，实际应用中应该从登录用户信息中获取</span><br><span class="line">      const res = await restoreBlogPostFromRecycleBin(userId, post.id)</span><br><span class="line">      </span><br><span class="line">      if (res.data &amp;&amp; res.data.code === 200) &#123;</span><br><span class="line">        ElMessage.success(&#x27;文章已恢复&#x27;)</span><br><span class="line">        fetchPosts()</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        ElMessage.error(res.data?.msg || &#x27;恢复文章失败&#x27;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; catch (error) &#123;</span><br><span class="line">      console.error(&#x27;恢复文章出错:&#x27;, error)</span><br><span class="line">      ElMessage.error(&#x27;恢复失败&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;).catch(() =&gt; &#123;</span><br><span class="line">    // 取消操作</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 永久删除单篇文章</span><br><span class="line">const deletePost = (post) =&gt; &#123;</span><br><span class="line">  ElMessageBox.confirm(</span><br><span class="line">    `确定要永久删除文章&quot;$&#123;post.title&#125;&quot;吗？此操作不可恢复！`,</span><br><span class="line">    &#x27;警告&#x27;,</span><br><span class="line">    &#123;</span><br><span class="line">      confirmButtonText: &#x27;确定删除&#x27;,</span><br><span class="line">      cancelButtonText: &#x27;取消&#x27;,</span><br><span class="line">      type: &#x27;warning&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">  ).then(async () =&gt; &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">      const userId = 1 // 固定用户ID，实际应用中应该从登录用户信息中获取</span><br><span class="line">      const res = await deleteBlogPost(userId, post.id)</span><br><span class="line">      </span><br><span class="line">      if (res.data &amp;&amp; res.data.code === 200) &#123;</span><br><span class="line">        ElMessage.success(&#x27;文章已永久删除&#x27;)</span><br><span class="line">        fetchPosts()</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        ElMessage.error(res.data?.msg || &#x27;删除文章失败&#x27;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; catch (error) &#123;</span><br><span class="line">      console.error(&#x27;删除文章出错:&#x27;, error)</span><br><span class="line">      ElMessage.error(&#x27;删除失败&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;).catch(() =&gt; &#123;</span><br><span class="line">    // 取消操作</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 批量恢复文章</span><br><span class="line">const batchRestorePosts = () =&gt; &#123;</span><br><span class="line">  if (selectedPosts.value.length === 0) &#123;</span><br><span class="line">    return</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ElMessageBox.confirm(</span><br><span class="line">    `确定要恢复选中的 $&#123;selectedPosts.value.length&#125; 篇文章吗？`,</span><br><span class="line">    &#x27;提示&#x27;,</span><br><span class="line">    &#123;</span><br><span class="line">      confirmButtonText: &#x27;确定&#x27;,</span><br><span class="line">      cancelButtonText: &#x27;取消&#x27;,</span><br><span class="line">      type: &#x27;info&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">  ).then(async () =&gt; &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">      const userId = 1 // 固定用户ID，实际应用中应该从登录用户信息中获取</span><br><span class="line">      const promises = selectedPosts.value.map(post =&gt; </span><br><span class="line">        restoreBlogPostFromRecycleBin(userId, post.id)</span><br><span class="line">      )</span><br><span class="line">      </span><br><span class="line">      await Promise.all(promises)</span><br><span class="line">      ElMessage.success(&#x27;已恢复选中文章&#x27;)</span><br><span class="line">      fetchPosts()</span><br><span class="line">    &#125; catch (error) &#123;</span><br><span class="line">      console.error(&#x27;批量恢复文章出错:&#x27;, error)</span><br><span class="line">      ElMessage.error(&#x27;操作失败&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;).catch(() =&gt; &#123;</span><br><span class="line">    // 取消操作</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 批量永久删除文章</span><br><span class="line">const batchDeletePosts = () =&gt; &#123;</span><br><span class="line">  if (selectedPosts.value.length === 0) &#123;</span><br><span class="line">    return</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ElMessageBox.confirm(</span><br><span class="line">    `确定要永久删除选中的 $&#123;selectedPosts.value.length&#125; 篇文章吗？此操作不可恢复！`,</span><br><span class="line">    &#x27;警告&#x27;,</span><br><span class="line">    &#123;</span><br><span class="line">      confirmButtonText: &#x27;确定删除&#x27;,</span><br><span class="line">      cancelButtonText: &#x27;取消&#x27;,</span><br><span class="line">      type: &#x27;warning&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">  ).then(async () =&gt; &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">      const userId = 1 // 固定用户ID，实际应用中应该从登录用户信息中获取</span><br><span class="line">      const promises = selectedPosts.value.map(post =&gt; </span><br><span class="line">        deleteBlogPost(userId, post.id)</span><br><span class="line">      )</span><br><span class="line">      </span><br><span class="line">      await Promise.all(promises)</span><br><span class="line">      ElMessage.success(&#x27;已永久删除选中文章&#x27;)</span><br><span class="line">      fetchPosts()</span><br><span class="line">    &#125; catch (error) &#123;</span><br><span class="line">      console.error(&#x27;批量删除文章出错:&#x27;, error)</span><br><span class="line">      ElMessage.error(&#x27;操作失败&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;).catch(() =&gt; &#123;</span><br><span class="line">    // 取消操作</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 组件挂载时获取数据</span><br><span class="line">onMounted(() =&gt; &#123;</span><br><span class="line">  fetchPosts()</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.blog-recycle-container &#123;</span><br><span class="line">  padding: 20px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.page-header &#123;</span><br><span class="line">  display: flex;</span><br><span class="line">  justify-content: space-between;</span><br><span class="line">  align-items: center;</span><br><span class="line">  margin-bottom: 20px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.header-actions &#123;</span><br><span class="line">  display: flex;</span><br><span class="line">  gap: 10px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.post-title &#123;</span><br><span class="line">  display: inline-block;</span><br><span class="line">  max-width: 300px;</span><br><span class="line">  overflow: hidden;</span><br><span class="line">  text-overflow: ellipsis;</span><br><span class="line">  white-space: nowrap;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.pagination-container &#123;</span><br><span class="line">  margin-top: 20px;</span><br><span class="line">  display: flex;</span><br><span class="line">  justify-content: flex-end;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt; </span><br></pre></td></tr></table></figure>
<h2 id="用户登录">用户登录</h2>
<ul>
<li><p>状态管理设计 ：</p></li>
<li><p>使用Vuex集中管理用户状态（user）、登录状态（isAuthenticated）和token</p></li>
<li><p>通过getters提供状态访问接口</p></li>
<li><p>通过mutations提供状态修改方法</p></li>
<li><p>通过actions封装业务逻辑（登录、注销、检查登录状态）</p></li>
<li><p>API设计 ：</p></li>
<li><p>在apis.js中统一管理所有用户相关API</p></li>
<li><p>接口路径与后端保持一致（/user/login, /user/info等）</p></li>
<li><p>使用统一的request方法发送请求</p></li>
<li><p>Axios拦截器设计 ：</p></li>
<li><p>请求拦截器：自动添加token到请求头</p></li>
<li><p>响应拦截器：统一处理错误（特别是401未授权错误）</p></li>
<li><p>自动保存响应中的token到store</p></li>
<li><p>登录组件设计 ：</p></li>
<li><p>使用Element Plus表单组件</p></li>
<li><p>表单验证规则与后端一致</p></li>
<li><p>通过Vuex action处理登录逻辑</p></li>
<li><p>提供友好的用户反馈（加载状态、成功/失败提示）</p></li>
<li><p>安全性考虑 ：</p></li>
<li><p>密码在传输前应该加密（可以在前端做MD5加密）</p></li>
<li><p>token存储在Vuex中，不推荐长期存储在localStorage</p></li>
<li><p>401错误自动注销并清理用户信息</p></li>
</ul>
<h2 id="轮播图数据库设计">轮播图数据库设计</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `blog_carousel` (</span><br><span class="line">    `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT &#x27;主键ID&#x27;,</span><br><span class="line">    `title` VARCHAR(100) NOT NULL COMMENT &#x27;轮播图标题&#x27;,</span><br><span class="line">    `description` VARCHAR(255) DEFAULT NULL COMMENT &#x27;轮播图描述&#x27;,</span><br><span class="line">    `image_url` VARCHAR(1000) NOT NULL COMMENT &#x27;轮播图图片URL&#x27;,</span><br><span class="line">    `link_url` VARCHAR(1000) DEFAULT NULL COMMENT &#x27;轮播图跳转链接&#x27;,</span><br><span class="line">    `sort` INT(11) NOT NULL DEFAULT 0 COMMENT &#x27;轮播图排序（数字越小越靠前）&#x27;,</span><br><span class="line">    `status` TINYINT(1) NOT NULL DEFAULT 1 COMMENT &#x27;轮播图状态（0:禁用, 1:启用）&#x27;,</span><br><span class="line">    `target_type` VARCHAR(20) DEFAULT NULL COMMENT &#x27;跳转目标类型（如：文章、活动、外部链接等）&#x27;,</span><br><span class="line">    `target_id` BIGINT(20) DEFAULT NULL COMMENT &#x27;跳转目标ID（如文章ID、活动ID等）&#x27;,</span><br><span class="line">    `language` VARCHAR(10) DEFAULT &#x27;zh-CN&#x27; COMMENT &#x27;语言（如：zh-CN, en-US等）&#x27;,</span><br><span class="line">    `start_time` DATETIME DEFAULT NULL COMMENT &#x27;轮播图开始展示时间&#x27;,</span><br><span class="line">    `end_time` DATETIME DEFAULT NULL COMMENT &#x27;轮播图结束展示时间&#x27;,</span><br><span class="line">    `width` INT(11) DEFAULT NULL COMMENT &#x27;图片宽度（单位：像素）&#x27;,</span><br><span class="line">    `height` INT(11) DEFAULT NULL COMMENT &#x27;图片高度（单位：像素）&#x27;,</span><br><span class="line">    `click_count` INT(11) NOT NULL DEFAULT 0 COMMENT &#x27;点击次数&#x27;,</span><br><span class="line">    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#x27;创建时间&#x27;,</span><br><span class="line">    `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT &#x27;更新时间&#x27;,</span><br><span class="line">    PRIMARY KEY (`id`),</span><br><span class="line">    KEY `idx_sort` (`sort`),</span><br><span class="line">    KEY `idx_status` (`status`),</span><br><span class="line">    KEY `idx_create_time` (`create_time`),</span><br><span class="line">    KEY `idx_language` (`language`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT=&#x27;轮播图表&#x27;;</span><br></pre></td></tr></table></figure>

    </div>

    
    
      
<div class="signature signature-post">Best Tao.</div>

    

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/03/26/mcp%E6%8A%80%E6%9C%AF/" rel="prev" title="mcp技术">
                  <i class="fa fa-chevron-left"></i> mcp技术
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2025/04/07/WindowSubsystemForLinux/" rel="next" title="WindowSubsystemForLinux">
                  WindowSubsystemForLinux <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments gitalk-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">LuoTao</span>
</div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>


  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdn.jsdelivr.net/npm/mermaid@11.5.0/dist/mermaid.min.js","integrity":"sha256-2obLuIPcceEhkE3G09G33hBdmE55ivVcZUlcKcGNHjU="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>



  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"luotaofun","repo":"hexo-blog-comments","client_id":"Ov23li6vpjnB5BV9Bb5T","client_secret":"cfc9f5ec04a4a2f7f610ceefd6bf6176d6409461","admin_user":"luotaofun","distraction_free_mode":false,"language":"zh-CN","js":{"url":"https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js","integrity":"sha256-Pmj85ojLaPOWwRtlMJwmezB/Qg8BzvJp5eTzvXaYAfA="},"path_md5":"2aeee9f88142fb22488fa69fe3bb96f8"}</script>
<script src="/js/third-party/comments/gitalk.js"></script>

</body>
</html>
